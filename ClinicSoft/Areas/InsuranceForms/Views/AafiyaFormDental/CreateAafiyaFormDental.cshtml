@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@model BusinessEntities.InsuranceForms.AafiyaFormDental

@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}
<form id="form_AafiyaFormDental" autocomplete="off" name="AafiyaFormDental" ondrop="return false;" onpaste="return false;" oncut="return false;" class="fs-14">
    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.mcdId, new { @id = "mcdId", @value = "@Model.mcdId" })
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="row border border-1">
                <div class="form-horizontal">
                    <div class="form-group row">
                        <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                            <label class="col-md-4 font-weight-semibold">
                                Provider Name
                            </label>
                            <div class="d-flex  justify-content-center w-8  form-label">
                                :
                            </div>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.set_company&nbsp;</span>
                            </div>
                        </div>
                        <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                            <label class="col-md-4 font-weight-semibold">
                                Patient Name
                            </label>
                            <div class="d-flex  justify-content-center w-8  form-label">
                                :
                            </div>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.pat_name&nbsp;</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0 mb-2">
                            <label class="col-md-4 font-weight-semibold">
                                Insurance Company
                            </label>
                            <div class="d-flex justify-content-center w-8 form-label">
                                :
                            </div>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.ic_name&nbsp;</span>
                            </div>
                        </div>
                        <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                            <label class="col-md-4 font-weight-semibold">
                                Patient Mobile No
                            </label>
                            <div class="d-flex justify-content-center w-8 form-label">
                                :
                            </div>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.pat_mob&nbsp;</span>
                            </div>
                        </div>
                        <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                            <label class="col-md-4 font-weight-semibold">
                                File No
                            </label>
                            <div class="d-flex  justify-content-center w-8  form-label">
                                :
                            </div>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.pat_code&nbsp;</span>
                            </div>
                        </div>
                        <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0 mb-2">
                            <label class="col-md-4 font-weight-semibold">
                                Company Name
                            </label>
                            <div class="d-flex  justify-content-center w-8  form-label">
                                :
                            </div>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.set_company&nbsp;</span>
                            </div>
                        </div>
                        <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                            <label class="col-md-4 font-weight-semibold">
                                Member ID
                            </label>
                            <div class="d-flex  justify-content-center w-8  form-label">
                                :
                            </div>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.pi_insno&nbsp;</span>
                            </div>
                        </div>
                        <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                            <label class="col-md-4 font-weight-semibold">
                                Date Of Treatment
                            </label>
                            <div class="d-flex  justify-content-center w-8  form-label">
                                :
                            </div>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.app_fdate&nbsp;</span>
                            </div>
                        </div>
                        <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                            <label class="col-md-4 font-weight-semibold">
                                Date Of Birth
                            </label>
                            <div class="d-flex  justify-content-center w-8  form-label">
                                :
                            </div>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.pat_dob&nbsp;</span>
                            </div>
                        </div>
                        <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                            <label class="col-md-4 font-weight-semibold">
                                Gender
                            </label>
                            <div class="d-flex  justify-content-center w-8  form-label">
                                :
                            </div>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.pat_gender&nbsp;</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-2 mt-4">
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 table-bordered card-table  text-nowrap">
            <div class="form-horizontal">
                <div class="form-group">
                    <div class="fw-bold">Chief Complaint&nbsp;: </div>
                    <div>
                        <label class="text-black text-red text-left" id="complaints" name="">&nbsp;</label>
                    </div>
                </div>
                <div class="form-group row border border-1 pb-2 pt-2">
                    <label class="col-md-2 text-black">
                        Referral (if needed) <span class="text-red">*</span>:
                    </label>
                    <div class="col-md-8">
                        @Html.TextBoxFor(m => m.mcd_referral, new { @class = "form-control", @id = "mcd_referral", @maxlength = "250" })
                    </div>
                </div>
                <div class="form-group row">
                    <label class="form-label">
                        Clinical Findings&nbsp;:
                    </label>
                </div>
                <div class="form-group row border border-1 pb-2 pt-2 border-top-0">
                    <div class="col-md-2">
                        BP&nbsp;:
                        <div>
                            <label class="form-label text-red text-left" id="sign_bp" name="">&nbsp;</label>
                        </div>
                    </div>
                    <div class="col-md-2">
                        Temp&nbsp;:
                        <div>
                            <label class="form-label text-red text-left" id="sign_temp" name="">&nbsp;</label>
                        </div>
                    </div>
                    <div class="col-md-2">
                        Pulse&nbsp;:
                        <div>
                            <label class="form-label text-red text-left" id="sign_pulse" name="">&nbsp;</label>
                        </div>
                    </div>
                    <div class="col-md-2">
                        Notes&nbsp;:
                        <div>
                            <label class="form-label text-red text-left" id="sign_notes" name="">&nbsp;</label>
                        </div>
                    </div>
                </div>
                <div class="d-flex form-group row border border-1 pb-2 pt-2 border-top-0">
                    <div class="col-md-3">
                        <label class="fw-bold">Diagnosis:</label>
                        <div>
                            <label class="text-black text-red text-left" id="pat_Diagnosis" name=""></label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="fw-bold">Diagnosis Code:</label>
                        <div>
                            <label class="text-black text-red text-left" id="pat_Diagnosis_code" name=""></label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="fw-bold">Date of Onset:</label>
                        <div>
                            <label class="text-black text-red text-left text-red">@emr.app_fdate</label>
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-3">
                        <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                            <label class="custom-control custom-radio ms-sm-2 md-md-2 ms-lg-2">
                                <input type="radio" class="custom-control-input" name="mcd_radio" id="mcd_radio1" value="1">
                                <span class="custom-control-label">PEC/CHRONIC</span>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                            <label class="custom-control custom-radio ms-sm-2 md-md-2 ms-lg-2">
                                <input type="radio" class="custom-control-input" name="mcd_radio" id="mcd_radio2" value="2">
                                <span class="custom-control-label">CONGENITAL</span>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                            <label class="custom-control custom-radio ms-sm-2 md-md-2 ms-lg-2">
                                <input type="radio" class="custom-control-input" name="mcd_radio" id="mcd_radio3" value="3">
                                <span class="custom-control-label">MATERNITY</span>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                            <label class="custom-control custom-radio ms-sm-2 md-md-2 ms-lg-2">
                                <input type="radio" class="custom-control-input" name="mcd_radio" id="mcd_radio4" value="4">
                                <span class="custom-control-label">DENTAL</span>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                            <label class="custom-control custom-radio ms-sm-2 md-md-2 ms-lg-2">
                                <input type="radio" class="custom-control-input" name="mcd_radio" id="mcd_radio5" value="5">
                                <span class="custom-control-label">OPTICAL</span>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                            <label class="custom-control custom-radio ms-sm-2 md-md-2 ms-lg-2">
                                <input type="radio" class="custom-control-input" name="mcd_radio" id="mcd_radio6" value="6">
                                <span class="custom-control-label">WORK RELATED OTHERS</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-group row border border-1 pb-2 pt-2">
                    <label class="fw-bold">Treatment Plan&nbsp;:</label>
                    <div>
                        <label class="text-black text-red text-left" id="treat_details" name=""></label>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-md-2 text-black">
                        Requested Investigations
                        <span class="text-red">*</span>:
                    </label>
                    <div class="col-md-4">
                        @Html.TextAreaFor(m => m.mcd_investigation, new { @class = "form-control mb-3 mt-0", @row = "2", @id = "mcd_investigation" })
                    </div>
                    <label class="col-md-1 text-black">Estimated Cost<span class="text-red">*</span>:</label>
                    <div class="col-md-5">
                        @Html.TextBoxFor(m => m.mcd_cost, new { @class = "form-control", @id = "mcd_cost", @maxlength = "50" })
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-12">
                        <label class="text-black">Prescription<span class="text-red">*</span>:</label>
                        <div>
                            @Html.TextBoxFor(m => m.mcd_prescription, new { @class = "form-control", @id = "mcd_prescription", @maxlength = "50" })
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-6">
                        <h5 class="font-weight-bold">MEDICAL PRACTITIONER’S DECLARATION: </h5>
                        <p class="text-wrap">I declare that I am the patient’s medical practitioner and that the particulars given are to the best of my knowledge true and correct.</p>
                        <label class="form-label">Doctor Name</label>
                        <div>
                            <span class="font-weight-normal1 text-capitalize text-left text-red">@emr.doc_name&nbsp;</span>
                        </div>
                        <label class="form-label">Doctor's Sign & Stamp</label>
                        <div>
                            <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                        </div>
                        <span class="font-weight-semibold">Date</span>
                        <label class="form-label text-red text-left">@DateTime.Now.ToString("yyyy-MM-dd")</label>
                    </div>
                    <div class="col-sm-12 col-md-12 col-lg-6">
                        <h5 class="font-weight-bold">
                            PATIENT’S DECLARATION :
                        </h5>
                        <p class="text-wrap">I hereby authorize any Healthcare provider, Insurer, Employer or other organization to release any information regarding my medical condition & history to Aafiya for purpose of determining insurance benefits.</p>
                        <label class="form-label">Patient‘s Signature <span class="text-info">{Parent if minor}</span></label>
                        <div id="pat_sign_box">
                            <img alt="stamp" id="pat_sign" class="avatar avatar-xl bsquare" />
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-6 mt-3">
                            <label class="form-label text-red text-left" id="psb_date_patient" name="">&nbsp;</label>
                            <label class="form-label mb-2 text-danger">
                                Date
                            </label>
                        </div>
                    </div>
                </div>

                @*<div class="form-group row">
                        <p class="text-red text-justify">
                            Aafiya Medical Billing Services reserve its right during the Agreement period with the service provider, survey and audit the
                            service provider’s operations with respect to its performance of services, the patient visit details and claims.
                        </p>
                    </div>*@
                <div class="form-group bg-red-darker">
                    <p class="text-white text-justify text-center">
                        24/7 Claims Centre<br />
                        Helpline : 9714263 0666 | Tel : 971 4 283 8116 | Fax : 971 4 283 8115 | Email : claims@aafiya.ae | Website : www.aafiya.ae
                    </p>
                </div>
            </div>

        </div>
    </div>
    <div class="row ">
        <div class="row mt-2">
            <div class="col-sm-12 col-md-12 col-lg-12 text-center">
                <div class="btn-list btn-animation">
                    <button type="submit" class="btn btn-success" id="btn_Insert">Save</button>
                    <button type="button" class="btn btn-outline-dark" id="btn_Reset_C">Reset</button>
                    <button type="button" class="btn btn-danger btn-sm d-none" id="btn_Delete">Delete</button>
                    <button type="button" class="btn btn-sm btn-outline-success d-none" id="btn_Print_C"> Download/Print </button>
                    <div class="btn-group mr-2">
                        <div class="dropdown">
                            <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" onclick="openSignaturePad('patient')">Tab</a>
                                <a class="dropdown-item" onclick="openWacomTabSignaturePad('patient')">Wacom Tab</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<script type="text/javascript">
    //#region Page Load
   $(function () {
     if ("@emp_designation.ToString()" === "Super Administrator") {
         $("#btn_Insert").show();
     }
     else {
         if ("@emr.set_emr_lock" == "NoLock") {
             $("#btn_Insert").show();
         }
         else {
             if ("@emr.app_ae_date" >= "@emr.today") {
                 $("#btn_Insert").show();
             }
             else {
                 $("#btn_Insert").hide();
             }
         }
     }
     validate();
     Get_Patient_signs();
     Get_PatientEMR();

       $('#mcd_cost').on('keypress', function (e) {
           let cost1 = e.which ? e.which : e.keyCode;
           if (String.fromCharCode(cost1).match(/^[0-9.]$/))
               return true;
           return false;
       })

 });
    //#endregion
    //#region Validation Initialization
    var validate = function () {
        $("#form_AafiyaFormDental").validate({
            rules: {
                mcd_prescription: {
                    required: true,
                },
            },
            messages: {
                mcd_prescription: {
                    required: "Please Enter Prescription"
                },
            },
            highlight: function (element) {
                var elem = $(element);
                $(element).parent().addClass('has-error');
                //error_timeout(elem.attr("id"));
            },
            unhighlight: function (element) {
                var elem = $(element);
                $(element).parent().removeClass('has-error');
            },
            errorElement: 'span',
            errorClass: 'text-danger fw-bold',
            errorPlacement: function (error, element) {
                var elem = $(element);
                if (element.parent('.input-group').length) {
                    error.insertAfter(element.parent());
                } else {
                    error.insertAfter(element);
                }
            }
        });
    }
    //#endregion
     //#region Add  Click
 $('#btn_Insert').on('click', function (e) {
     e.preventDefault();
     if ($("#form_AafiyaFormDental").valid()) {
         $('#btn_Insert').removeClass("btn btn-sm btn-success");
         $('#btn_Insert').addClass("btn btn-sm btn-success btn-loaders btn-icon");
         $('#btn_Insert').html("Saving the Record....");

         var mcd_radio = "";

         if ($('#mcd_radio1').prop('checked')) {
             mcd_radio = "1";
         }
         else if ($('#mcd_radio2').prop('checked')) {
             mcd_radio = "2";
         }
         else if ($('#mcd_radio3').prop('checked')) {
             mcd_radio = "3";
         }
         else if ($('#mcd_radio4').prop('checked')) {
             mcd_radio = "4";
         }
         else if ($('#mcd_radio5').prop('checked')) {
             mcd_radio = "5";
         }
         else if ($('#mcd_radio6').prop('checked')) {
             mcd_radio = "6";
         }


         var _dateInsert = {
                 "mcdId": 0,
                 "mcd_appId": @emr.appId,
                 "mcd_radio": mcd_radio,
                 "mcd_investigation": $("#mcd_investigation").val(),
                 "mcd_prescription": $("#mcd_prescription").val(),
                 "mcd_referral": $("#mcd_referral").val(),
                 "mcd_cost": $("#mcd_cost").val(),

             "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
         }

     console.log(_dateInsert);

         $.ajax({
             type: "Post",
             url: "@Url.Action("InsertAafiyaFormDental", "AafiyaFormDental", new {area = "InsuranceForms" })",
             dataType: 'JSON',
             data: _dateInsert,
             success: function (data) {
                 $('#btn_Insert').removeClass("btn btn-sm btn-success btn-loaders btn-icon");
                 $('#btn_Insert').addClass("btn btn-sm btn-success");
                 $('#btn_Insert').html("Save Changes");

                 if (data.isSuccess) {
                     if (data.isInserted) {
                         GetAafiyaFormDentalInfo();
                         var alertPlaceholder = document.getElementById("Alert");

                         function alert(e, t) {
                             var l = document.createElement("div");
                             l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" role="alert">' + e +
                                 '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                         }
                         alert("<i class='fe fe-check-circle text-white'></i>AafiyaFormDental Saved Successfully!", "success");


                         Timeout();
                         EditAafiyaFormDental()

                         $("#btn_Delete").removeClass("d-none");
                         $("#btn_Print").removeClass("d-none");
                     }
                     else {
                         let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                             "<div class='alert alert-warning' role='alert'>" +
                             "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                             "<strong>Warning.. AafiyaFormDental already Exists..</strong><br/>" +
                             "</div></div>";
                         $("#Alert").html(html);
                     }
                 }
                 else {
                     let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                     "<div class='alert alert-danger' role='alert'>" +
                     "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                     "<strong>Validation Error.. Please correct before you submit the form!&nbsp;</strong><br/><ul>";

                     $.each(data.message, function (index, value) {
                         html += "<li><small>" + value + "</small><li>";
                         var elem = $("#" + index);
                         if (elem.hasClass("select2-hidden-accessible")) {
                             $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                         }
                         else {
                             $(elem).addClass(" is-invalid");
                         }

                         setTimeout(function () {
                             if (elem.hasClass("select2-hidden-accessible")) {
                                 $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                             }
                             else {
                                 $(elem).removeClass("is-invalid");
                             }
                             }, 5000);
                     });

                     html += "</ul></div></div>";

                     $("#error").html(html);
                 }
             },
             error: function (xhr) {
                 $('#btn_Insert').removeClass("btn btn-sm btn-success btn-loaders btn-icon");
                 $('#btn_Insert').addClass("btn btn-sm btn-warning");
                 $('#btn_Insert').html("Add");
                 Timeout();
             }
         });
     }
     else {
         $('.modal-body').animate({
             scrollTop: ($('.has-error').offset().top - 300)
         }, 2000);
     }

 });
 //#endregion Add Click

    //#region Delete Click
    $('#btn_Delete').on('click', function (e) {
        e.preventDefault();
        $('#btn_Delete').removeClass("btn btn-success");
        $('#btn_Delete').addClass("btn btn-success btn-loaders btn-icon");
        $('#btn_Delete').html("Deleting the Record....");

        $.ajax({
            url: '@Url.Action("DeleteAafiyaFormDental", "AafiyaFormDental", new { area = "InsuranceForms" })?appId=' + @emr.appId,
            type: "POST",
            dataType: 'JSON',
            success: function (data) {
                $('#btn_Delete').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Delete').addClass("btn btn-warning");
                $('#btn_Delete').html("Delete");
                if (data.isAuthorized) {
                    if (data.success) {
                        var alertPlaceholder = document.getElementById("Alert");
                        function alert(e, t) {
                            var l = document.createElement("div");
                            l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                        }
                        alert("<i class='fe fe-check-circle text-white'></i>AafiyaFormDental Deleted Successfully!", "success");
                        clearControls();
                        Timeout();

                        $('#btn_Delete').addClass("d-none");
                        $("#pat_sign_box").addClass("d-none");


                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                            "<div class='alert alert-warning' role='alert'>" +
                            "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                            "<strong>Error!.. Failed to Delete..</strong><br/>" +
                            "</div></div>";
                        $("#error").html(html);
                    }
                }
                else {
                    var alertPlaceholder = document.getElementById("Alert");
                    function alert(e, t) {
                        var l = document.createElement("div");
                        l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                            '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                    }
                    alert("<i class='fe fe-check-circle text-white'></i> You do not have Enough Privileges to Delete this Designation!", "Access Denied!");
                }
            },
            error: function (xhr) {
                $('#btn_Delete').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Delete').addClass("btn btn-Delete");
                $('#btn_Delete').html("Delete");
                Timeout();
            }
        })
    });
//#endregion

    //#region Reset
    $('#btn_Reset_C').on('click', function (e) {
        e.preventDefault();
        clearControls();

    });
    //#endregion Reset

        //#region Print
    $('#btn_Print_C').on('click', function (e) {
        e.preventDefault();
        $('#btn_Print_C').removeClass("btn btn-sm btn-success");
        $('#btn_Print_C').addClass("btn btn-sm btn-success btn-loaders btn-icon");
        $('#btn_Print_C').html("Printing the Record....");
    $.ajax({
        type: "Get",
        url: "@Url.Action("PrintPDFConsent", "AafiyaFormDental", new {area = "InsuranceForms" })?appId=" + @emr.appId + "&form=AafiyaFormDental",
        dataType: 'JSON',
        success: function (data) {
            console.log(data)
            if (data.isAuthorized) {
                if (data.success)
                    console.log(data);
                    console.log(data.message.pdfPath); {
                    window.location.href = data.message.pdfPath
                }
            }
        },
        error: function (xhr) {
            console.log(xhr);
        }
    });
});
//#endregion Print


    //#region Clear Controls
    var clearControls = function () {
        $(".form-control").val("");
        $(".form-control-sm").val("");
        $("#pat_sign").attr("src", "");
        $("input[name='mcd_radio']:radio").prop('checked', false);
    }
    //#endregion Clear Controls

    //#region Wacom Tab Signature
        var openWacomTabSignaturePad = function (id) {
            var _data = {
                 "patId": @emr.patId,
                 "person": id,
                "form": "AafiyaFormDental",
                 "appId": @emr.appId,
                "formname":"AafiyaFormDental",
                 "formlink":"",
                 "eSign":""
             }
            $.ajax({
                type: "GET",
                url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion
   //#region Signature
    var openSignaturePad = function (id) {
    var _data = {
        "patId": @emr.patId,
        "person": id,
        "form": "AafiyaFormDental",
        "appId": @emr.appId,
        "formname":"AafiyaFormDental",
        "formlink":"",
        "eSign":""
    }
    $.ajax({
        type: "GET",
        url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
        contentType: "application/json",
        dataType: "html",
        data: _data,
        success: function (response) {
            $("#signature_pad_body").html(response);
            $("#signature_pad").modal("show");
        },
        error: function (xhr) {
            console.log("Error :" + xhr.statusText);
        }
    });
}
//#endregion Signature

$('#signature_pad').on('hidden.bs.modal', function () {
    if (localStorage.getItem("sign") != null) {
        GetSignaturename('patient');
        localStorage.removeItem("sign");
    }
});


    //#region Get Signature
    var GetSignaturename = function  (person) {
        $.ajax({
            url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=AafiyaFormDental',
            type: "GET",
            dataType: "json",
            async: false,
            success: function (response) {
                console.log(response);
                let sign = response[0].psb_sign;
                var date = moment(response[0].psb_date_modified).format("DD-MM-YYYY");

                if (response[0].person == "patient") {
                    $("#pat_sign_box").removeClass("d-none");
                    $("#psb_date_patient").html(date);
                    $("#pat_sign").attr("src", sign);
                }

            },
            error: function (xhr) {
                console.log(xhr);
                alert(xhr);
            }

        });
    };
    //#endregion Get Signature

//#region Alert Timeout
function Timeout() {
    window.setTimeout(function () {
        $(".alert").fadeTo(500, 0).slideUp(500, function () {
            $(this).remove();
        });
    }, 4200);
}
    //#endregion Alert Timeout
    //#region Load Get_Patient_signs
        var Get_Patient_signs = function () {
            $.ajax({
                type: "GET",
                url: "@Url.Action("Get_Patient_Signs", "ReimbursementForms", new { area = "EMRForms" })?appId="+@emr.appId,
                success: function (response) {
                    if (response.length > 0) {
                        var str1 = response[0].sign_bp;
                        var str2 = response[0].sign_pulse;
                        var str3 = response[0].sign_temp;
                        var str4 = response[0].sign_notes;
                        var regex = /(|<([^>]+)>)/ig;
                        $("#sign_bp").text(str1.replace(/(<p>|<\/p>)/g, ""));
                        $("#sign_pulse").text(str2.replace(/(<p>|<\/p>)/g, ""));
                        $("#sign_temp").text(str3.replace(/(<p>|<\/p>)/g, ""));
                        $("#sign_notes").text(str4.replace(/(<p>|<\/p>)/g, ""));
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });
        }
    //#endregion
      // #region Chief Complaints,Treatments,Diagnosis  page load validation

 function Get_PatientEMR() {
     let complaints = false, treatments = false, diagnosis = false;

     $.ajax({
         url: "@Url.Action("GetAllPatientTreatments", "PatientTreatments", new { area = "EMR" })?appId=" + "@emr.appId" + "&pt_type=Insurance",
         method: "GET",
         async: false,
         success: function (response) {
             console.log(response)
             if (response.length > 0) {
                 let htmlTreat = '';
                 let count = 0;

                 response.forEach(t => {
                     if (t.pt_status === "Invoiced") {
                         count++;
                         htmlTreat += `<div>${count}. ${t.tr_name}</div>`;
                     }
                 });
                 htmlTreat += '</div>';

                 if (count > 0) {
                     $('#treat_details').append(htmlTreat);
                     treatments = true;
                 }
                 else {
                     $('#treat_details').text("Nil");
                     treatments = false;
                 }
             }
             else {
                 $('#treat_details').text("Nil");
             }
         },
         error: function (xhr) {
             console.log(xhr);
         }
     });

     $.ajax({
         url: "@Url.Action("GetAllPatientDiagnosis", "PatientDiagnosis", new { area = "EMR" })?appId=" + "@emr.appId",
         method: "GET",
         async: false,
         success: function (response) {
             if (response.message.length > 0) {
                 diagnosis = true;
                 let count = 1;
                 let htmlDiag = '<div class="d-flex flex-column gap-2">';
                 let htmlDiag_code = '<div class="d-flex flex-column gap-2">';

                 response.message.forEach(d => {
                     htmlDiag += `<div>${count}. ${d.diag_name}</div>`;
                     htmlDiag_code += `<div>${count}. ${d.diag_code}</div>`;
                     count++;
                 });

                 htmlDiag += '</div>';
                 htmlDiag_code += '</div>';

                 $('#pat_Diagnosis').append(htmlDiag);
                 $('#pat_Diagnosis_code').append(htmlDiag_code);
             }
             else {
                 $('#pat_Diagnosis').text("Nil");
                 $('#pat_Diagnosis_code').text("Nil");
             }
         },
         error: function (xhr) {
             console.log(xhr);
         }
     })

     $.ajax({
         url: "@Url.Action("GetAllCheifComplaints", "CheifComplaints", new { area = "EMR" })?appId=" +@emr.appId,
         dataType: "json",
         method: "GET",
         async: false,
         success: function (response) {
             console.log(response);
             if (response.length > 0) {
                 complaints = true;
                 let count = 1;
                 let htmlcomp = '<div class="d-flex flex-column gap-2">';
                

                 response.forEach(d => {
                     htmlcomp += `<div>${count}. ${d.complaint}</div>`; 

                     count++;
                 });

                 htmlcomp += '</div>';

                 $('#complaints').append(htmlcomp);
             }
             else {
                 $('#complaints').text("Nil");
             }
         },
         error: function (xhr) {
             console.log(xhr)
         }
     });

     if (complaints && treatments && diagnosis) {
         $("#btn_Insert").show();
     }
     else {
         let missing = [];

         if (!complaints) {
             missing.push('Complaints');
         }

         if (!diagnosis) {
             missing.push('Diagnosis');
         }

         if (!treatments) {
             missing.push('Treatments');
         }

         let missingString = missing.join(", ");

         let htmlAlert = `
             <div class="alert alert-danger alert-dismissible fade show" role="alert">
                 <strong>${missingString}</strong> have not been filled yet.
                 <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">&#10006;</button>
             </div>
         `;

         $("#alert_form").append(htmlAlert);
         $("#btn_Insert").hide();
     }
 }

 // #region Chief Complaints,Treatments,Diagnosis  page load validation
</script>
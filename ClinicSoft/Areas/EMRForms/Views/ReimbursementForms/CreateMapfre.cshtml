@model BusinessEntities.EMRForms.Mapfre
@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}

<form id="form_MapfreDecision" autocomplete="off" name="Mapfre" ondrop="return false;" onpaste="return false;" oncut="return false;" class="fs-14">
    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.maprId, new { @id = "maprId", @value = "@Model.maprId" })

    <!-- Row-->
    <div class="row">
        <div class="col-lg-12 col-xl-12 col-md-12 text-justify col-sm-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title text-red font-weight-bold">1. INSURED/PATIENT’S DETAILS</h5>
                </div>
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-4 form-label">
                                    Title
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @Html.TextBoxFor(m => m.mapr_1, new { @class = "form-control", @id = "mapr_1", @maxlength = "50" })
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-4 form-label">
                                    (Sur)name of policyholder
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @Html.TextBoxFor(m => m.mapr_2, new { @class = "form-control", @id = "mapr_2", @maxlength = "50" })
                                </div>
                            </div>
                        </div>

                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-4 form-label">
                                    I.D. card no.
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @Html.TextBoxFor(m => m.mapr_3, new { @class = "form-control mb-1", @id = "mapr_3", @maxlength = "50" })
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-4 form-label">Date of birth of policyholder</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <div class="input-group-text">
                                                <i class="fe fe-calendar"></i>
                                            </div>
                                        </div>
                                        @Html.TextBoxFor(m => m.mapr_date1, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "mapr_date1" })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-4 form-label">
                                    Title
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @Html.TextBoxFor(m => m.mapr_4, new { @class = "form-control", @id = "mapr_4", @maxlength = "50" })
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-4 form-label">
                                    (Sur)name of policyholder
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @Html.TextBoxFor(m => m.mapr_5, new { @class = "form-control", @id = "mapr_5", @maxlength = "50" })
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-4 form-label">
                                    I.D. card no.
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @Html.TextBoxFor(m => m.mapr_6, new { @class = "form-control mb-1", @id = "mapr_6", @maxlength = "50" })
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-4 form-label">Date of birth of policyholder</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <div class="input-group-text">
                                                <i class="fe fe-calendar"></i>
                                            </div>
                                        </div>
                                        @Html.TextBoxFor(m => m.mapr_date2, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "mapr_date2" })
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-12 ps-0">
                                <label class="col-md-4 col-lg-2 form-label">
                                    Address
                                </label>
                                <div class="d-flex align-items-center  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6 col-lg-7">
                                    @Html.TextBoxFor(m => m.mapr_7, new { @class = "form-control", @id = "mapr_7", @maxlength = "50" })
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-4 form-label">
                                    Telephone
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @Html.TextBoxFor(m => m.mapr_8, new { @class = "form-control mb-1", @id = "mapr_8", @maxlength = "50" })
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-4 form-label">	Policy no.</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @Html.TextBoxFor(m => m.mapr_9, new { @class = "form-control", @id = "mapr_9", @maxlength = "50" })
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-12 ps-0">
                                <label class="col-md-4 col-lg-2 form-label">
                                    Email
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6 col-lg-7">
                                    @Html.TextBoxFor(m => m.mapr_10, new { @class = "form-control", @id = "mapr_10", @maxlength = "50" })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-header">
                    <h5 class="card-title text-red font-weight-bold">2. TO BE COMPLETED BY THE PATIENT/LEGAL GUARDIAN</h5>
                </div>
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Reason for seeking medical advice
                            </label>
                            <div class="col-md-6 col-lg-8">
                                @Html.TextBoxFor(m => m.mapr_11, new { @class = "form-control", @id = "mapr_11", @maxlength = "50" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Date of patient’s first visit to any doctor for this condition
                            </label>
                            <div class="col-md-6 col-lg-8">
                                <div class="input-group col-lg-4">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">
                                            <i class="fe fe-calendar"></i>
                                        </div>
                                    </div>
                                    @Html.TextBoxFor(m => m.mapr_date3, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "mapr_date3" })
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Did treatment require in-patient treatment?
                            </label>
                            <div class="col-md-3 col-lg-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="car_checkbox[1]" value="1">
                                    <span class="custom-control-label">Yes</span>
                                </label>
                            </div>
                            <div class="col-md-3 col-lg-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="car_checkbox[1]" value="2">
                                    <span class="custom-control-label">No</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-12 col-lg-4 form-label">
                                If the answer is “YES” please advise:
                            </label>
                            <label class="col-md-6 col-lg-2 form-label">
                                Admission date:
                            </label>

                            <div class="input-group col-md-6 col-lg-2 mb-1">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <i class="fe fe-calendar"></i>
                                    </div>
                                </div>
                                @Html.TextBoxFor(m => m.mapr_date4, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "mapr_date4" })
                            </div>
                            <label class="col-md-6 col-lg-2 form-label">
                                Discharge date:
                            </label>
                            <div class="input-group col-md-6 col-lg-2">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <i class="fe fe-calendar"></i>
                                    </div>
                                </div>
                                @Html.TextBoxFor(m => m.mapr_date5, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "mapr_date5" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-12 form-label">
                                Attach hospital certificate(s) (if applicable)
                            </label>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Are any of the costs recoverable from a third party?
                            </label>
                            <div class="col-md-3 col-lg-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="car_checkbox[3]" value="3">
                                    <span class="custom-control-label">Yes</span>
                                </label>
                            </div>
                            <div class="col-md-3 col-lg-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="car_checkbox[3]" value="4">
                                    <span class="custom-control-label">No</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                If “YES”, give details
                            </label>
                            <div class="col-md-12">
                                @Html.TextAreaFor(m => m.mapr_12, new { @class = "form-control", @placeholder = "Please specify", @row = "2", @id = "mapr_12" })
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-header">
                    <h5 class="card-title text-red font-weight-bold">3. TO BE COMPLETED BY A REGISTERED MEDICAL OR DENTAL PRACTITIONER</h5>
                </div>
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="form-group row">
                            <label class="col-md-4 form-label">
                                Name patient(s)
                            </label>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_name&nbsp;</span>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Details of the medical condition/symptoms
                            </label>
                            <div class="col-md-6 col-lg-8">
                                @Html.TextBoxFor(m => m.mapr_13, new { @class = "form-control", @id = "mapr_13", @maxlength = "50" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Diagnosis
                            </label>
                            <div class="col-md-6 col-lg-8">
                                @Html.TextBoxFor(m => m.mapr_14, new { @class = "form-control", @id = "mapr_14", @maxlength = "50" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Date of first consultation with the GP for this medical condition:
                            </label>
                            <div class="input-group col-md-6 col-lg-2">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <i class="fe fe-calendar"></i>
                                    </div>
                                </div>
                                @Html.TextBoxFor(m => m.mapr_date6, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "mapr_date6" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Treatment given
                            </label>
                            <div class="col-md-6 col-lg-8">
                                @Html.TextBoxFor(m => m.mapr_15, new { @class = "form-control", @id = "mapr_15", @maxlength = "50" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Treatment recommended
                            </label>
                            <div class="col-md-6 col-lg-8">
                                @Html.TextBoxFor(m => m.mapr_16, new { @class = "form-control", @id = "mapr_16", @maxlength = "50" })
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Does the patient require further treatment from a specialist?
                            </label>
                            <div class="col-md-6 col-lg-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="car_checkbox[5]" value="5">
                                    <span class="custom-control-label">Yes</span>
                                </label>
                            </div>
                            <div class="col-md-6 col-lg-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="car_checkbox[5]" value="6">
                                    <span class="custom-control-label">No</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-4 form-label">
                                Date
                            </label>
                            <div class="input-group col-md-6 col-lg-2">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <i class="fe fe-calendar"></i>
                                    </div>
                                </div>
                                @Html.TextBoxFor(m => m.mapr_date7, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "mapr_date7" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Signature of General Practitioner
                            </label>
                            <div class="col-md-12">
                                <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-header">
                    <h5 class="card-title text-red font-weight-bold">4. TO BE COMPLETED BY A SPECIALIST</h5>
                </div>
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="form-group row">
                            <label class="col-md-4 form-label">
                                Name patient(s)
                            </label>
                            <div class="col-md-8">
                                <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_name&nbsp;</span>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-4 form-label">
                                Details of the medical condition/symptoms
                            </label>
                            <div class="col-md-8">
                                @Html.TextBoxFor(m => m.mapr_17, new { @class = "form-control", @id = "mapr_17", @maxlength = "50" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-4 form-label">
                                Diagnosis
                            </label>
                            <div class="col-md-8">
                                @Html.TextBoxFor(m => m.mapr_18, new { @class = "form-control", @id = "mapr_18", @maxlength = "50" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-4 form-label">
                                Treatment given
                            </label>
                            <div class="col-md-8">
                                @Html.TextBoxFor(m => m.mapr_19, new { @class = "form-control", @id = "mapr_19", @maxlength = "50" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-4 form-label">
                                Treatment recommended
                            </label>
                            <div class="col-md-8">
                                @Html.TextBoxFor(m => m.mapr_20, new { @class = "form-control", @id = "mapr_20", @maxlength = "50" })
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-4 form-label">
                                Does the patient require further treatment from a specialist?
                            </label>
                            <div class="col-md-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="car_checkbox[5]" value="5">
                                    <span class="custom-control-label">Yes</span>
                                </label>
                            </div>
                            <div class="col-md-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="car_checkbox[5]" value="6">
                                    <span class="custom-control-label">No</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-4 form-label">
                                Date
                            </label>
                            <div class="input-group col-md-4 col-lg-2">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <i class="fe fe-calendar"></i>
                                    </div>
                                </div>
                                @Html.TextBoxFor(m => m.mapr_date8, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "mapr_date8" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Signature of General Specialist
                            </label>
                            <div class="col-md-12">
                                <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-header">
                    <h5 class="card-title text-red font-weight-bold">DECLARATION</h5>
                </div>
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="form-group row">
                            <p class="text-black text-justify">
                                I authorise MAPFRE Middlesea p.l.c. to share information with others (including insurers and Insurance Associations) in order to prevent
                                fraudulent claims. I declare that all the answers given and the statements made are true and correct. Furthermore I declare that I have not
                                withheld any information relevant to the claim. I give explicit and unequivocal consent to MAPFRE Middlesea p.l.c. to seek any information
                                from any doctor, surgeon, hospital, clinic, laboratory or persons that have records or knowledge of my health in order for the validity of
                                the claims to be established.
                            </p>
                            <p class="text-black text-justify">
                                I hereby authorise any doctor, surgeon, hospital, clinic, laboratory or persons that have records to provide full medical information
                                concerning myself and my dependants.
                            </p>
                            <p class="text-black text-justify">
                                I give consent to MAPFRE Middlesea p.l.c. to process my personal data supplied by myself or any person, body or entity in order to process,
                                handle and settle the claim.
                            </p>
                            <p class="text-black text-justify">
                                I authorise MAPFRE Middlesea p.l.c. to share information with others (including insurers and Insurance Associations) in order to prevent
                                fraudulent claims. I declare that all the answers given and the statements made are true and correct. Furthermore I declare that I have not
                                withheld any information relevant to the claim. I give explicit and unequivocal consent to MAPFRE Middlesea p.l.c. to seek any information
                                from any doctor, surgeon, hospital, clinic, laboratory or persons that have records or knowledge of my health in order for the validity of
                                the claims to be established
                            </p>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-8">
                                <div id="patimg" class="col-md-3"><img alt="Signature" src="" id="pat_sign" class="avatar avatar-xxl bsquare" /></div>
                                <label class="form-label">
                                    Patient’s signature (If the patient is under 18 years of age, then the legal guardian must sign):
                                </label>
                            </div>
                            <div class="col-md-4">
                                <div>
                                    <label class="form-label text-red text-left" id="psb_date_witness" name="">&nbsp;</label>
                                </div>
                                <label class="form-label">
                                    Date
                                </label>
                            </div>
                        </div>
                    </div>
                </div><div class="card-header">
                    <h5 class="card-title text-red font-weight-bold">DATA PROTECTION</h5>
                </div>
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="form-group row">
                            <p class="text-black text-justify">
                                MAPFRE Middlesea p.l.c. is legally bound to follow the provisions of the Data Protection Act, 2001. MAPFRE Middlesea p.l.c. is registered
                                with the Office of the Commissioner for Data Protection to process data in accordance with this Act. The Data Protection Policy of MAPFRE
                                Middlesea p.l.c. is compliant with this Act, a copy of which is available on request.
                            </p>
                            <p class="text-black text-justify">
                                MAPFRE Middlesea p.l.c. (C-5553) is authorised by the Malta Financial Services Authority to carry on both Long Term and General Business
                                under the Insurance Business Act, 1998
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Row -->

    <div class="row ">
        <div class="row mt-2">
            <div class="col-sm-12 col-md-12 col-lg-12 text-center">
                <div class="btn-list btn-animation">
                    <button type="submit" class="btn btn-success" id="btn_Insert_Mapfre">Save</button>
                    <button type="button" class="btn btn-outline-dark" id="btn_Reset_Mapfre">Reset</button>
                    <div class="btn-group mr-2">
                        <div class="dropdown">
                            <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" onclick="openSignaturePad('patient')">Tab</a>
                                <a class="dropdown-item" onclick="openWacomTabSignaturePad('patient')">Wacom Tab</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="warningMessage" class="text-danger" style="display: none;">Please fill in at least one field before submitting.</div>
            </div>
        </div>
    </div>

</form>

<script type="text/javascript">
    //#region Page Load
        var formName1 = $(form_MapfreDecision).closest('form').attr('name');
        $(function () {
            set_date();
            validate();
        });
    //#endregion

    //#region Load set Date
        var set_date = function () {
            $('#mapr_date1,#mapr_date2,#mapr_date3,#mapr_date4').bootstrapdatepicker({
                format: "dd-MM-yyyy",
                viewMode: "date",
                todayHighlight: true,
                autoclose: true,
                multidate: false,
                multidateSeparator: "-"
            });
            $("#mapr_date1,#mapr_date2,#mapr_date3,#mapr_date4").bootstrapdatepicker("setDate", '');
            $('#mapr_date5,#mapr_date6,#mapr_date7,#mapr_date8').bootstrapdatepicker({
                format: "dd-MM-yyyy",
                viewMode: "date",
                todayHighlight: true,
                autoclose: true,
                multidate: false,
                multidateSeparator: "-"
            });
            $("#mapr_date5,#mapr_date6,#mapr_date7,#mapr_date8").bootstrapdatepicker("setDate", '');
        }
    //#endregion

    //#region Function to check if any field is filled
        function isAnyFieldFilledOrSelected() {
            var isFilledOrSelected = false;

            // Check input fields
            $('.form-control').each(function () {
                if ($(this).val().trim() !== '') {
                    isFilledOrSelected = true;
                    return false; // Exit the loop if any input field is filled
                }
            });

            // Check checkboxes and radio buttons
            $('input[type="checkbox"], input[type="radio"]').each(function () {
                if ($(this).is(':checked')) {
                    isFilledOrSelected = true;
                    return false; // Exit the loop if any checkbox or radio button is selected
                }
            });

            return isFilledOrSelected;
        }
    //#endregion

    //#region Validation Initialization
        var validate = function () {

            $('#mapr_date1').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });
            $('#mapr_date2').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });

            $('#mapr_date3').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });
            $('#mapr_date4').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });
            $('#mapr_date5').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });
            $('#mapr_date6').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });
            $('#mapr_date7').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });
            $('#mapr_date8').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });

        }
    //#endregion

    $('#signature_pad').on('hidden.bs.modal', function () {
        if (localStorage.getItem("sign") != null) {
            GetSignaturename('patient');
            localStorage.removeItem("sign");
        }
    });

    //#region Get Signature
        var GetSignaturename = function  (person) {
            $.ajax({
                url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=' + formName1,
                type: "GET",
                dataType: "json",
                async: false,
                success: function (response) {
                    let sign = response[0].psb_sign;
                    var date = moment(response[0].psb_date_modified).format("DD-MM-YYYY HH:mm");
                    if (response[0].person == "patient") {
                        $("#patimg").show();
                        $("#pat_sign").attr("src", sign);
                        $("#pat_sign").removeClass("avatar avatar-xxl bsquare");
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                    alert(xhr);
                }

            });
        };
    //#endregion

    //#region Wacom Tab Signature
        var openWacomTabSignaturePad = function (id) {
            var _data = {
                "patId": @emr.patId,
                "person": id,
                "form": "Mapfre",
                "appId": @emr.appId,
                "formname":"Mapfre",
                "formlink":"PrintMapfre",
                "eSign":""
            }
            $.ajax({
                type: "GET",
                url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion

    //#region Signature
        var openSignaturePad = function (id) {
            var _data = {
                "patId": @emr.patId,
                "person": id,
                "form": "Mapfre",
                "appId": @emr.appId,
                "formname":"Mapfre",
                "formlink":"PrintMapfre",
                "eSign":""
            }
            $.ajax({
                type: "GET",
                url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion

    //#region Alert Timeout
        function Timeout() {
            window.setTimeout(function () {
                $(".alert").fadeTo(500, 0).slideUp(500, function () {
                    $(this).remove();
                });
            }, 4200);
        }
    //#endregion

    //#region Reset
        $('#btn_Reset_Mapfre').on('click', function (e) {
            e.preventDefault();
            clearControls();
        });
    //#endregion

    //#region Clear Controls
        var clearControls = function () {
        $("#mapr_1").val("");
        $("#mapr_2").val("");
        $("#mapr_3").val("");
        $("#mapr_4").val("");
        $("#mapr_5").val("");
        $("#mapr_6").val("");
        $("#mapr_7").val("");
        $("#mapr_8").val("");
        $("#mapr_9").val("");
        $("#mapr_10").val("");
        $("#mapr_11").val("");
        $("#mapr_12").val("");
        $("#mapr_13").val("");
        $("#mapr_14").val("");
        $("#mapr_15").val("");
        $("#mapr_16").val("");
        $("#mapr_17").val("");
        $("#mapr_18").val("");
        $("#mapr_19").val("");
        $("#mapr_20").val("");
        $("#mapr_date1").bootstrapdatepicker("setDate", '');
        $("#mapr_date2").bootstrapdatepicker("setDate", '');
        $("#mapr_date3").bootstrapdatepicker("setDate", '');
        $("#mapr_date4").bootstrapdatepicker("setDate", '');
        $("#mapr_date5").bootstrapdatepicker("setDate", '');
        $("#mapr_date6").bootstrapdatepicker("setDate", '');
        $("#mapr_date7").bootstrapdatepicker("setDate", '');
        $("#mapr_date8").bootstrapdatepicker("setDate", '');
        var elements = document.getElementsByClassName('custom-control-input');
        Array.prototype.forEach.call(elements, function (element) {
            element.checked = false;
        });
    }
    //#endregion

    //#region Insert Button Click
        $('#btn_Insert_Mapfre').on('click', function (e) {
            e.preventDefault();
            if (isAnyFieldFilledOrSelected()) {
               if ($("#form_MapfreDecision").valid()) {
                    $('#btn_Insert_Mapfre').removeClass("btn btn-success");
                    $('#btn_Insert_Mapfre').addClass("btn btn-success btn-loaders btn-icon");
                    $('#btn_Insert_Mapfre').html("Saving the Record....");
                    var mapr_chkbox = "";
                    $('.custom-control-input:checked').each(function (index) {
                        mapr_chkbox = mapr_chkbox + ',' + $(this).val();
                    });
                    var mapr_checkbox = mapr_chkbox.substring(1);
                    var _dataInsert = {
                    "maprId": 0,
                    "mapr_appId": @emr.appId,
                    "mapr_chk": mapr_checkbox,
                    "mapr_1": $("#mapr_1").val(),
                    "mapr_2": $("#mapr_2").val(),
                    "mapr_3": $("#mapr_3").val(),
                    "mapr_4": $("#mapr_4").val(),
                    "mapr_5": $("#mapr_5").val(),
                    "mapr_6": $("#mapr_6").val(),
                    "mapr_7": $("#mapr_7").val(),
                    "mapr_8": $("#mapr_8").val(),
                    "mapr_9": $("#mapr_9").val(),
                    "mapr_10": $("#mapr_10").val(),
                    "mapr_11": $("#mapr_11").val(),
                    "mapr_12": $("#mapr_12").val(),
                    "mapr_13": $("#mapr_13").val(),
                    "mapr_14": $("#mapr_14").val(),
                    "mapr_15": $("#mapr_15").val(),
                    "mapr_16": $("#mapr_16").val(),
                    "mapr_17": $("#mapr_17").val(),
                    "mapr_18": $("#mapr_18").val(),
                    "mapr_19": $("#mapr_19").val(),
                    "mapr_20": $("#mapr_20").val(),
                    "mapr_date1": moment($("#mapr_date1").val()).format("YYYY-MM-DD"),
                    "mapr_date2": moment($("#mapr_date2").val()).format("YYYY-MM-DD"),
                    "mapr_date3": moment($("#mapr_date3").val()).format("YYYY-MM-DD"),
                    "mapr_date4": moment($("#mapr_date4").val()).format("YYYY-MM-DD"),
                    "mapr_date5": moment($("#mapr_date5").val()).format("YYYY-MM-DD"),
                    "mapr_date6": moment($("#mapr_date6").val()).format("YYYY-MM-DD"),
                    "mapr_date7": moment($("#mapr_date7").val()).format("YYYY-MM-DD"),
                    "mapr_date8": moment($("#mapr_date8").val()).format("YYYY-MM-DD"),
                    "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
                    }
                    console.log(_dataInsert);
                $.ajax({
                type: "POST",
                url: "@Url.Action("InsertMapfre", "ReimbursementForms", new { area = "EMRForms" })",
                dataType: 'JSON',
                data: _dataInsert,
                success: function (data) {
                $('#btn_Insert_Mapfre').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Insert_Mapfre').addClass("btn btn-success");
                $('#btn_Insert_Mapfre').html("Add");

                if (data.isSuccess) {
                if (data.isInserted) {
                GetMapfre();
                var alertPlaceholder = document.getElementById("Alert");
                function alert(e, t) {
                    var l = document.createElement("div");
                    l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" role="alert">' + e +
                        '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                }
                alert("<i class='fe fe-check-circle text-white'></i> Mapfre Claim Form Added Successfully!", "success");
                Timeout();
                Editmapfre()
                }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                            "<div class='alert alert-light-warning' role='alert'>" +
                            "<button type='button' class='btn-close text-warning' style='margin-bottom:-5px;' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                            "<strong><i class='fa fa-exclamation-triangle text-warning'></i> Mapfre Claim Form Alredy Exists!</strong><br/>" +
                            "</div></div>";
                        $("#error").html(html);
                    }
                }
                else {
                let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                    "<div class='alert alert-light-danger' role='alert'>" +
                    "<button type='button' class='btn-close text-danger' style='margin-bottom:-5px;' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                    "<strong><i class='fa fa-ban text-danger'></i> Validation Error! Please validate before submitting.&nbsp;</strong><br/><ul>";

                $.each(data.message, function (index, value) {
                    html += "<li><small>" + value + "</small><li>";
                    var elem = $("#" + index);
                    if (elem.hasClass("select2-hidden-accessible")) {
                        $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                    }
                    else {
                        $(elem).addClass(" is-invalid");
                    }

                    setTimeout(function () {
                        if (elem.hasClass("select2-hidden-accessible")) {
                            $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                        }
                        else {
                            $(elem).removeClass("is-invalid");
                        }
                    }, 5000);
                });
                html += "</ul></div></div>";
                $("#error").html(html);
                }
                },
                error: function (xhr) {
                $('#btn_Insert_Mapfre').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Insert_Mapfre').addClass("btn btn-success");
                $('#btn_Insert_Mapfre').html("Add");
                Timeout();
                }
                });
                }
                else {
                    $('.modal-body').animate({
                        scrollTop: ($('.has-error').offset().top - 300)
                    }, 2000);
                }
            } else {
                // Show a message box or alert indicating that at least one field must be filled
                //alert('Please fill in at least one field before submitting.');
                $('#warningMessage').show();
                // Prevent form submission
                return false;
            }

        });
    //#endregion
</script>
<style>
    #warningMessage {
        color: red;
        background-color: #ffe6e6;
        font-size: 16px;
        padding: 10px;
        margin: 10px 0;
        font-weight: bold;
        text-align: center;
        border: 1px solid red;
        border-radius: 5px;
        display: block;
        transition: display 0.5s ease-in-out;
    }
</style>

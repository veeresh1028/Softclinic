@model BusinessEntities.EMRForms.MSH
@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}
<div class="modal-body p-4">
    <form id="form_MSHDecision" class="fs-14" autocomplete="off" name="MSH" ondrop="return false;" onpaste="return false;" oncut="return false;">
        @Html.AntiForgeryToken()
        @Html.HiddenFor(m => m.cmr_Id, new { @id = "cmr_Id", @value = "@Model.cmr_Id" })
        @*<div class="row">
                <div class="text-center">
                    <img src="~/images/Reimbursement_Forms/msh_1.png"/>
                </div>
            </div>*@
        <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-12">
                <label class="form-label mb-2 text-danger">
                    TO BE COMPLETED BY THE EMPLOYEE
                </label>
            </div>
            <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                <div class="col-sm-12 col-md-6 col-lg-4 ps-0">
                    <label class="form-label ">
                        Patient Name
                    </label>
                </div>
                <div class="d-flex  justify-content-center w-8  form-label">
                    :
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    @if (@emr.pat_name != "")
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_name&nbsp;</span>
                    }
                    else
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                    }
                </div>
            </div>
            <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                <div class="col-sm-12 col-md-6 col-lg-4 ps-0">
                    <label class="form-label ">
                        Group Name
                    </label>
                </div>
                <div class="d-flex  justify-content-center w-8  form-label">
                    :
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    @Html.TextBoxFor(m => m.cmr_groupname, new { @class = "form-control", @id = "cmr_groupname", @width = "20px", @maxlength = "20" })
                </div>
            </div>
            <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                <div class="col-sm-12 col-md-6 col-lg-4 ps-0">
                    <label class="form-label ">
                        Date of Birth
                    </label>
                </div>
                <div class="d-flex  justify-content-center w-8  form-label">
                    :
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    @if (@emr.pat_dob != "")
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_dob&nbsp;</span>
                    }
                    else
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                    }
                </div>
            </div>
            <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                <div class="col-sm-12 col-md-6 col-lg-4 ps-0">
                    <label class="form-label ">
                        Policy Number
                    </label>
                </div>
                <div class="d-flex  justify-content-center w-8  form-label">
                    :
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    @if (@emr.pi_insno != "")
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pi_insno&nbsp;</span>
                    }
                    else
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                    }
                </div>
            </div>
            <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                <div class="col-sm-12 col-md-6 col-lg-4 ps-0">
                    <label class="form-label ">
                        Street Address
                    </label>
                </div>
                <div class="d-flex  justify-content-center w-8  form-label">
                    :
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    @if (@emr.pat_address != "")
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_address&nbsp;</span>
                    }
                    else
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                    }
                </div>
            </div>
            <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                <div class="col-sm-12 col-md-6 col-lg-4 ps-0">
                    <label class="form-label ">
                        City
                    </label>
                </div>
                <div class="d-flex  justify-content-center w-8  form-label">
                    :
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    @if (@emr.pat_city != "")
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_city&nbsp;</span>
                    }
                    else
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                    }
                </div>
            </div>
            <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                <div class="col-sm-12 col-md-6 col-lg-4 ps-0">
                    <label class="form-label ">
                        Postal/Zip Code
                    </label>
                </div>
                <div class="d-flex  justify-content-center w-8  form-label">
                    :
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    @if (@emr.pat_pobox != "")
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_pobox&nbsp;</span>
                    }
                    else
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                    }
                </div>
            </div>
            <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                <div class="col-sm-12 col-md-6 col-lg-4 ps-0">
                    <label class="form-label ">
                        Email
                    </label>
                </div>
                <div class="d-flex  justify-content-center w-8  form-label">
                    :
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    @if (@emr.pat_email != "")
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_email&nbsp;</span>
                    }
                    else
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                    }
                </div>
            </div>
            <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                <div class="col-sm-12 col-md-6 col-lg-4 ps-0">
                    <label class="form-label ">
                        Phone (include country code)
                    </label>
                </div>
                <div class="d-flex  justify-content-center w-8  form-label">
                    :
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    @if (@emr.pat_mob != "")
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_mob&nbsp;</span>
                    }
                    else
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                    }
                </div>
            </div>
            <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                <div class="col-sm-12 col-md-6 col-lg-4 ps-0">
                    <label class="form-label ">
                        Phone (include country code)
                    </label>
                </div>
                <div class="d-flex  justify-content-center w-8  form-label">
                    :
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    @if (@emr.pat_mob != "")
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_mob&nbsp;</span>
                    }
                    else
                    {
                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                    }
                </div>
            </div>
        </div>
        <div class="row ">
            <div class="col-sm-12 col-md-12 col-lg-12">
                <label class="form-label mb-2 text-danger">
                    CLAIM INFORMATION
                </label>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-12">
                <p class="text-black text-justify">
                    All claims must be supported by original documents. Receipts must indicate the date the expense was incurred, the person for whom the service was provided,
                    who prescribed or provided the service or supply, and the nature of the service or supply. Unless otherwise specified, all claim cheques will be
                    payable to the Employee, and mailed to his or her address as indicated above.
                </p>
                <p class="text-black text-justify">
                    LIST OF EXPENSES (Each expense must be listed separately. If more space is required, please attach another page)
                </p>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-12">
                <div class="table-responsive">
                    <table id="tbl_Treatment" class="table table-striped table-bordered text-nowrap" style="width: 100%; cursor: pointer;">
                        <thead>
                            <tr style="color: #fff !important; background-color: #808080; border-color: #3C457D; ">
                                <th class="border-bottom-0 font-weight-semibold text-white">Patient Name</th>
                                <th class="border-bottom-0 font-weight-semibold text-white">Relationship to Employee</th>
                                <th class="border-bottom-0 font-weight-semibold text-white">Date of Service YR/MM/DD</th>
                                <th class="border-bottom-0 font-weight-semibold text-white">Health Expenses<span class="text-danger">*</span></th>
                                <th class="border-bottom-0 font-weight-semibold text-white">Dental Expenses<span class="text-danger">*</span></th>
                                <th class="border-bottom-0 font-weight-semibold text-white">Amount Charged</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_name&nbsp;</span>
                                </td>
                                <td>
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_contact_role&nbsp;</span>
                                </td>
                                <td>
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.app_fdate&nbsp;</span>
                                </td>
                                <td>
                                    @Html.TextBoxFor(m => m.cmr_health, new { @class = "form-control", @id = "cmr_health", @placeholder = "Ex: 250.00" })
                                </td>
                                <td>
                                    @Html.TextBoxFor(m => m.cmr_dental, new { @class = "form-control", @id = "cmr_dental", @placeholder = "Ex: 250.00" })
                                </td>
                                <td>
                                    @Html.TextBoxFor(m => m.cmr_amount, new { @class = "form-control", @id = "cmr_amount", @placeholder = "Ex: 250.00" })
                                </td>
                            </tr>
                            <tr>
                                <td colspan="5">TOTAL AMOUNT CLAIMED FOR ALL SERVICES (INCLUDING CURRENCY):</td>
                                <td>
                                    @Html.TextBoxFor(m => m.cmr_total, new { @class = "form-control", @id = "cmr_total", @placeholder = "Ex: 250.00" })
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-12">
                <p class="text-black text-justify">
                    *Claim only the total amount, minus any amount already paid by a medical and/or dental plan.
                </p>
                <p class="text-black text-justify">
                    At MSH INTERNATIONAL, we recognize and respect the importance of privacy. When you submit a claim, the insurers establish a confidential file that is kept
                    in the offices of the insurers or the offices of an organization authorized by the insurers. We limit access to information in your file to insurer staff
                    and/or the insurers who require it to perform their duties, to persons to whom you have granted access, and to persons authorized by law. We use this
                    information for the purpose of assessing your claim and administering the group benefits plan. Personal information is protected from unauthorized use
                    and disclosure in accordance with the Freedom of Information and Protection of Privacy Act. I also give MSH INTERNATIONAL permission to send communications
                    pertaining to my claims and the administration of my group benefits plan to the email I supply on this claim form.
                </p>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-12 d-flex">
                <label class="custom-control custom-radio">
                    <input type="radio" class="custom-control-input" name="cmr_checkbox[1]" value="1">
                    <span class="custom-control-label">Accept</span>
                </label>
                <label class="custom-control custom-radio">
                    <input type="radio" class="custom-control-input" name="cmr_checkbox[1]" value="2">
                    <span class="custom-control-label">Not Accept</span>
                </label>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-6 mt-2 ">
                <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                <label class="form-label mb-2 text-danger">
                    Doctor signature
                </label>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-6 mt-2 ">
                <span class="font-weight-normal1 text-uppercase text-left">@emr.app_fdate&nbsp;</span>
                <label class="form-label mb-2 text-danger">
                    Date
                </label>
            </div>
        </div>

        <div class="row ">
            <div class="row mt-2">
                <div class="col-sm-12 col-md-12 col-lg-12 text-center">
                    <div class="btn-list btn-animation">
                        <button type="submit" class="btn btn-success" id="btn_Insert_MSH">Add</button>
                        <button type="button" class="btn btn-outline-dark" id="btn_Reset_MSH">Reset</button>
                        <button type="button" class="btn btn-outline-danger me-1" id="btn_Close_MSH" style="display:none">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </form>
</div>
@*@section myScripts{*@
<script type="text/javascript">
    //#region Page Load
        var formName1 = $(form_MSHDecision).closest('form').attr('name');
        $(function () {
            validate();
        });
    //#endregion

    //#region Validation Initialization
        var validate = function () {
            $("#form_MSHDecision").validate({
                rules: {
                    cmr_health: {
                        required: true
                    },
                    cmr_dental: {
                        required: true
                    },
                },
                messages: {
                    cmr_health: {
                        required: "Please Enter Health Expences!"
                    },
                    cmr_dental: {
                        required: "Please Enter Dental Expences!"
                    },
                },
                highlight: function (element) {
                    var elem = $(element);
                    $(element).parent().addClass('has-error');
                    //error_timeout(elem.attr("id"));
                },
                unhighlight: function (element) {
                    var elem = $(element);
                    $(element).parent().removeClass('has-error');
                },
                errorElement: 'span',
                errorClass: 'text-danger fw-bold',
                errorPlacement: function (error, element) {
                    var elem = $(element);
                    if (element.parent('.input-group').length) {
                        error.insertAfter(element.parent());
                    } else {
                        error.insertAfter(element);
                    }
                }
            });

            $('#cmr_health').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                var inputValue = $(this).val() + String.fromCharCode(charCode);

                if (String.fromCharCode(charCode).match(/[^0-9.]/g)) {
                    return false;
                }

                if (parseFloat(inputValue) > 1000000) {
                    return false;
                }
            });
            $("#cmr_health").on('input', function () {
                var disc = $(this).val();
                if (disc == "" || disc == null || disc == undefined) {
                    $("#cmr_health").val(0.00);
                }
            });
            $('#cmr_dental').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                var inputValue = $(this).val() + String.fromCharCode(charCode);

                if (String.fromCharCode(charCode).match(/[^0-9.]/g)) {
                    return false;
                }

                if (parseFloat(inputValue) > 1000000) {
                    return false;
                }
            });
            $("#cmr_dental").on('input', function () {
                var disc = $(this).val();
                if (disc == "" || disc == null || disc == undefined) {
                    $("#cmr_dental").val(0.00);
                }
            });

        }
    //#endregion

    //#region Alert Timeout
        function Timeout() {
            window.setTimeout(function () {
                $(".alert").fadeTo(500, 0).slideUp(500, function () {
                    $(this).remove();
                });
            }, 4200);
        }
    //#endregion

    //#region Reset
        $('#btn_Reset_MSH').on('click', function (e) {
            e.preventDefault();
            clearControls();
        });
    //#endregion

    //#region Clear Controls
        var clearControls = function () {
            $("#cmr_groupname").val("");
            $("#cmr_health").val("");
            $("#cmr_dental").val("");
            $("#cmr_amount").val("");
            $("#cmr_total").val("");
        }
    //#endregion

    //#region Insert Button Click
        $('#btn_Insert_MSH').on('click', function (e) {
            e.preventDefault();
            if ($("#form_MSHDecision").valid()) {
                $('#btn_Insert_MSH').removeClass("btn btn-success");
                $('#btn_Insert_MSH').addClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Insert_MSH').html("Saving the Record....");
                var car_chkbox = "";
                $('.custom-control-input:checked').each(function (index) {
                    car_chkbox = car_chkbox + ',' + $(this).val();
                });
                var cmr_checkbox = car_chkbox.substring(1);
                var _dataInsert = {
                "cmr_Id": 0,
                "cmr_appId": @emr.appId,
                "cmr_checkbox": cmr_checkbox,
                "cmr_groupname": $("#cmr_groupname").val(),
                "cmr_health": $("#cmr_health").val(),
                "cmr_dental": $("#cmr_dental").val(),
                "cmr_amount": $("#cmr_amount").val(),
                "cmr_total": $('#cmr_total').val(),
                "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
                }
                console.log(_dataInsert);
            $.ajax({
            type: "POST",
            url: "@Url.Action("InsertMSH", "ReimbursementForms", new { area = "EMRForms" })",
            dataType: 'JSON',
            data: _dataInsert,
            success: function (data) {
            $('#btn_Insert_MSH').removeClass("btn btn-success btn-loaders btn-icon");
            $('#btn_Insert_MSH').addClass("btn btn-success");
            $('#btn_Insert_MSH').html("Add");

            if (data.isSuccess) {
            if (data.isInserted) {
            GetMSH();
            var alertPlaceholder = document.getElementById("Alert");
            function alert(e, t) {
                var l = document.createElement("div");
                l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" role="alert">' + e +
                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
            }
            alert("<i class='fe fe-check-circle text-white'></i> MSH Claim Form Added Successfully!", "success");
            Timeout();
            EditMSH();
            }
            else {
                let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                    "<div class='alert alert-light-warning' role='alert'>" +
                    "<button type='button' class='btn-close text-warning' style='margin-bottom:-5px;' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                    "<strong><i class='fa fa-exclamation-triangle text-warning'></i> MSH Claim Form Alredy Exists!</strong><br/>" +
                    "</div></div>";
                $("#error").html(html);
            }
            }
            else {
            let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                "<div class='alert alert-light-danger' role='alert'>" +
                "<button type='button' class='btn-close text-danger' style='margin-bottom:-5px;' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                "<strong><i class='fa fa-ban text-danger'></i> Validation Error! Please validate before submitting.&nbsp;</strong><br/><ul>";

            $.each(data.message, function (index, value) {
                html += "<li><small>" + value + "</small><li>";
                var elem = $("#" + index);
                if (elem.hasClass("select2-hidden-accessible")) {
                    $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                }
                else {
                    $(elem).addClass(" is-invalid");
                }

                setTimeout(function () {
                    if (elem.hasClass("select2-hidden-accessible")) {
                        $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                    }
                    else {
                        $(elem).removeClass("is-invalid");
                    }
                }, 5000);
            });
            html += "</ul></div></div>";
            $("#error").html(html);
            }
            },
            error: function (xhr) {
            $('#btn_Insert_MSH').removeClass("btn btn-success btn-loaders btn-icon");
            $('#btn_Insert_MSH').addClass("btn btn-success");
            $('#btn_Insert_MSH').html("Add");
            Timeout();
            }
            });
            }
            else {
                $('.modal-body').animate({
                    scrollTop: ($('.has-error').offset().top - 300)
                }, 2000);
            }
        });
    //#endregion

</script>
@*}*@

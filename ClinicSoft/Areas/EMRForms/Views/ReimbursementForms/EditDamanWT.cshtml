
@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@model BusinessEntities.EMRForms.DamanWT
@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}
<form id="form_EditDamanWT" class="needs-validation fs-14" >

    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.cdr_Id)
    @Html.HiddenFor(m => m.cdr_appId)
    <div class="row mb-2 mt-2 text-center">
        <div class="col-md-11 bg-red-dark">
            <h2 class="panel-heading bg-red-dark text-white">Reimbursement Claim Form</h2>
        </div>
        <div class="col-md-1">
            <img src="~/images/Reimbursement_Forms/daman.png" />
        </div>
    </div>
    <div class="row">
        <p class="form-label mb-2 text-danger font-italic">
            Please read the instructions and guidelines on page 2 before filling the form. Section 1, 2 and 4 to be filled by the cardholder only and Section 3 to be filled by the treating doctor.
        </p>
    </div>
    <div class="row">
        <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
            <div class="panel-heading bg-red-dark text-white-80"> 1 . Card Holder's Information</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-6 form-label">Name</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_name&nbsp;</span>
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-6 form-label">Daman Card No</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @if (@emr.pi_insno != "")
                                    {
                                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pi_insno&nbsp;</span>
                                    }
                                    else
                                    {
                                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-6 form-label">Mobile No</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_mob&nbsp;</span>
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-6 form-label">E-mail</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @if (@emr.pat_email != "")
                                    {
                                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_email&nbsp;</span>
                                    }
                                    else
                                    {
                                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-6 form-label">Address</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @if (@emr.pat_address != "")
                                    {
                                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_address&nbsp;</span>
                                    }
                                    else
                                    {
                                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-heading bg-red-dark text-white-80">2. Claims Payment Details</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <p class="text-black text-justify">
                                Wire Transfer (Please provide your bank account details):<br />
                                Note: Daman does not impose any additional fees on all payment transactions related to claim reimbursements. Charges may only be applicable based on the internal policies and procedures of the respective bank.
                            </p>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Principal Beneficiary Name </label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e1, new { @class = "form-control", @id = "ucdr_e1", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Bank Name</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e2, new { @class = "form-control", @id = "ucdr_e2", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Swift Code Number (For International Transfers)</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e3, new { @class = "form-control", @id = "ucdr_e3", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">IBAN</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e4, new { @class = "form-control", @id = "ucdr_e4", @maxlength = "200" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel-heading bg-red-dark text-white-80 text-justify">3.Medical Information (To be filled by treating Doctor for all outpatient treatment. For cases like hospitalization, procedures, surgeries-detailed Medical report is required)</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Visit Date</label>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">
                                            <i class="fe fe-calendar"></i>
                                        </div>
                                    </div>
                                    @Html.TextBoxFor(m => m.cdr_d1, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "ucdr_d1" })
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Chief Complaints</label>
                            <div class="col-md-6">
                                <label class="text-black text-red text-left" id="complaints" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Medical History</label>
                            <div class="col-md-6">
                                <label class="text-black text-red text-left" id="past" name="">&nbsp;</label>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-6 text-black">Diagnosis</label>
                            <div class="col-md-6">
                                <label class="text-black text-red text-left" id="diagnosis" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Treatment cause is work related</label>
                            <div class="col-md-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[1]" value="1" id="1">
                                    <span class="custom-control-label">Yes</span>
                                </label>
                            </div>
                            <div class="col-md-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[1]" value="2" id="2">
                                    <span class="custom-control-label">No</span>
                                </label>
                            </div>
                            <label class="col-md-12 text-black">Please Specify</label>
                            <div class="col-md-12">
                                @Html.TextBoxFor(m => m.cdr_e7, new { @class = "form-control", @id = "ucdr_e7", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Treatment Details</label>
                            <div class="col-md-6">
                                <label class="text-black text-red text-left" id="treatments" name="">&nbsp;</label>
                            </div>
                        </div>

                        <div class="form-group row">
                            <p class="text-black text-justify">
                                I declare that I have attended to this patient and that the particulars given are true and correct to the best of my knowledge.
                            </p>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-3 form-label">Name (Medical Practitioner):</label>
                            <div class="col-md-6 col-lg-2">
                                <span class="font-weight-normal1 text-capitalize text-left">@emr.doc_name&nbsp;</span>
                            </div>
                            <label class="col-md-6 col-lg-2 form-label">Signature:</label>
                            <div class="col-md-6 col-lg-2">
                                <div class="form-group mb-3"><img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" /></div>
                            </div>
                            <label class="col-md-6 col-lg-1 form-label">Date:</label>
                            <div class="col-md-6 col-lg-2">
                                <span class="font-weight-normal1 text-capitalize text-left">@emr.app_fdate&nbsp;</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-heading bg-red-dark text-white-80">4. Claim Information (Refer to Appendix A.Gemeral Instruction)</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <label class="col-md-12 text-black">Reason for not using Daman's network of medical services providers(Kindly indicate)</label>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-4 col-lg-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[3]" value="3" id="3">
                                    <span class="custom-control-label">Emergency</span>
                                </label>
                            </div>
                            <div class="col-md-4 col-lg-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[3]" value="4" id="4">
                                    <span class="custom-control-label">Family Doctor</span>
                                </label>
                            </div>
                            <div class="col-md-4 col-lg-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[3]" value="5" id="5">
                                    <span class="custom-control-label">Personal Choice</span>
                                </label>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[3]" value="6" id="6">
                                    <span class="custom-control-label">Service not available elsewhere</span>
                                </label>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[3]" value="7" id="7">
                                    <span class="custom-control-label">Vacation/Business Trip outside UAE</span>
                                </label>
                            </div>
                            <div class="col-md-3 col-lg-2">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[3]" value="8" id="8">
                                    <span class="custom-control-label">Others</span>
                                </label>
                            </div>
                            <label class="col-md-3 col-lg-2 text-black">Please Specify</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e10, new { @class = "form-control", @id = "ucdr_e10", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="table-responsive">
                                <table id="tbl_gdData" class="table table-striped table-bordered text-nowrap" style="width: 50%; cursor: pointer;">
                                    <thead>
                                        <tr style="color: #fff !important; background-color: #808080; border-color: #3C457D; ">
                                            <th class="border-bottom-0 font-weight-semibold text-white">#</th>
                                            <th class="border-bottom-0 font-weight-semibold text-white">Name & Address of Hospital/Clinic</th>
                                            <th class="border-bottom-0 font-weight-semibold text-white">Bill No</th>
                                            <th class="border-bottom-0 font-weight-semibold text-white">Treatment Date</th>
                                            <th class="border-bottom-0 font-weight-semibold text-white">Description of Services</th>
                                            <th class="border-bottom-0 font-weight-semibold text-white">Amount</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Currency (If treatment availed outside UAE)</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e8, new { @class = "form-control", @id = "ucdr_e8", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Total</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e9, new { @class = "form-control", @id = "ucdr_e9", @maxlength = "200" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-heading bg-red-dark text-white-80">5. Declaration</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <p class="text-black text-justify">
                                I, the undersigned, declare that the information above is correct and that the reimbursement requested is for the expenses paid by me for the treatment of my covered condition. I hereby authorize any Doctor, Hospital, Clinic or Medical Provider; any Insurance Company or any Company, Institution or any other person who has any record or information about me and/ or any of my family members to provide National Health Insurance Company - Daman with the complete information including copies of their records with reference to any sickness or accident, any treatment, examination, advice or hospitalization or any other information required by Daman. I am fully aware that any person who intentionally makes any false and/or misleading statement and/or information to obtain reimbursement from Daman is subject to penalization.
                            </p>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 col-lg-3 form-label">Name of Card Holder/ Legal Guardian/ Legal Representative:</label>
                            <div class="col-md-6 col-lg-2">
                                <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_name&nbsp;</span>
                            </div>
                            <label class="col-md-6 col-lg-2 form-label">Signature:</label>
                            <div class="col-md-6 col-lg-2">
                                <div class="form-group mb-3" style="display:none" id="patimg"><img alt="Signature" src="" id="pat_sign" class="avatar avatar-xl bsquare" /></div>
                            </div>
                            <label class="col-md-6 col-lg-1 form-label">Date:</label>
                            <div class="col-md-6 col-lg-2">
                                <label class="form-label text-red text-left" id="psb_date_witness" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Mobile No</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e11, new { @class = "form-control mb-1", @id = "ucdr_e11", @maxlength = "14" })
                            </div>
                            <label class="col-md-6 text-black">Relationship to card Holder</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e12, new { @class = "form-control", @id = "ucdr_e12", @maxlength = "200" })
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-heading bg-red-dark text-white-80">5.  Appendix A:General Instuctions</div>
            <div class="card-body pt-0">
                <ul class="list-style5 text-justify text-black">
                    <li>In compliance with the instructions of the Health Authority- Abu Dhabi and UAE law, ali Information related to the Claim are strictly confidential and shall not be disclosed to any third party.</li>
                    <li>This form can be used for all types of medical plans and has to be completed by the insured member (Card holder), only if provider is not submiting the claim on his behalf.</li>
                    <li>Use separate form for each Daman member.</li>
                    <li>
                        Please read the form carefully and make sure to complete all pertinent Information. Daman will not be able to process any incomplete
                        Claim Reimbursement Form without complete documentation as listed below:
                        <div class="table-responsive">
                            <table id="tbl_1" class="table table-striped table-bordered text-nowrap" style="width: 50%; cursor: pointer;">
                                <tbody>
                                    <tr>
                                        <td>Essential Documents:</td>
                                        <td>
                                            Original itemized bill / Invoices with date
                                            Original Prescription for medication given by the treating docter.
                                            Investigation results / reports like laboratory tests, x-rays, etc. for procedures above AED 1,000.00
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Additional Requirements for Inpatient(Hospitalization Cases):</td>
                                        <td>Medical Report / Discharge Summary stamped & signed by the treating Doctor</td>
                                    </tr>
                                    <tr>
                                        <td>Additional Requirements for treatment availed outside the UAE:</td>
                                        <td>Passport copy with the entry/exit stamp or any other proof must be provided.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                    <li>Note: Please keep copies of receipts and documents enclosed wtth vour claim as Daman will not return the original documents unless it is a case of total rejection.</li>

                    <li>
                        <p class="font-weight-bold">
                            Payment Preference:
                        </p>
                        <ul>
                            <li>All fields marked with (*) are mandatory and have to be provided by tne member at the time of submission of the ctaim form. Daman will not be responsible for any incorrect information provided by you, especially in respect of incorrect bank information.</li>
                            <li>Swift code information is only necessary for international transfers</li>
                            <li>The wire transfer payment will be deposited into the principal account number</li>
                            <li>Wire Transfer payment fee is guaranteed paid by Dam an; any amount charged as a result of this service need to be discussed by the member with his/her respective bank.</li>
                        </ul>
                    </li>
                    <li>
                        All claims subject to reimbursement should be submitted to Daman from the last treatment dates as mentioned below:
                        <ul>
                            <li> Within 120 Days in case for services taken Inside and outside UAE for all Enhanced Plans</li>
                            <li>Within 180 Days in case for services taKen inside and outside the UAE for Premier Plan</li>
                            <li>Within 60 Days in case for services taken inside UAE for Abu Dhabi card holders</li>
                            <li>Coverage outside UAE is limited to 90 days per treatment. A single holiday — or Business trip may not exceed 90 days.</li>
                        </ul>
                    </li>
                    <li>Please note thot the claim mignt take an additional five working days if submitted in a language other than English and Arabic.</li>
                    <li>To ensure efficient and prompt set:element of your claims, please submit all the above re9uired documents directly to Customer Support Desk in any of Daman’s Branches for convenience.</li>

                </ul>
                <div class="form-group row">
                    <p class="text-black text-justify">
                        If you have any question or need assistance in filling this form,
                        Please call 800 4 32626 within the UAE or +971 2 6E49S55 Outside UAE
                    </p>
                </div>
            </div>
        </div>
    </div>


    <div class="row mt-2">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center">
            <div class="btn-list btn-animation">
                <button type="submit" class="btn btn-warning btn-sm" id="btn_Update_DamanWT">Save Changes</button>
                <button type="submit" class="btn btn-sm btn-outline-danger" id="btn_Delete_DamanWT">Delete</button>
                <button type="button" class="btn btn-sm btn-outline-light " id="btn_Print_RadioDeci" onclick="PrintDamanWT()">
                    <i class="fa fa-print">&nbsp;&nbsp;</i>Print
                </button>
                <div class="btn-group mr-2">
                    <div class="dropdown">
                        <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="openSignaturePad('patient')">Tab</a>
                            <a class="dropdown-item" onclick="openWacomTabSignaturePad('patient')">Wacom Tab</a>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-danger" id="btn_Close_EditDamanWT" style="display:none">
                    Close
                </button>
            </div>
        </div>
    </div>
</form>
<script type="text/javascript">

    //#region Partial View Onload
        var formName1 = $(form_EditDamanWT).closest('form').attr('name');
        $(function () {
            validate();
            getDataDaman();
            Get_EMRINFO();
            set_date();
            GetSignaturename('patient');
            GetCheckedValues("@Model.cdr_checkbox");
        });
    //#endregion

    //#region Load set Date
        var set_date = function () {
            $('#ucdr_d1').bootstrapdatepicker({
                    format: "dd-MM-yyyy",
                    viewMode: "date",
                    todayHighlight: true,
                    autoclose: true,
                    multidate: false,
                    multidateSeparator: "-"
            });
            var d1 = "@Model.cdr_d1";
            if (d1 != "1/1/1950 12:00:00 AM") {
                $("#ucdr_d1").bootstrapdatepicker("setDate", moment(new Date("@Model.cdr_d1")).format("DD-MMMM-YYYY"));
            }
            else {
                $("#ucdr_d1").bootstrapdatepicker("setDate", '');
            }

        }
    //#endregion

    //#region Load Get Diagnosis,treatments,history,invoice
        var Get_EMRINFO = function () {
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetEmrInfo", "ReimbursementForms", new { area = "EMRForms" })?appId=" + "@emr.appId" + "&patId=" + @emr.patId,
                success: function (response) {
                    if (response.length > 0) {
                        $('#past').text(response[0].past);
                        $('#complaints').text(response[0].complaints);
                        $('#diagnosis').text(response[0].diagnosis);
                        $('#treatments').text(response[0].treatments);
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            })
        }
    //#endregion

    //#region Get CheckedValues
        var GetCheckedValues = function (checknames) {
            var str = checknames;
            var myarray = str.split(',');

            for (var i = 0; i < myarray.length; i++) {
                $('.custom-control-input').each(function () {
                    if (this.id == myarray[i]) {
                        $("#" +this.id).attr('checked', 'checked');
                        $("#" +this.id).prop("checked", true);

                    }
                });
            }

        }
    //#endregion

    //#region Update  Button Click
        $('#btn_Update_DamanWT').on('click', function (e) {
                e.preventDefault();
            if ($("#form_EditDamanWT").valid()) {
                console.log($("#cdr_Id").val());
                $('#btn_Update_DamanWT').removeClass("btn btn-success");
                $('#btn_Update_DamanWT').addClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Update_DamanWT').html("Updating the Record....");
                var cdr_chkbox = "";
                $('.custom-control-input:checked').each(function (index) {
                    cdr_chkbox = cdr_chkbox + ',' + $(this).val();
                });
                var cdr_checkbox = cdr_chkbox.substring(1);
                var _dataInsert = {
                    "cdr_Id": @Model.cdr_Id,
                    "cdr_appId": @emr.appId,
                    "cdr_checkbox": cdr_checkbox,
                    "cdr_e1": $("#ucdr_e1").val(),
                    "cdr_e2": $("#ucdr_e2").val(),
                    "cdr_e3": $("#ucdr_e3").val(),
                    "cdr_e4": $("#ucdr_e4").val(),
                    "cdr_e5": $("#complaints").text(),
                    "cdr_e6": $("#treatments").text(),
                    "cdr_e7": $("#ucdr_e7").val(),
                    "cdr_e8": $("#ucdr_e8").val(),
                    "cdr_e9": $("#ucdr_e9").val(),
                    "cdr_e10": $("#ucdr_e10").val(),
                    "cdr_e11": $("#ucdr_e11").val(),
                    "cdr_e12": $("#ucdr_e12").val(),
                    "cdr_d1": moment($("#ucdr_d1").val()).format("YYYY-MM-DD"),
                    "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
                }
                console.log(_dataInsert)
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("UpdateDamanWT", "ReimbursementForms", new { area = "EMRForms" })",
                    dataType: 'JSON',
                    data: _dataInsert,
                    success: function (data) {
                        $('#btn_Update_DamanWT').removeClass("btn btn-warning btn-loaders btn-icon");
                        $('#btn_Update_DamanWT').addClass("btn btn-warning");
                        $('#btn_Update_DamanWT').html("Save Changes");
                        if (data.isSuccess) {
                            if (data.isInserted) {
                                GetDamanWT();
                                var alertPlaceholder = document.getElementById("Alert");
                                function alert(e, t) {
                                    var l = document.createElement("div");
                                    l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible"  role="alert">' + e +
                                        '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                                }
                                alert("<i class='fe fe-check-circle text-white'></i> Daman Updated Successfully!", "success");
                                Timeout();
                                $("#daman_edit").show();
                                $("#daman_add").hide();
                            }
                            else {
                                let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                                    "<div class='alert alert-warning' role='alert'>" +
                                    "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                    "<strong>Warning.. Daman Alredy Exists..</strong><br/>" +
                                    "</div></div>";
                                $("#error").html(html);
                            }
                        }
                        else
                        {
                            let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                                "<div class='alert alert-danger' role='alert'>" +
                                "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                "<strong>Validation Error.. Please correct before you submit the form!&nbsp;</strong><br/><ul>";
                            $.each(data.message, function (index, value) {
                                html += "<li><small>" + value + "</small><li>";
                                var elem = $("#" + index);
                                if (elem.hasClass("select2-hidden-accessible")) {
                                    $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                                }
                                else {
                                    $(elem).addClass(" is-invalid");
                                }

                                setTimeout(function () {
                                    if (elem.hasClass("select2-hidden-accessible")) {
                                        $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                    }
                                    else {
                                        $(elem).removeClass("is-invalid");
                                    }
                                }, 5000);
                            });
                            html += "</ul></div></div>";
                            $("#error").html(html);
                        }
                    },
                    error: function (xhr) {
                        $('#btn_Update_DamanWT').removeClass("btn btn-warning btn-loaders btn-icon");
                        $('#btn_Update_DamanWT').addClass("btn btn-warning");
                        $('#btn_Update_DamanWT').html("Save Changes");
                        Timeout();
                    }
                });

            }
            else {
                $('.modal-body').animate({
                    scrollTop: ($('.has-error').offset().top - 300)
                }, 2000);
            }
        });
    //#endregion

    //#region Delete Click
        $('#btn_Delete_DamanWT').on('click', function (e) {
            e.preventDefault();
            $('#btn_Delete_DamanWT').removeClass("btn btn-success");
            $('#btn_Delete_DamanWT').addClass("btn btn-success btn-loaders btn-icon");
            $('#btn_Delete_DamanWT').html("Deleting the Record....");

                $.ajax({
                    url: '@Url.Action("DeleteDamanWT", "ReimbursementForms", new { area = "EMRForms" })?cdr_Id=' + $("#cdr_Id").val(),
                    type: "POST",
                    dataType: 'JSON',
                    success: function (data) {
                        $('#btn_Delete_DamanWT').removeClass("btn btn-success btn-loaders btn-icon");
                        $('#btn_Delete_DamanWT').addClass("btn btn-warning");
                        $('#btn_Delete_DamanWT').html("Delete");
                        if (data.isAuthorized) {
                            if (data.success) {
                                var alertPlaceholder = document.getElementById("Alert");
                                function alert(e, t) {
                                    var l = document.createElement("div");
                                    l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                        '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                                }
                                alert("<i class='fe fe-check-circle text-white'></i> Daman Claim Deleted Successfully!", "success");
                                clearControls();
                                $("#daman_edit").hide();
                                $("#daman_add").show();
                                AdddamanWT();
                            }
                            else {
                                let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                                    "<div class='alert alert-warning' role='alert'>" +
                                    "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                    "<strong>Error!.. Failed to Delete..</strong><br/>" +
                                    "</div></div>";
                                $("#error").html(html);
                            }
                        }
                        else {
                            var alertPlaceholder = document.getElementById("Alert");
                            function alert(e, t) {
                                var l = document.createElement("div");
                                l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                            }
                            alert("<i class='fe fe-check-circle text-white'></i> You do not have Enough Privileges to Delete this Designation!", "Access Denied!");
                        }
                    },
                    error: function (xhr) {
                        $('#btn_Delete_DamanWT').removeClass("btn btn-success btn-loaders btn-icon");
                        $('#btn_Delete_DamanWT').addClass("btn btn-Delete");
                        $('#btn_Delete_DamanWT').html("Delete");
                        Timeout();
                    }
                })
        });
    //#endregion

    //#region Wacom Tab Signature
        var openWacomTabSignaturePad = function (id) {
            var _data = {
                "patId": @emr.patId,
                "person": id,
                "form": "DamanWT",
                "appId": @emr.appId,
                "formname":"DamanWT",
                "formlink":"PrintDamanWTClaim.aspx",
                "eSign":""
            }
            $.ajax({
                type: "GET",
                url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion

    //#region Signature
        var openSignaturePad = function (id) {
            var _data = {
                "patId": @emr.patId,
                "person": id,
                "form": "DamanWT",
                "appId": @emr.appId,
                "formname":"DamanWT",
                "formlink":"PrintDamanWTClaim.aspx",
                "eSign":""
            }
            $.ajax({
                type: "GET",
                url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion

    //#region Get Signature
        var GetSignaturename = function  (person) {
            $.ajax({
                url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=DamanWT',
                    type: "GET",
                    dataType: "json",
                    async: false,
                success: function (response) {
                    console.log("fgxghszd");
                    console.log(response);
                    let sign = response[0].psb_sign;
                    var date = moment(response[0].psb_date_created).format("DD-MM-YYYY HH:mm");
                    if (response[0].person == "patient") {
                        $("#upatimg").show();
                        $("#upat_sign").attr("src", sign);
                        $("#upsb_date_witness").text(date);
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                    alert(xhr);
                }

            });
        };
    //#endregion

    //#region Validation Initialization
        var validate = function () {
            $('#cdr_d1').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });
            $('#cdr_e11').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                var inputValue = $(this).val() + String.fromCharCode(charCode);

                if (String.fromCharCode(charCode).match(/[^0-9.]/g)) {
                    return false;
                }
            });
        }
     //#endregion

    //#region Alert Timeout
        function Timeout() {
            window.setTimeout(function () {
                $(".alert").fadeTo(500, 0).slideUp(500, function () {
                    $(this).remove();
                });
            }, 4200);
        }
    //#endregion

    //#region Clear Controls
        var clearControls = function () {
            $("#ucdr_e1").val("");
            $("#ucdr_e2").val("");
            $("#ucdr_e3").val("");
            $("#ucdr_e4").val("");
            $("#ucdr_e5").val("");
            $("#ucdr_e6").val("");
            $("#ucdr_e7").val("");
            $("#ucdr_e8").val("");
            $("#ucdr_e9").val("");
            $("#ucdr_e10").val("");
            $("#ucdr_e11").val("");
            $("#ucdr_e12").val("");
        }
    //#endregion

    //#region Print DamanWT Request
        function PrintDamanWT() {
            window.open("@Url.Action("PrintDamanWT", "ReimbursementForms", new { area = "EMRForms" })?cdr_Id=" + @Model.cdr_Id)
        }
    //#endregion

    //#region Load getDataDaman
        var getDataDaman = function () {
            $.ajax({
                type: "GET",
                url: "@Url.Action("getDataDaman", "ReimbursementForms", new { area = "EMRForms" })?appId=" + "@emr.appId" + "&patId=" + @emr.patId,
                success: function (response) {
                    if (response.isAuthorized != false) {
                        var table;
                        if ($.fn.dataTable.isDataTable('#tbl_gdData')) {
                            table = $('#tbl_gdData').DataTable();
                            table.clear();
                            table.rows.add(response).draw();
                        }
                        else {
                            console.log(response);
                            BindDataTableP(response);
                        }
                    }
                    else {
                        console.log("You are not Authorized!");
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            })
        }
    //#endregion

    //#region Previous Bind Datatable
        var BindDataTableP = function (response) {
            var table = $("#tbl_gdData").DataTable({
                fixedHeader: {
                    header: true,
                    footer: true,
                },
                processing: true,
                paging: false,
                ordering: false,
                info: false,
                "searching": false,
                "retrieve": true,
                lengthChange: false,
                "aaData": response,
                "aoColumns": [
                    {
                        "mData": "ptId",
                        "orderable": false,
                        "searchable": false,
                        "className": "text-center",
                        "render": function (data, type, row, meta) {
                            let _index = (meta.row) + 1;
                            if (_index >= 10) {
                                return "<a href='javascript:void(0)' class='fs-13 font-weight-bold'>" + _index + "</a>";
                            }
                            else {
                                return "<a href='javascript:void(0)' class='fs-13 font-weight-bold'>0" + _index + "</a>";
                            }
                        }
                    },
                    {
                        "mData": "set_company",
                        "className": 'text-justify'
                    },
                    {
                        "mData": "pt_invno",
                        "className": 'text-justify'
                    },
                    {
                        "mData": "pt_date",
                        "className": "text-left",
                        "render": function (data, type, row, meta) {
                            if (type === 'display' || type === 'filter') {
                                return moment(data).format("DD-MM-YYYY");
                            }
                            return moment(data).format("YYYY-MM-DD");
                        }
                    },
                    {
                        "mData": "pt_tr_name",
                        "className": 'text-justify'
                    },
                    {
                        "mData": "pt_net",
                        "className": 'text-justify'
                    },
                ],
                order: [[0, 'asc']],


            });
            table.buttons().container().appendTo('#tbl_gdData_wrapper .col-md-6:eq(0)');
        };
    //#endregion

</script>
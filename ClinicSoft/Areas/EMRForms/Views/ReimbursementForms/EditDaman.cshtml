
@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@model BusinessEntities.EMRForms.Daman
@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}
<form id="form_EditDaman" class="needs-validation fs-14" >

    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.cdr_Id)
    @Html.HiddenFor(m => m.cdr_appId)
    <div class="row">
        <p class="form-label mb-2 text-danger font-italic">
            Please read the instructions and guidelines on Page 2 before filling this form.
        </p>
    </div>
    <div class="row text-justify">
        <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
            <div class="panel-heading bg-red-dark text-white-80">1. Card Holder’s Identity and Contact Information</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-6 form-label">Name</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_name&nbsp;</span>
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-6 form-label">Daman Card No</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @if (@emr.pi_insno != "")
                                    {
                                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pi_insno&nbsp;</span>
                                    }
                                    else
                                    {
                                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-6 form-label">Mobile No</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_mob&nbsp;</span>
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-6 ps-0">
                                <label class="col-md-6 form-label">E-mail</label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-6">
                                    @if (@emr.pat_email != "")
                                    {
                                        <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_email&nbsp;</span>
                                    }
                                    else
                                    {
                                        <span class="font-weight-normal1 text-capitalize text-left">N/A</span>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-heading bg-red-dark text-white-80">2. Claims Payment Details</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <p class="text-black text-justify">
                                Wire Transfer (Please provide the bank account details to which Daman should transfer the money entitle under this reimbursement claim.) If the IBAN number provided herein is incorrect, Daman shall not be liable for any direct/indirect/consequential results from the wire transfer to such number.
                            </p>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Beneficiary Name</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e1, new { @class = "form-control", @id = "ucdr_e1", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Bank Name</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e2, new { @class = "form-control", @id = "ucdr_e2", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Branch, Bank Address</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e3, new { @class = "form-control", @id = "ucdr_e3", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Account Number</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e4, new { @class = "form-control", @id = "ucdr_e4", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Swift Code Number (For International Transfers)</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e5, new { @class = "form-control", @id = "ucdr_e5", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">IBAN</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e6, new { @class = "form-control", @id = "ucdr_e6", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <p class="text-black text-justify">
                                I authorise the National Health Insurance Company – Daman PJSC (“Daman”) to make wire transfer payment against this Reimbursement Claim Form and hereby discharge Daman from any liability with respect of releasing the payment to the bank details as specified by me hereinabove
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-heading bg-red-dark text-white-80 text-justify">3. Information on Road Traffic Accident, Work Related, Third Party Liability and Double Insurance (Refer to General   Instructions)</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <label class="col-md-6 text-black text-justify">Treatment cause is Road Traffic Accident (RTA)</label>
                            <div class="col-md-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[1]" value="1" id="1">
                                    <span class="custom-control-label">Yes</span>
                                </label>
                            </div>
                            <div class="col-md-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[1]" value="2" id="2">
                                    <span class="custom-control-label">No</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Treatment cause is work related</label>
                            <div class="col-md-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[3]" value="3" id="3">
                                    <span class="custom-control-label">Yes</span>
                                </label>
                            </div>
                            <div class="col-md-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[3]" value="4" id="4">
                                    <span class="custom-control-label">No</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black text-justify">Treatment cause is other than the above specified, wherein a third party is involved</label>
                            <div class="col-md-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[5]" value="5" id="5">
                                    <span class="custom-control-label">Yes</span>
                                </label>
                            </div>
                            <div class="col-md-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[5]" value="6" id="6">
                                    <span class="custom-control-label">No</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black text-justify">Reimbursement claim is covered by other insurance policy</label>
                            <div class="col-md-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[7]" value="7" id="7">
                                    <span class="custom-control-label">Yes</span>
                                </label>
                            </div>
                            <div class="col-md-3">
                                <label class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" name="cdr_checkbox[7]" value="8" id="8">
                                    <span class="custom-control-label">No</span>
                                </label>
                            </div>
                            <label class="col-md-12 text-black">Please Specify</label>
                            <div class="col-md-12">
                                @Html.TextBoxFor(m => m.cdr_e7, new { @class = "form-control", @id = "ucdr_e7", @maxlength = "200" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-heading bg-red-dark text-white-80 text-justify"> 4. Medical Information (To be filled-in by the treating practitioner who is licensed by the competent authority of the concerned country)</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Visit Date</label>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">
                                            <i class="fe fe-calendar"></i>
                                        </div>
                                    </div>
                                    @Html.TextBoxFor(m => m.cdr_d1, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "ucdr_d1" })
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Chief Complaints</label>
                            <div class="col-md-6">
                                <label class="text-black text-red text-left" id="complaints" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Medical History</label>
                            <div class="col-md-6">
                                <label class="text-black text-red text-left" id="past" name="">&nbsp;</label>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-6 text-black">Diagnosis</label>
                            <div class="col-md-6">
                                <label class="text-black text-red text-left" id="diagnosis" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Treatment Details</label>
                            <div class="col-md-6">
                                <label class="text-black text-red text-left" id="treatments" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Currency (If treatment availed outside UAE)</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e11, new { @class = "form-control", @id = "ucdr_e11", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 text-black">Total Amount Paid</label>
                            <div class="col-md-6">
                                @Html.TextBoxFor(m => m.cdr_e12, new { @class = "form-control", @id = "ucdr_e12", @maxlength = "200" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <p class="text-black text-justify">
                                I declare that I have attended to this patient and that the particulars given are true and correct to the best of my knowledge.
                            </p>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 form-label">Name (Medical Practitioner):</label>
                            <div class="col-md-6">
                                <span class="font-weight-normal1 text-capitalize text-left">@emr.doc_name&nbsp;</span>
                            </div>
                            <label class="col-md-6 form-label">Signature:</label>
                            <div class="col-md-6">
                                <div class="form-group mb-3"><img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" /></div>
                            </div>
                            <label class="col-md-6 form-label">Date:</label>
                            <div class="col-md-6">
                                <span class="font-weight-normal1 text-capitalize text-left">@emr.app_fdate&nbsp;</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-heading bg-red-dark text-white-80">5. Authorisation</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <p class="text-black text-justify d-flex">
                                I, hereby authorise Daman to have access to and take copies of all my files and records at any time relating to any healthcare services provided to me during
                                the period of my insurance coverage with Daman. This authorisation is valid at any healthcare provider, including but not limited to hospitals, medical centres,
                                clinics, laboratories, diagnostic centres, rehabilitation centres and pharmacies. I understand that from time to time Daman may need to disclose this information
                                to third parties for reasons related to insurance including but not limited to the processing of my claim, research/statistical purposes, or to prevent/control
                                fraudulent or improper claims etc. Furthermore, I hereby authorise Mr. /Ms. /Company
                                <div class="col-md-12">
                                    @Html.TextBoxFor(m => m.cdr_e13, new { @class = "form-control", @id = "ucdr_e13", @maxlength = "200" })
                                </div>
                                to receive medical information related to this claim from Daman on my behalf.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-heading bg-red-dark text-white-80">6. Declaration</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group row">
                            <p class="text-black text-justify">
                                I hereby declare that I am the patient/patient’s legal guardian (if the patient is under 18 years of old). (Please cross out if not applicable).
                                I, the undersigned, hereby represent that the information provided above is correct and that the reimbursement requested is for the costs and expenses
                                paid by me for the treatment of my covered condition. I understand that it is unlawful to provide false, incomplete and/or misleading facts and information
                                (misrepresentation) to Daman for the purpose to defraud or attempt to defraud Daman. I further understand that such act may lead to imprisonment, fines,
                                denial of coverage, loss of benefits and legal damages. I authorise Daman to disclose the funding scheme claims details to ADIA.
                            </p>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-6 form-label">Name of Card Holder/ Legal Guardian/ Legal Representative:</label>
                            <div class="col-md-6">
                                <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_name&nbsp;</span>
                            </div>
                            <label class="col-md-6 form-label">Signature:</label>
                            <div class="col-md-6">
                                <div class="form-group mb-3" style="display:none" id="upatimg"><img alt="Signature" src="" id="upat_sign" class="avatar avatar-xl bsquare" /></div>
                            </div>
                            <label class="col-md-6 form-label">Date:</label>
                            <div class="col-md-6">
                                <label class="form-label text-red text-left" id="psb_date_witness" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-4 form-label">General Instructions:</label>
                        </div>
                        <div class="card-body pt-0">
                            <ul class="list-style5 text-justify text-black">
                                <li>Please note that all information related to this Claim is strictly confidential and shall not be disclosed by Daman to any third party, unless such disclosure is made pursuant to the relevant laws and regulations or authorised by you under Section 6.</li>
                                <li>This form can be used for all types of Daman medical plans and has to be completed by the Card Holder if direct billing facility is not available at the healthcare provider.</li>
                                <li>In the event that a third party is filling in and submitting this Reimbursement Claim Form on your behalf, please provide a copy of authorised person’s passport or emirates ID to Daman.</li>
                                <li>Original Discharge Summary</li>
                                <li>Use separate form for each insured member. </li>
                                <li>Copies of Operative Notes and Histopathology Report in case of surgery</li>
                                <li>
                                    <p class="font-weight-bold">
                                        Please read the form carefully and make sure to complete all information and attach all essential documents
                                        as specified herein otherwise Daman will not be able to process your Reimbursement Claim
                                    </p>
                                    <ul>
                                        <li>Original itemised bill / invoices with date</li>
                                        <li>Proof of payment (Paid stamp on invoice, original receipt, credit cards payment receipt, etc.).</li>
                                        <li>Original prescription for medication given by the medical practitioner.</li>
                                        <li>Original authorisation letter and copy of identity document of the authorised person if this Reimbursement Claim form is completed and submitted by a third party.</li>
                                        <li>Copy of identity document of the authorised person for collection of payment and/or information from Daman.</li>
                                        <li>Copy of visa page if the Card Holder is a minor.</li>
                                        <li>
                                            Essential Documents:The following documents are required as below:
                                            <div class="table-responsive">
                                                <table id="tbl_1" class="table table-striped table-bordered text-nowrap" style="width: 50%; cursor: pointer;">
                                                    <thead>
                                                        <tr style="color: #fff !important; background-color: #808080; border-color: #3C457D; ">
                                                            <th class="border-bottom-0 font-weight-semibold text-white">Cases</th>
                                                            <th class="border-bottom-0 font-weight-semibold text-white">Road traffic accident</th>
                                                            <th class="border-bottom-0 font-weight-semibold text-white">Work related treatment</th>
                                                            <th class="border-bottom-0 font-weight-semibold text-white">Any other third party liability</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>Police report</td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                        </tr>
                                                        <tr>
                                                            <td>Subrogation letter</td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                            <td></td>
                                                        </tr>
                                                        <tr>
                                                            <td>Relevant insurance policy</td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                        </tr>
                                                        <tr>
                                                            <td>Court judgment</td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                            <td class="text-center"><i class="fa fa-check me-2" aria-hidden="true"></i></td>
                                                        </tr>

                                                    </tbody>
                                                </table>
                                            </div>
                                        </li>
                                        <li>If reimbursement claim is covered by other insurance policy (a) relevant insurance policy (copy).</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-12 form-label">Additional Requirements for Inpatient and Day Care (Hospitalisation Cases):</label>
                            <div class="col-md-12">
                                <p class="text-justify text-black">
                                    Original Medical Report and/or Discharge Summary stamped and signed by the treating medical practitioner and health care provider.
                                </p>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-4 form-label">Notes:</label>
                        </div>
                        <div class="card-body pt-0">
                            <ol class="order-list">
                                <li>
                                    The Card Holder shall keep with him/her copy of original receipts and documents enclosed with the reimbursement claim as Daman will not return the original documents
                                    submitted to it unless there is a complete denial of your claim.
                                </li>
                                <li>
                                    Daman may require reviewing the original diagnostic investigation results/reports (such as Radiology and Laboratory investigation services)
                                    for services costing below AED 1000 for any medical clarifications. Therefore, kindly ensure that the original documents are kept securely.
                                    Daman reserves the right to reject any claims if original documents are not available upon request.
                                </li>
                                <li>
                                    In case of treatment availed outside the UAE, Daman reserves the right to ask for a copy of passport page with the entry and exit stamps and a valid visa page or any other document proving your stay outside the UAE.
                                </li>
                                <li>
                                    Wire transfer information:
                                    <ul class="list-style4 ps-5">
                                        <li>The wire transfer payment will be deposited in the account number mentioned in this Reimbursement Claim Form.</li>
                                        <li> Wire Transfer payment fee will be paid by Daman. Any other amount charged by the bank to the Card Holder for this service and/or any tax/taxes levied shall not be the responsibility of Daman.</li>

                                    </ul>
                                </li>
                                <li>
                                    Daman will inform the card holder about the status of the reimbursement claim within 10 working days from the claim received date.
                                </li>
                                <li>
                                    All claims subject to reimbursement should be submitted to Daman from the last treatment dates as mentioned below: a) Within 180 Days for services taken inside and outside the UAE for Premier and CoGenio Plans. b) Within 30 Days for services taken inside UAE for Basic (Abu Dhabi) Plan. c) Within 120 Days for other Daman Health Insurance Plans based on the coverage offered for respective plan.
                                </li>
                                <li>
                                    Daman is accepting claims submitted in the following languages: English, Arabic, Dutch, French, Russian, Hindi, Urdu, and German (which might take additional five days for non-Arabic and non-English claims). Claims submitted in languages other than the above listed should require translation to English or Arabic by certified translator licensed in the UAE (additional time exceeding five days stated for permitted languages listed herein may be required for unlisted languages).
                                </li>
                                <li>
                                    For any claim with foreign currency, Daman will consider the exchange rate on the day of processing the claim using the prevailing exchange rate.
                                </li>
                                <li>
                                    For health insurance plans other than CoGenio, members can submit their reimbursement claims across any of the Daman branches and to the below mentioned postal address.
                                    Members under CoGenio Plans, please submit your reimbursement claims only to the following postal address:
                                    <p class="text-justify text-black font-italic font-weight-bold">
                                        Claims Receiving Unit, National Health Insurance Company – Near Centro Capital Hotel,
                                        PO Box – 128888, Abu Dhabi, United Arab Emirates. Contact Number: +9712 6145622
                                    </p>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <div class="row mt-2">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center">
            <div class="btn-list btn-animation">
                <button type="submit" class="btn btn-warning btn-sm" id="btn_Update_Daman">Save Changes</button>
                <button type="submit" class="btn btn-sm btn-outline-danger" id="btn_Delete_Daman">Delete</button>
                <button type="button" class="btn btn-sm btn-outline-light " id="btn_Print_RadioDeci" onclick="PrintDaman()">
                    <i class="fa fa-print">&nbsp;&nbsp;</i>Print
                </button>
                <div class="btn-group mr-2">
                    <div class="dropdown">
                        <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="openSignaturePad('patient')">Tab</a>
                            <a class="dropdown-item" onclick="openWacomTabSignaturePad('patient')">Wacom Tab</a>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-danger" id="btn_Close_EditDaman" style="display:none">
                    Close
                </button>
            </div>
        </div>
    </div>
</form>
<script type="text/javascript">

    //#region Partial View Onload
        var formName1 = $(form_EditDaman).closest('form').attr('name');
        $(function () {
            validate();
            Get_EMRINFO();
            set_date();
            GetSignaturename('patient');
            GetCheckedValues("@Model.cdr_checkbox");
        });
    //#endregion

    //#region Load set Date
        var set_date = function () {
            $('#ucdr_d1').bootstrapdatepicker({
                    format: "dd-MM-yyyy",
                    viewMode: "date",
                    todayHighlight: true,
                    autoclose: true,
                    multidate: false,
                    multidateSeparator: "-"
            });
            var d1 = "@Model.cdr_d1";
            if (d1 != "1/1/1950 12:00:00 AM") {
                $("#ucdr_d1").bootstrapdatepicker("setDate", moment(new Date("@Model.cdr_d1")).format("DD-MMMM-YYYY"));
            }
            else {
                $("#ucdr_d1").bootstrapdatepicker("setDate", '');
            }

        }
    //#endregion

    //#region Load Get Diagnosis,treatments,history,invoice
        var Get_EMRINFO = function () {
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetEmrInfo", "ReimbursementForms", new { area = "EMRForms" })?appId=" + "@emr.appId" + "&patId=" + @emr.patId,
                success: function (response) {
                    if (response.length > 0) {
                        $('#past').text(response[0].past);
                        $('#complaints').text(response[0].complaints);
                        $('#diagnosis').text(response[0].diagnosis);
                        $('#treatments').text(response[0].treatments);
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            })
        }
    //#endregion

    //#region Get CheckedValues
        var GetCheckedValues = function (checknames) {
            var str = checknames;
            var myarray = str.split(',');

            for (var i = 0; i < myarray.length; i++) {
                $('.custom-control-input').each(function () {
                    if (this.id == myarray[i]) {
                        $("#" +this.id).attr('checked', 'checked');
                        $("#" +this.id).prop("checked", true);

                    }
                });
            }

        }
    //#endregion

    //#region Update  Button Click
        $('#btn_Update_Daman').on('click', function (e) {
                e.preventDefault();
            if ($("#form_EditDaman").valid()) {
                console.log($("#cdr_Id").val());
                $('#btn_Update_Daman').removeClass("btn btn-success");
                $('#btn_Update_Daman').addClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Update_Daman').html("Updating the Record....");
                var cdr_chkbox_ = "";
                $('.custom-control-input:checked').each(function (index) {
                    cdr_chkbox_ = cdr_chkbox_ + ',' + $(this).val();
                });
                var cdr_checkbox = cdr_chkbox.substring(1);
                var _dataInsert = {
                    "cdr_Id": @Model.cdr_Id,
                    "cdr_appId": @emr.appId,
                    "cdr_checkbox": cdr_chkbox_,
                    "cdr_e1": $("#ucdr_e1").val(),
                    "cdr_e2": $("#ucdr_e2").val(),
                    "cdr_e3": $("#ucdr_e3").val(),
                    "cdr_e4": $("#ucdr_e4").val(),
                    "cdr_e5": $("#ucdr_e5").val(),
                    "cdr_e6": $("#ucdr_e6").val(),
                    "cdr_e7": $("#ucdr_e7").val(),
                    "cdr_e8": $("#complaints").text(),
                    "cdr_e9": $("#diagnosis").text(),
                    "cdr_e10": $("#treatments").text(),
                    "cdr_e11": $("#ucdr_e11").val(),
                    "cdr_e12": $("#ucdr_e12").val(),
                    "cdr_e13": $("#ucdr_e13").val(),
                    "cdr_d1": moment($("#ucdr_d1").val()).format("YYYY-MM-DD"),
                    "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
                }
                console.log(_dataInsert)
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("UpdateDaman", "ReimbursementForms", new { area = "EMRForms" })",
                    dataType: 'JSON',
                    data: _dataInsert,
                    success: function (data) {
                        $('#btn_Update_Daman').removeClass("btn btn-warning btn-loaders btn-icon");
                        $('#btn_Update_Daman').addClass("btn btn-warning");
                        $('#btn_Update_Daman').html("Save Changes");
                        if (data.isSuccess) {
                            if (data.isInserted) {
                                GetDaman();
                                var alertPlaceholder = document.getElementById("Alert");
                                function alert(e, t) {
                                    var l = document.createElement("div");
                                    l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible"  role="alert">' + e +
                                        '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                                }
                                alert("<i class='fe fe-check-circle text-white'></i> Daman Updated Successfully!", "success");
                                Timeout();
                                $("#daman_edit").show();
                                $("#daman_add").hide();
                            }
                            else {
                                let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                                    "<div class='alert alert-warning' role='alert'>" +
                                    "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                    "<strong>Warning.. Daman Alredy Exists..</strong><br/>" +
                                    "</div></div>";
                                $("#error").html(html);
                            }
                        }
                        else
                        {
                            let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                                "<div class='alert alert-danger' role='alert'>" +
                                "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                "<strong>Validation Error.. Please correct before you submit the form!&nbsp;</strong><br/><ul>";
                            $.each(data.message, function (index, value) {
                                html += "<li><small>" + value + "</small><li>";
                                var elem = $("#" + index);
                                if (elem.hasClass("select2-hidden-accessible")) {
                                    $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                                }
                                else {
                                    $(elem).addClass(" is-invalid");
                                }

                                setTimeout(function () {
                                    if (elem.hasClass("select2-hidden-accessible")) {
                                        $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                    }
                                    else {
                                        $(elem).removeClass("is-invalid");
                                    }
                                }, 5000);
                            });
                            html += "</ul></div></div>";
                            $("#error").html(html);
                        }
                    },
                    error: function (xhr) {
                        $('#btn_Update_Daman').removeClass("btn btn-warning btn-loaders btn-icon");
                        $('#btn_Update_Daman').addClass("btn btn-warning");
                        $('#btn_Update_Daman').html("Save Changes");
                        Timeout();
                    }
                });

            }
            else {
                $('.modal-body').animate({
                    scrollTop: ($('.has-error').offset().top - 300)
                }, 2000);
            }
        });
    //#endregion

    //#region Delete Click
        $('#btn_Delete_Daman').on('click', function (e) {
            e.preventDefault();
            $('#btn_Delete_Daman').removeClass("btn btn-success");
            $('#btn_Delete_Daman').addClass("btn btn-success btn-loaders btn-icon");
            $('#btn_Delete_Daman').html("Deleting the Record....");

                $.ajax({
                    url: '@Url.Action("DeleteDaman", "ReimbursementForms", new { area = "EMRForms" })?cdr_Id=' + $("#cdr_Id").val(),
                    type: "POST",
                    dataType: 'JSON',
                    success: function (data) {
                        $('#btn_Delete_Daman').removeClass("btn btn-success btn-loaders btn-icon");
                        $('#btn_Delete_Daman').addClass("btn btn-warning");
                        $('#btn_Delete_Daman').html("Delete");
                        if (data.isAuthorized) {
                            if (data.success) {
                                var alertPlaceholder = document.getElementById("Alert");
                                function alert(e, t) {
                                    var l = document.createElement("div");
                                    l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                        '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                                }
                                alert("<i class='fe fe-check-circle text-white'></i> Daman Claim Deleted Successfully!", "success");
                                clearControls();
                                $("#daman_edit").hide();
                                $("#daman_add").show();
                                Adddaman();
                            }
                            else {
                                let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                                    "<div class='alert alert-warning' role='alert'>" +
                                    "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                    "<strong>Error!.. Failed to Delete..</strong><br/>" +
                                    "</div></div>";
                                $("#error").html(html);
                            }
                        }
                        else {
                            var alertPlaceholder = document.getElementById("Alert");
                            function alert(e, t) {
                                var l = document.createElement("div");
                                l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                            }
                            alert("<i class='fe fe-check-circle text-white'></i> You do not have Enough Privileges to Delete this Designation!", "Access Denied!");
                        }
                    },
                    error: function (xhr) {
                        $('#btn_Delete_Daman').removeClass("btn btn-success btn-loaders btn-icon");
                        $('#btn_Delete_Daman').addClass("btn btn-Delete");
                        $('#btn_Delete_Daman').html("Delete");
                        Timeout();
                    }
                })
        });
    //#endregion

    //#region Wacom Tab Signature
        var openWacomTabSignaturePad = function (id) {
            var _data = {
                "patId": @emr.patId,
                "person": id,
                "form": formName1,
                "appId": @emr.appId,
                "formname":"Daman",
                "formlink":"PrintDamanClaim.aspx",
                "eSign":""
            }
            $.ajax({
                type: "GET",
                url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion

    //#region Signature
        var openSignaturePad = function (id) {
            var _data = {
                "patId": @emr.patId,
                "person": id,
                "form": formName1,
                "appId": @emr.appId,
                "formname":"Daman",
                "formlink":"PrintDamanClaim.aspx",
                "eSign":""
            }
            $.ajax({
                type: "GET",
                url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion

    //#region Get Signature
        var GetSignaturename = function  (person) {
            $.ajax({
                url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=Daman',
                    type: "GET",
                    dataType: "json",
                    async: false,
                success: function (response) {
                    console.log("fgxghszd");
                    console.log(response);
                    let sign = response[0].psb_sign;
                    var date = moment(response[0].psb_date_created).format("DD-MM-YYYY HH:mm");
                    if (response[0].person == "patient") {
                        $("#upatimg").show();
                        $("#upat_sign").attr("src", sign);
                        $("#upsb_date_witness").text(date);
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                    alert(xhr);
                }

            });
        };
    //#endregion

    //#region Validation Initialization
        var validate = function () {
            $('#ucdr_d1').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });

        }
    //#endregion Validation Initialization

    //#region Alert Timeout
        function Timeout() {
            window.setTimeout(function () {
                $(".alert").fadeTo(500, 0).slideUp(500, function () {
                    $(this).remove();
                });
            }, 4200);
        }
    //#endregion

    //#region Clear Controls
        var clearControls = function () {
            $("#ucdr_e1").val("");
            $("#ucdr_e2").val("");
            $("#ucdr_e3").val("");
            $("#ucdr_e4").val("");
            $("#ucdr_e5").val("");
            $("#ucdr_e6").val("");
            $("#ucdr_e7").val("");
            $("#ucdr_e8").val("");
            $("#ucdr_e9").val("");
            $("#ucdr_e10").val("");
            $("#ucdr_e11").val("");
            $("#ucdr_e12").val("");
            $("#ucdr_e13").val("");
        }
    //#endregion

    //#region Print Daman Request
        function PrintDaman() {
            window.open("@Url.Action("PrintDaman", "ReimbursementForms", new { area = "EMRForms" })?cdr_Id=" + @Model.cdr_Id)
        }
    //#endregion

</script>
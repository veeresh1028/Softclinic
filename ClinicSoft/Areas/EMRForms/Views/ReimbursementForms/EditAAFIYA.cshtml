
@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@model BusinessEntities.EMRForms.AAFIYA
@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}
<form id="form_EditAAFIYA" class="needs-validation fs-14">

    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.ccaId)
    @Html.HiddenFor(m => m.cca_appId)

    <!-- Row-->
    <div class="row mt-2 text-justify">
        <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
            <div class="card">
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                                <label class="col-md-4 text-red font-weight-semibold">
                                    Provider Name
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-8">
                                    @Html.TextBoxFor(m => m.cca_1, new { @class = "form-control", @id = "ucca_1", @maxlength = "50" })
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-8 ps-0">
                                <label class="col-md-4 text-red font-weight-semibold">
                                    Patient Name
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-10">
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_name&nbsp;</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0 mb-2">
                                <label class="col-md-4 text-red font-weight-semibold">
                                    Insurance Company
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-8">
                                    @Html.TextBoxFor(m => m.cca_2, new { @class = "form-control", @id = "ucca_2", @maxlength = "50" })
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                                <label class="col-md-4 text-red font-weight-semibold">
                                    Patient Mobile No
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-8">
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_mob&nbsp;</span>
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                                <label class="col-md-4 text-red font-weight-semibold">
                                    File No
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-8">
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_code&nbsp;</span>
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0 mb-2">
                                <label class="col-md-4 text-red font-weight-semibold">
                                    Company Name
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-8">
                                    @Html.TextBoxFor(m => m.cca_3, new { @class = "form-control", @id = "ucca_3", @maxlength = "50" })
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                                <label class="col-md-4 text-red font-weight-semibold">
                                    Member ID
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-8">
                                    @Html.TextBoxFor(m => m.cca_4, new { @class = "form-control mb-1", @id = "ucca_4", @maxlength = "50" })
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                                <label class="col-md-4 text-red font-weight-semibold">
                                    Date Of Treatment
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <div class="input-group-text">
                                                <i class="fe fe-calendar"></i>
                                            </div>
                                        </div>
                                        @Html.TextBoxFor(m => m.cca_date1, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "ucca_date1" })
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                                <label class="col-md-4 text-red font-weight-semibold">
                                    Date Of Birth
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-8">
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_dob&nbsp;</span>
                                </div>
                            </div>
                            <div class="d-flex col-sm-12 col-md-12 col-lg-4 ps-0">
                                <label class="col-md-4 text-red font-weight-semibold">
                                    Gender
                                </label>
                                <div class="d-flex  justify-content-center w-8  form-label">
                                    :
                                </div>
                                <div class="col-md-8">
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_gender&nbsp;</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <label class="text-black">Chief Complaint </label>
                            <div>
                                <label class="text-black text-red text-left" id="complaints" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-4 text-black">Referral (if needed) : </label>
                            <div class="col-md-4">
                                @Html.TextBoxFor(m => m.cca_5, new { @class = "form-control", @id = "ucca_5", @maxlength = "50" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="form-label">
                                Clinical Findings
                            </label>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-2">
                                <label class="form-label">
                                    BP
                                </label>
                                <label class="form-label text-red text-left" id="sign_bp" name="">&nbsp;</label>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">
                                    Temp
                                </label>
                                <label class="form-label text-red text-left" id="sign_temp" name="">&nbsp;</label>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">
                                    Pulse
                                </label>
                                <label class="form-label text-red text-left" id="sign_pulse" name="">&nbsp;</label>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">
                                    Notes
                                </label>
                                <label class="form-label text-red text-left" id="sign_notes" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="text-black">Diagnosis</label>
                            <div>
                                <label class="text-black text-red text-left" id="diagnosis" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-3">
                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                        <input type="checkbox" class="custom-control-input" name="cca_check" value="1" id="1">
                                        <span class="custom-control-label">PEC/CHRONIC</span>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                        <input type="checkbox" class="custom-control-input" name="cca_check" value="2" id="2">
                                        <span class="custom-control-label">CONGENITAL</span>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                        <input type="checkbox" class="custom-control-input" name="cca_check" value="3" id="3">
                                        <span class="custom-control-label">MATERNITY</span>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                        <input type="checkbox" class="custom-control-input" name="cca_check" value="4" id="4">
                                        <span class="custom-control-label">DENTAL</span>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                        <input type="checkbox" class="custom-control-input" name="cca_check" value="5" id="5">
                                        <span class="custom-control-label">OPTICAL</span>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                        <input type="checkbox" class="custom-control-input" name="cca_check" value="6" id="6">
                                        <span class="custom-control-label">WORK RELATED OTHERS</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="text-black">Treatment Details</label>
                            <div>
                                <label class="text-black text-red text-left" id="treatments" name="">&nbsp;</label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-md-2 text-black">Requested Investigations</label>
                            <div class="col-md-6">
                                @Html.TextAreaFor(m => m.cca_6, new { @class = "form-control", @row = "2", @id = "ucca_6" })
                            </div>
                            <label class="col-md-2 text-black">Estimated Cost</label>
                            <div class="col-md-2">
                                @Html.TextBoxFor(m => m.cca_7, new { @class = "form-control", @id = "ucca_7", @maxlength = "50" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-3">
                                <label class="text-black">Prescription</label>
                                <div>
                                    @Html.TextBoxFor(m => m.cca_8, new { @class = "form-control", @id = "ucca_8", @maxlength = "50" })
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="text-black">Dose</label>
                                <div>
                                    @Html.TextBoxFor(m => m.cca_9, new { @class = "form-control", @id = "ucca_9", @maxlength = "50" })
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="text-black">Duration</label>
                                <div>
                                    @Html.TextBoxFor(m => m.cca_10, new { @class = "form-control", @id = "ucca_10", @maxlength = "50" })
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="text-black">Estimated Costs</label>
                                <div>
                                    @Html.TextBoxFor(m => m.cca_11, new { @class = "form-control", @id = "ucca_11", @maxlength = "50" })
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-12 col-md-12 col-lg-6">
                                <h5 class="font-weight-bold">MEDICAL PRACTITIONER’S DECLARATION </h5>
                                <p>I declare that I am the patient’s medical practitioner and that the particulars given are to the best of my knowledge true and correct.</p>
                                <label class="form-label">Doctor Name</label>
                                <div>
                                    <span class="font-weight-normal1 text-capitalize text-left">@emr.doc_name&nbsp;</span>
                                </div>
                                <label class="form-label mt-2">Doctor's Sign & Stamp</label>
                                <div>
                                    <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-6">
                                <h5 class="font-weight-bold">
                                    PATIENT’S DECLARATION :
                                </h5>
                                <p>I hereby authorize any Healthcare provider, Insurer, Employer or other organization to release any information regarding my medical condition & history to Aafiya for purpose of determining insurance benefits.</p>
                                <label class="form-label">Date</label>
                                <div>
                                    <label class="form-label text-red text-left" id="upsb_date_witness" name="">&nbsp;</label>
                                </div>
                                <label class="form-label mt-2">Patient‘s Signature{Parent if minor}</label>
                                <div id="upatimg">
                                    <img alt="Signature" src="" id="upat_sign" class="avatar avatar-xl bsquare" />
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <p class="text-red text-justify">
                                Aafiya Medical Billing Services reserve its right during the Agreement period with the service provider, survey and audit the
                                service provider’s operations with respect to its performance of services, the patient visit details and claims.
                            </p>
                        </div>
                        <div class="form-group bg-red-darker">
                            <p class="text-white text-justify text-center">
                                24/7 Claims Centre<br />
                                Helpline : 9714263 0666 | Tel : 971 4 283 8116 | Fax : 971 4 283 8115 | Email : claims@aafiya.ae | Website : www.aafiya.ae
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Row -->

    <div class="row mt-2">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center">
            <div class="btn-list btn-animation">
                <button type="submit" class="btn btn-warning btn-sm" id="btn_Update_AAFIYA">Save Changes</button>
                <button type="submit" class="btn btn-sm btn-outline-danger" id="btn_Delete_AAFIYA">Delete</button>
                <button type="button" class="btn btn-sm btn-outline-light " id="btn_Print_RadioDeci" onclick="PrintAAFIYA()">
                    <i class="fa fa-print">&nbsp;&nbsp;</i>Print
                </button>
                <div class="btn-group mr-2">
                    <div class="dropdown">
                        <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="openSignaturePad('patient')">Tab</a>
                            <a class="dropdown-item" onclick="openWacomTabSignaturePad('patient')">Wacom Tab</a>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-danger" id="btn_Close_EditAAFIYA" style="display:none">
                    Close
                </button>
            </div>
        </div>
    </div>
</form>

<script type="text/javascript">
    //#region Partial View Onload
        var formName1 = $(form_EditAAFIYA).closest('form').attr('name');
        $(function () {
            validate();
            set_date();
            GetSignaturename('patient');
            GetCheckedValues("@Model.cca_chk");
        });
    //#endregion

    //#region Load set Date
        var set_date = function () {
            $('#ucca_date1').bootstrapdatepicker({
                    format: "dd-MM-yyyy",
                    viewMode: "date",
                    todayHighlight: true,
                    autoclose: true,
                    multidate: false,
                    multidateSeparator: "-"
            });
            var d1 = "@Model.cca_date1";
            console.log(d1);
            if (d1 != "1/1/1950 12:00:00 AM") {
                $("#ucca_date1").bootstrapdatepicker("setDate", moment(new Date("@Model.cca_date1")).format("DD-MMMM-YYYY"));
            }
            else {
                $("#ucca_date1").bootstrapdatepicker("setDate", '');
            }
        }
    //#endregion

    //#region Get CheckedValues
        var GetCheckedValues = function (checknames) {
            var str = checknames;
            var myarray = str.split(',');
            for (var i = 0; i < myarray.length; i++) {
                $('.custom-control-input').each(function () {
                    if (this.id == myarray[i]) {
                        $("#" +this.id).attr('checked', 'checked');
                        $("#" +this.id).prop("checked", true);
                    }
                });
            }

        }
    //#endregion

    //#region Update  Button Click
        $('#btn_Update_AAFIYA').on('click', function (e) {
                e.preventDefault();
            if ($("#form_EditAAFIYA").valid()) {
                console.log($("#ccaId").val());
                $('#btn_Update_AAFIYA').removeClass("btn btn-success");
                $('#btn_Update_AAFIYA').addClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Update_AAFIYA').html("Updating the Record....");
                var cca_chkbox = "";
                $('.custom-control-input:checked').each(function (index) {
                    cca_chkbox = cca_chkbox + ',' + $(this).val();
                });
                var cca_checkbox = cca_chkbox.substring(1);
                var _dataInsert = {
                    "ccaId": @Model.ccaId,
                    "cca_appId": @emr.appId,
                    "cca_chk": cca_checkbox,
                    "cca_1": $("#ucca_1").val(),
                    "cca_2": $("#ucca_2").val(),
                    "cca_3": $("#ucca_3").val(),
                    "cca_4": $("#ucca_4").val(),
                    "cca_5": $("#ucca_5").val(),
                    "cca_6": $("#ucca_6").val(),
                    "cca_7": $("#ucca_7").val(),
                    "cca_8": $("#ucca_8").val(),
                    "cca_9": $("#ucca_9").val(),
                    "cca_10": $("#ucca_10").val(),
                    "cca_11": $("#ucca_11").val(),
                    "cca_12": '',
                    "cca_13": '',
                    "cca_14": '',
                    "cca_15": '',
                    "cca_16": '',
                    "cca_17": '',
                    "cca_18": '',
                    "cca_19": '',
                    "cca_20": '',
                    "cca_date1": moment($("#ucca_date1").val()).format("YYYY-MM-DD"),
                    "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
                }
                console.log(_dataInsert)
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("UpdateAAFIYA", "ReimbursementForms", new { area = "EMRForms" })",
                    dataType: 'JSON',
                    data: _dataInsert,
                    success: function (data) {
                        $('#btn_Update_AAFIYA').removeClass("btn btn-warning btn-loaders btn-icon");
                        $('#btn_Update_AAFIYA').addClass("btn btn-warning");
                        $('#btn_Update_AAFIYA').html("Save Changes");
                        if (data.isSuccess) {
                            if (data.isInserted) {
                                GetAAFIYA();
                                var alertPlaceholder = document.getElementById("Alert");
                                function alert(e, t) {
                                    var l = document.createElement("div");
                                    l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible"  role="alert">' + e +
                                        '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                                }
                                alert("<i class='fe fe-check-circle text-white'></i> AAFIYA Updated Successfully!", "success");
                                Timeout();
                                $("#aafiya_edit").show();
                                $("#aafiya_add").hide();
                            }
                            else {
                                let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                                    "<div class='alert alert-warning' role='alert'>" +
                                    "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                    "<strong>Warning.. AAFIYA Alredy Exists..</strong><br/>" +
                                    "</div></div>";
                                $("#error").html(html);
                            }
                        }
                        else
                        {
                            let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                                "<div class='alert alert-danger' role='alert'>" +
                                "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                "<strong>Validation Error.. Please correct before you submit the form!&nbsp;</strong><br/><ul>";
                            $.each(data.message, function (index, value) {
                                html += "<li><small>" + value + "</small><li>";
                                var elem = $("#" + index);
                                if (elem.hasClass("select2-hidden-accessible")) {
                                    $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                                }
                                else {
                                    $(elem).addClass(" is-invalid");
                                }

                                setTimeout(function () {
                                    if (elem.hasClass("select2-hidden-accessible")) {
                                        $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                    }
                                    else {
                                        $(elem).removeClass("is-invalid");
                                    }
                                }, 5000);
                            });
                            html += "</ul></div></div>";
                            $("#error").html(html);
                        }
                    },
                    error: function (xhr) {
                        $('#btn_Update_AAFIYA').removeClass("btn btn-warning btn-loaders btn-icon");
                        $('#btn_Update_AAFIYA').addClass("btn btn-warning");
                        $('#btn_Update_AAFIYA').html("Save Changes");
                        Timeout();
                    }
                });

            }
            else {
                $('.modal-body').animate({
                    scrollTop: ($('.has-error').offset().top - 300)
                }, 2000);
            }
        });
    //#endregion

    //#region Delete Click
        $('#btn_Delete_AAFIYA').on('click', function (e) {
            e.preventDefault();
            $('#btn_Delete_AAFIYA').removeClass("btn btn-success");
            $('#btn_Delete_AAFIYA').addClass("btn btn-success btn-loaders btn-icon");
            $('#btn_Delete_AAFIYA').html("Deleting the Record....");
            $.ajax({
                url: '@Url.Action("DeleteAAFIYA", "ReimbursementForms", new { area = "EMRForms" })?ccaId=' + @Model.ccaId,
                type: "POST",
                dataType: 'JSON',
                success: function (data) {
                    $('#btn_Delete_AAFIYA').removeClass("btn btn-success btn-loaders btn-icon");
                    $('#btn_Delete_AAFIYA').addClass("btn btn-warning");
                    $('#btn_Delete_AAFIYA').html("Delete");
                    if (data.isAuthorized) {
                        if (data.success) {
                            var alertPlaceholder = document.getElementById("Alert");
                            function alert(e, t) {
                                var l = document.createElement("div");
                                l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                            }
                            alert("<i class='fe fe-check-circle text-white'></i> AAFIYA Claim Deleted Successfully!", "success");
                            clearControls();
                            $("#aafiya_edit").hide();
                            $("#aafiya_add").show();
                            Addaafiya();
                        }
                        else {
                            let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                                "<div class='alert alert-warning' role='alert'>" +
                                "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                "<strong>Error!.. Failed to Delete..</strong><br/>" +
                                "</div></div>";
                            $("#error").html(html);
                        }
                    }
                    else {
                        var alertPlaceholder = document.getElementById("Alert");
                        function alert(e, t) {
                            var l = document.createElement("div");
                            l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                        }
                        alert("<i class='fe fe-check-circle text-white'></i> You do not have Enough Privileges to Delete this Designation!", "Access Denied!");
                    }
                },
                error: function (xhr) {
                    $('#btn_Delete_AAFIYA').removeClass("btn btn-success btn-loaders btn-icon");
                    $('#btn_Delete_AAFIYA').addClass("btn btn-Delete");
                    $('#btn_Delete_AAFIYA').html("Delete");
                    Timeout();
                }
            })
        });
    //#endregion

    //#region Wacom Tab Signature
        var openWacomTabSignaturePad = function (id) {
            var _data = {
                "patId": @emr.patId,
                "person": id,
                "form": "AAFIYA",
                "appId": @emr.appId,
                "formname":"AAFIYA",
                "formlink":"PrintAAFIYA",
                "eSign":""
            }
            $.ajax({
                type: "GET",
                url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion

    //#region Signature
        var openSignaturePad = function (id) {
            var _data = {
                "patId": @emr.patId,
                "person": id,
                "form": "AAFIYA",
                "appId": @emr.appId,
                "formname":"AAFIYA",
                "formlink":"PrintAAFIYA",
                "eSign":""
            }
            $.ajax({
                type: "GET",
                url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                    GetSignaturename('patient');
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion

    //#region Get Signature
        var GetSignaturename = function  (person) {
            $.ajax({
                url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=AAFIYA',
                    type: "GET",
                    dataType: "json",
                    async: false,
                    success: function (response) {
                    console.log(response);
                    let sign = response[0].psb_sign;
                    var date = moment(response[0].psb_date_created).format("DD-MM-YYYY HH:mm");
                        if (response[0].person == "patient") {
                        $("#upatimg").show();
                        $("#upat_sign").attr("src", sign);
                        $("#upsb_date_witness").text(date);
                        $("#upat_sign").removeClass("avatar avatar-xxl bsquare");
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                    alert(xhr);
                }

            });
        };
    //#endregion

    //#region Validation Initialization
        var validate = function () {

            $('#ucca_date1').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;

                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });
        }
    //#endregion

    //#region Alert Timeout
        function Timeout() {
            window.setTimeout(function () {
                $(".alert").fadeTo(500, 0).slideUp(500, function () {
                    $(this).remove();
                });
            }, 4200);
        }
    //#endregion

    //#region Clear Controls
        var clearControls = function () {
            $("#ucca_1").val("");
            $("#ucca_2").val("");
            $("#ucca_3").val("");
            $("#ucca_4").val("");
            $("#ucca_5").val("");
            $("#ucca_6").val("");
            $("#ucca_7").val("");
            $("#ucca_8").val("");
            $("#ucca_9").val("");
            $("#ucca_10").val("");
            //$("#ucca_11").val("");
            //$("#ucca_12").val("");
            //$("#ucca_13").val("");
            //$("#ucca_14").val("");
            //$("#ucca_15").val("");
            //$("#ucca_16").val("");
            //$("#ucca_17").val("");
            //$("#ucca_18").val("");
            //$("#ucca_19").val("");
            //$("#ucca_20").val("");
            $("#ucca_date1").bootstrapdatepicker("setDate", '');
            var elements = document.getElementsByClassName('custom-control-input');
            Array.prototype.forEach.call(elements, function (element) {
                element.checked = false;
            });
        }
    //#endregion

    //#region Print AAFIYA Request
        function PrintAAFIYA() {
            window.open("@Url.Action("PrintAAFIYA", "ReimbursementForms", new { area = "EMRForms" })?ccaId=" + @Model.ccaId)
        }
    //#endregion

</script>

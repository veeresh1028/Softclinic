@model BusinessEntities.EMRForms.MednetTakaful
@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@{
    ViewBag.Title = "Print MednetTakaful Reimbursement Claim Form";
    Layout = "~/Areas/EMR/Views/Shared/_EMR_Layout.cshtml";

    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}
<div class="row mb-2 mt-2 text-center">
    <div class="col-md-12">
        <button id="btnPrint" type="button" onclick="printDiv('printDiv')" class="btn btn-primary d-print-none"><i class="si si-printer"></i> Print</button>
    </div>
</div>
<div class="row fs-14" id="printDiv">
    <div class="col-md-12">
        <div class="card overflow-hidden">
            <div class="card-body">

                <div class="text-center">
                    <img src="@Model.set_header_image" />
                </div>
                <div>
                    <hr class="new4" />
                </div>
                <div class="row">
                    <div class="card-body pb-0">
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                                        <label class="col-md-4 form-label">Card Holder’s Name<span class="text-danger">*</span></label>
                                        <div class="d-flex  justify-content-center w-8  form-label">
                                            :
                                        </div>
                                        <div class="col-md-6">
                                            <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_name&nbsp;</span>
                                        </div>
                                    </div>
                                    <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                                        <label class="col-md-4 form-label">Date of Birth</label>
                                        <div class="d-flex  justify-content-center w-8  form-label">
                                            :
                                        </div>
                                        <div class="col-md-6">
                                            <span class="font-weight-normal1 text-capitalize text-left">@emr.pi_insno&nbsp;</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                                        <label class="col-md-4 form-label">Valid Until<span class="text-danger">*</span></label>
                                        <div class="d-flex  justify-content-center w-8  form-label">
                                            :
                                        </div>
                                        <div class="col-md-6">
                                            <span class="font-weight-normal1 text-capitalize text-left">@emr.pi_edate&nbsp;</span>
                                        </div>
                                    </div>
                                    <div class="d-flex col-sm-12 col-md-6 col-lg-6">
                                        <label class="col-md-4 form-label">	Contact Telephone</label>
                                        <div class="d-flex  justify-content-center w-8  form-label">
                                            :
                                        </div>
                                        <div class="col-md-6">
                                            <span class="font-weight-normal1 text-capitalize text-left">@emr.pat_mob&nbsp;</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row ps-2">
                                    <h3 class="card-title font-weight-bold">To be Completed by the Treating Physician</h3>
                                </div>
                                <div class="row ps-2">
                                    <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
                                        <div class="card border-dark">
                                            <div class="card-header bg-gray">
                                                <h6 class="card-title">
                                                    Dear Doctor: The beneficiary participating in the MedNet Program is consulting you for medical care and kindly requests you to complete this
                                                    form.
                                                </h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-horizontal">
                                                    <div class="form-group row">
                                                        <label class="col-md-3 text-black">Diagnosis</label>
                                                        <div class="col-md-9">
                                                            <label class="text-black text-red text-left" id="diagnosis" name="">&nbsp;</label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label class="col-md-3 text-black">Date of onset of symptoms</label>
                                                        <div class="col-md-3">
                                                            <label class="form-label text-black text-left">@Model.cmtn_d21&nbsp;</label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label class="col-md-3 text-black">
                                                            If, hospitalized
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="form-label text-black text-left">@Model.cmtn_d22&nbsp;</label>
                                                        </div>
                                                        <label class="col-md-3 text-black">
                                                            Discharge
                                                        </label>
                                                        <div class="col-md-3">
                                                            <label class="form-label text-black text-left">@Model.cmtn_d23&nbsp;</label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label class="col-md-3 text-black">Case Management</label>
                                                        <div class="col-md-9">
                                                            <label class="form-label text-black text-left">@Model.cmtn_5&nbsp;</label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label class="col-md-3 text-black">Actual Costs</label>
                                                        <div class="col-md-9">
                                                            <label class="form-label text-black text-left">@Model.cmtn_6&nbsp;</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row ps-2">
                    <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <h3 class="card-title font-weight-bold">Treatment Plan</h3>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-6 col-lg-6">
                                        <label class="form-label">
                                            Diagnosis
                                        </label>
                                        <label class="text-black text-red text-left" id="diagnosis1" name="">&nbsp;</label>
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-6">
                                        <label class="form-label">
                                            Pharmaceuticals
                                        </label>
                                        <label class="text-black text-red text-left" id="Prescriptions_details" name="">&nbsp;</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-6 col-lg-6">
                                        <label class="form-label text-red text-left" id="upsb_date_witness" name="">&nbsp;</label>
                                        <label class="text-black">
                                            Date
                                        </label>
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-6">
                                        <div class="form-group mb-3" style="display:none" id="upatimg"><img alt="Signature" src="" id="upat_sign" class="avatar avatar-xl bsquare" /></div>
                                        <label class="text-black">
                                            Cardholder’s signature
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-md-3 text-black">Physician’s Name</label>
                                    <div class="col-md-3">
                                        <span class="font-weight-normal1 text-capitalize text-left">@emr.doc_name&nbsp;</span>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-md-3 text-black">Telephone No.</label>
                                    <div class="col-md-3">
                                        <span class="font-weight-normal1 text-capitalize text-left">@emr.emp_tel&nbsp;</span>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-md-3 text-black">Date</label>
                                    <div class="col-md-3">
                                        <span class="font-weight-normal1 text-capitalize text-left">@emr.app_fdate&nbsp;</span>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-md-3 text-black">Signature</label>
                                    <div class="col-md-3">
                                        <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="form-label text-decoration-underline">CHECKLIST</label>
                                    <div class="col-md-12">
                                        <ul>
                                            <li class="d-flex">
                                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                                        <input type="checkbox" class="custom-control-input" name="cmtn_chk" value="1" id="1">
                                                        <span class="custom-control-label"></span>
                                                    </label>
                                                </div>Completed “Reimbursement Form”
                                            </li>
                                            <li class="d-flex">
                                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                                        <input type="checkbox" class="custom-control-input" name="cmtn_chk" value="2" id="2">
                                                        <span class="custom-control-label"></span>
                                                    </label>
                                                </div>Full and Complete Medical Report / Diagnosis / Discharge summary from the treating doctor
                                            </li>
                                            <li class="d-flex">
                                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                                        <input type="checkbox" class="custom-control-input" name="cmtn_chk" value="3" id="3">
                                                        <span class="custom-control-label"></span>
                                                    </label>
                                                </div>Original itemized invoices or receipts for the amount claimed (Invoice must show cost per service)
                                            </li>
                                            <li class="d-flex">
                                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                                        <input type="checkbox" class="custom-control-input" name="cmtn_chk" value="4" id="4">
                                                        <span class="custom-control-label"></span>
                                                    </label>
                                                </div>Personalized SOAP / Maternity SOAP / Dental SOAP (if applicable)
                                            </li>
                                            <li class="d-flex">
                                                <div class="custom-controls d-lg-flex d-md-flex flex-row justify-content-left">
                                                    <label class="custom-control custom-checkbox ms-sm-2 md-md-2 ms-lg-2">
                                                        <input type="checkbox" class="custom-control-input" name="cmtn_chk" value="5" id="5">
                                                        <span class="custom-control-label"></span>
                                                    </label>
                                                </div>Copies of results of diagnostic tests
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <p class="text-justify">
                                        For treatment within UAE, please submit your claim <span class="font-weight-bold">within 60 days</span> from the date of treatment. For treatment
                                        outside UAE, the claim must be submitted <span class="font-weight-bold">within 90 days</span> from the date of treatment.
                                    </p>
                                </div>
                                <div class="form-group row">
                                    <label class="text-justify form-label font-italic text-decoration-underline">
                                        IN-HOSPITAL NON- EMERGENCY ADMISSION
                                    </label>
                                </div>
                                <div class="form-group row">
                                    <p class="text-justify">
                                        The MedNet Claims Centre should be notified, at least 7 days in advance for arranging elective treatment on free
                                        access basis at a network facility outside UAE, if applicable.
                                    </p>
                                    <p class="text-justify">
                                        <span class="font-weight-bold">Within UAE</span> (24 hours a day, 7-days a week)
                                    </p>
                                    <p class="text-justify">
                                        Toll Free Phone - 800 4882
                                    </p>
                                    <p class="text-justify">
                                        Toll Free Fax - 800 4883
                                    </p>
                                    <p class="text-justify">
                                        <span class="font-weight-bold"> Outside UAE</span> (24 hours a day, 7- days a week)
                                    </p>
                                    <p class="text-justify">
                                        Phone - 00 971 4 3900749
                                    </p>
                                    <p class="text-justify">
                                        Fax - 00 971 4 3908598
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <img src="@Model.set_footer_image" />
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    //#region Partial View Onload
        $(function () {
            Get_AllPatientDiagnosis();
            Get_AllPatientDrugs();
            GetSignaturename('patient');
            GetCheckedValues("@Model.cmtn_chk");
        });
    //#endregion

    //#region Print
        function printDiv(divName) {
            var printContents = document.getElementById(divName).innerHTML;
            var originalContents = document.body.innerHTML;
            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
        }
    //#endregion

    //#region Get CheckedValues
        var GetCheckedValues = function (checknames) {
            var str = checknames;
            var myarray = str.split(',');
            for (var i = 0; i < myarray.length; i++) {
                $('.custom-control-input').each(function () {
                    if (this.id == myarray[i]) {
                        $("#" +this.id).attr('checked', 'checked');
                        $("#" +this.id).prop("checked", true);
                    }
                });
            }
        }
    //#endregion

    //#region Get Signature
        var GetSignaturename = function  (person) {
            $.ajax({
                url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=MednetTakaful',
                    type: "GET",
                    dataType: "json",
                    async: false,
                success: function (response) {
                    console.log("fgxghszd");
                    console.log(response);
                    let sign = response[0].psb_sign;
                    var date = moment(response[0].psb_date_created).format("DD-MM-YYYY HH:mm");
                    if (response[0].person == "patient") {
                        $("#upatimg").show();
                        $("#upat_sign").attr("src", sign);
                        $("#upsb_date_witness").text(date);
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                    alert(xhr);
                }

            });
        };
    //#endregion

    //#region Load Get All Diagnosis
       var Get_AllPatientDiagnosis = function () {
           $.ajax({
               type: "GET",
               url: "@Url.Action("GetAllPatientDiagnosis", "ReimbursementForms", new { area = "EMRForms" })?appId=" + "@emr.appId" + "&patId=" + @emr.patId,
               success: function (response) {
                   if (response.length > 0) {
                       $('#diagnosis1').text(response[0].Diagnosis);
                       $('#diagnosis').text(response[0].Diagnosis);
                   }
               },
               error: function (xhr) {
                   console.log(xhr);
               }
           })
       }
   //#endregion

    //#region Load Get Drugs
       var Get_AllPatientDrugs = function () {
           $.ajax({
               type: "GET",
               url: "@Url.Action("Get_AllPatientDrugs", "ReimbursementForms", new { area = "EMRForms" })?appId=" + "@emr.appId" + "&patId=" + @emr.patId,
               success: function (response) {
                   if (response.length > 0) {
                       $('#Prescriptions_details').text(response[0].Prescriptions);
                   }
               },
               error: function (xhr) {
                   console.log(xhr);
               }
           })
       }
   //#endregion
</script>
<style>
    hr.new4 {
        border: 5px solid gray;
        height: 5px;
    }
</style>

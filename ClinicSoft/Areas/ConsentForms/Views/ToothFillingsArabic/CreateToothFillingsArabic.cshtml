@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@model BusinessEntities.ConsentForms.ToothFillingsArabic

@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}

<form id="form_ToothFillingsArabic" autocomplete="off" name="ToothFillingsArabic" ondrop="return false;" onpaste="return false;" oncut="return false;">
    @Html.AntiForgeryToken()
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-12 text-right" dir="rtl">
            <div class="border">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="row mt-2">
                        <div class="col-sm-12 col-md-6 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black text-align-left"> اسم المريض</label></div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-4">
                            <label class="form-label text-red text-left text-capitalize">@emr.pat_name</label>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> الهوية الإماراتية</label></div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-4">
                            <label class="form-label text-red text-left">@emr.pat_emirateid</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2 mb-2">
                            <div class="form-group mb-3 text-align-left"><label class="form-label text-black ">رقم الملف</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_code</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> تاريخ الميلاد</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_dob</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> الجنسية</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_nationality</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">جنس</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_gender</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">اسم الطبيب</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.doc_name</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">تاريخ</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.app_fdate</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5 mt-5 text-justify" dir="rtl">
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p>
                أنا أفهم أن علاج أسناني الذي ينطوي على وضع الحشوات المركبة (الكمبوزيت) التي قد تكون أكثر جمالية في المظهر من بعض المواد التقليدية والخلفية، مثل الملغم الفضي أو الذهب، التي قد تنطوي على بعض المخاطر. وهناك أيضا إمكانية الفشل في تحقيق النتائج التي قد تكون مرغوبة أو متوقعة. أنا أوافق على تحمل تلك المخاطر التي قد تحدث على الرغم من العناية والإجتهاد من قبل طبيب الأسنان في تقديم هذا العلاج
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p class="text-decoration-underline font-weight-semibold">
                الفوائد :
            </p>
            <p>
                .القضاء على تسوس الأسنان، وتخفيف الألم، وملء حفرة أو مساحة في السن، وتغطية المناطق المتآكلة، وحماية الأسطح الحساسة
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p class="text-decoration-underline font-weight-semibold">
                عواقب عدم إنجاز العمل أو التأجيل :
            </p>
            <p>
                .قد تفقد الأسنان، قد يحدث كسر للأسنان، تسوس الأسنان يمكن أن يزداد سوءا،قد يؤدي للحاجة إلى علاج العصب
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p class="text-decoration-underline font-weight-semibold">
                البدائل :
            </p>
            <p>.الحشوات المؤقتة</p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p class="text-decoration-underline font-weight-semibold">
                المضاعفات المحتملة:
            </p>
            <p>
                .الأسنان يمكن أن تجمع خُراجات بسبب الحشوات، قد ينكسر السن، قد يكون السن حساس لتغير درجات الحرارة، يمكن للحشوات أن تسقط
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p class="text-decoration-underline font-weight-semibold">
                ضرورة علاج العصب:
            </p>
            <p>
                 عندما يتم وضع أي نوع من الحشوات أو استبدالها، و تحضير السن للحشوات  في كثير من الأحيان يتطلب إزالة بنية الأسنان بشكل كافي لضمان عدم تعرض المريض للخطر ولتوفير بنية أسنان سليمة لوضع الحشوات في بعض الأحيان هذا قد يؤدي الى التعرض أو الصدمة لعصب السن
            </p>
            <p>
                 في حالة عدم شفاء العصب، والذي غالبا ما يظهر بسبب حساسية شديدة أو خراج ، قد يتطلب الأمر معالجة عصب السن أو خلع السن
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p class="text-decoration-underline font-weight-semibold"><  إصابة الأعصاب:</p>
            <p>
                هناك احتمال إصابة أعصاب الشفتين والفكين والأسنان واللسان أو غيرها من الأنسجة عن طريق الفم أو الوجه من أي علاجات للأسنان، ولا سيما تلك التي تنطوي على إعطاء التخدير الموضعي. والخدر الناتج الذي  يحدث عادة ما يكون مؤقتا، ولكن في حالات نادرة يمكن أن تكون دائمة
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p class="text-decoration-underline font-weight-semibold">
                الجماليات أو المظهر:
            </p>
            <p>
                وسوف تبذل الجهود ليكون اللون متقارب مع لون الأسنان الطبيعية. ومع ذلك يرجع ذلك إلى حقيقة أن هناك العديد من العوامل التي تؤثر على لون الأسنان، قد لا يكون من الممكن أن تتطابق تماما مع لون الأسنان. أيضا، على مدى فترة من الزمن، الحشوات المركبة، بسبب سوائل الفم، الأطعمة المختلفة ، والتدخين، وما إلى ذلك قد تظهر تغييرا في اللون. طبيب الأسنان ليس لديه السيطرة على هذه العوامل. قد يؤدي تبييض الأسنان أيضا إلى أن تصبح الحشوات في الأسنان الأمامية داكنة نسبيا
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p class="text-decoration-line font-weight-semibold">
                الكسر، الخلع أو فشل الربط السني:
            </p>
            <p>
                بسبب ضغط المضغ المبالغ فيه أو غيرها من القوى الصادمة، الحشوات المركبة أو الحشوات الجمالية الملتصقة مع الحشوات المركبة من الممكن فكها أو كسرها. يمكن لمينا المادة الصمغية أن تفشل مما يؤدي الى التسرب والتسوس المتكرر.طبيب الأسنان ليس لديه السيطرة على هذه العوامل
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p>
                وأنا أفهم أن جميع الأدوية محتمل أن يكون لديها مخاطر مصاحبة، وآثار جانبية وتفاعلات الأدوية. ولذلك فمن الأهمية أن أخبر طبيب الأسنان الخاص بي بجميع الأدوية التي استخدمها حالياً >
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p>
                أوافق على التقاط الصور الفوتوغرافية، التصوير والتسجيل و الأشعة السينية بشرط لا يتم الكشف عن هويتي
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p>
                ومن مسؤوليات المريض أن يلتمس الانتباه في حالة حدوث أي مشاكل غير متوقعة. يجب على المريض اتباع جميع التعليمات، بما في ذلك جدولة وحضور جميع المواعيد. قد يؤدي عدم الحفاظ على المواعيد الى فشل نهائي للحشوات. في حالة أني أود التوقف عن العلاج، فقد تم إبلاغي وفهمت المخاطر المرتبطة مع ترك حالتي بدون علاج، ادرك أن صحتي العامة قد تتأثر بقراري. . لذا لن أقوم بتحميل الطبيب ، طاقم العمل أو أي شخص مرتبط بممارسة طب الأسنان المسؤؤلية للتغير الذي سيحصل لصحتي العامة الناتج عن هذا الشرط . لقد اتيحت لي الفرصة لطرح اسئلة حول حالتي، خيارات العلاج و رفض العلاج. لقد قام مزود الموقع ادناه الإجابة على جميع أسئلتي. لقد فهمت النطاق الكامل للوضع وانا اخذ قرار الموافقة
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 text-decoration-underline font-weight-semibold">
            <p>  استمارة الموافقة المسبقة :</p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <p>
                الرسوم (إن وجدت) لهذه الخدمة لقد تم شرحها وهي مرضية. من خلال التوقيع على هذا النموذج أنا أعطي بحرية موافقتي للسماح للدكتور <label class="text-red">@emr.doc_name</label>أو/ و أحد مساعديه لتقديم العلاج لتقديم العلاج أو اي دواء و /أو التخدير الذي يعتبر ضروري للعلاج
            </p>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <span>
                <input type="radio" id="itfa_21" value="Yes" name="itfa_2" class="me-4" />&nbsp;
                لقد أتيحت لي الفرصة لطرح الأسئلة وقمت بالموافقة على العلاج المقترح كما هو موضح أعلاه
            </span>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <span>
                <input type="radio" id="itfa_22" value="No" name="itfa_2" class="me-4" />&nbsp;
                قد قمت برفض إعطاء الموافقة للعلاج المقترج كما هو موضح أعلاه وقد تم شرح العواقب المحتملة المرتبطة بالرفض
            </span>
        </div>
    </div>

    <div class="row mt-2" dir="rtl">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center table-responsive">
            <table class="table table-bordered table-condensed">
                <tr>
                    <td colspan="3" class="font-weight-bold text-danger fs-18" width="100%">
                        <u>قم بالتوقيع هنا فقط إذا تمت الموافقة على جميع الأسئلة </u>
                    </td>
                </tr>
                <tr>
                    <td width="33%">
                        <div id="pat_sign_box" class="d-none">
                            <img alt="stamp" id="pat_sign" class="avatar avatar-xl bsquare" />
                        </div>
                    </td>
                    <td width="34%">
                        <div id="wit_sign_box" class="d-none">
                            <img alt="stamp" id="wit_sign" class="avatar avatar-xl bsquare" />
                        </div>
                    </td>
                    <td width="33%">
                        <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                    </td>
                </tr>
                <tr>
                    <td width="33%">
                        سم المريض
                        <br />
                        <label class="form-label text-red">@emr.pat_name&nbsp;</label>
                        لتاريخ
                        <br />
                        <label class="form-label text-red">@emr.app_fdate&nbsp;</label>

                    </td>
                    <td width="34%">
                        هوية الشاهد
                        <br />
                        @Html.TextBoxFor(m => m.itfa_1, new { @class = "form-control text-center", @id = "itfa_1", @maxlength = "200" })

                        التاريخ
                        <br />
                        <label class="form-label text-red">@emr.app_fdate&nbsp;</label>
                    </td>
                    <td width="33%">
                        وقيع الطبيب
                        <br />
                        <label class="form-label text-red">@emr.doc_name&nbsp;</label>

                        التاريخ
                        <label class="form-label text-red">@emr.app_fdate&nbsp;</label>

                    </td>
                </tr>
                <tr>
                    <td class="font-weight-semibold text-blue text-center" width="33%">
                        توقيع المريض/ الممثل المفوض قانونا
                        <br />
                        <div class="btn-group mr-2">
                            <div class="dropdown">
                                <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" onclick="openSignaturePad('patient')">Tab</a>
                                    <a class="dropdown-item" onclick="openWacomTabSignaturePad('patient')">Wacom Tab</a>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="font-weight-semibold text-blue  text-center" width="34%">
                        توقيع الشاهد
                        <br />
                        <div class="btn-group mr-2">
                            <div class="dropdown">
                                <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> witness
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" onclick="openSignaturePad('witness')">Tab</a>
                                    <a class="dropdown-item" onclick="openWacomTabSignaturePad('witness')">Wacom Tab</a>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="font-weight-semibold text-blue text-center" width="33%">توقيع الطبيب </td>
                </tr>
            </table>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center">
            <div class="btn-list btn-animation">
                <button type="submit" class="btn btn-success btn-sm" id="btn_Insert">Save</button>
                <button type="button" class="btn btn-outline-dark btn-sm" id="btn_Reset">Reset</button>
                <button type="button" class="btn btn-danger btn-sm d-none" id="btn_Delete">Delete</button>
                <button type="button" class="btn btn-sm btn-outline-success d-none" id="btn_Print"> Download/Print </button>
            </div>
        </div>
    </div>
</form>

<script type="text/javascript">


    $(function () {
        if ("@emp_designation.ToString()" === "Super Administrator") {
            $("#btn_Insert").show();
        }
        else {
            if ("@emr.set_emr_lock" == "NoLock") {
                $("#btn_Insert").show();
            }
            else {
                if ("@emr.app_ae_date" >= "@emr.today") {
                    $("#btn_Insert").show();
                }
                else {
                    $("#btn_Insert").hide();
                }
            }
        }
        validate();
    });

    //#region Validation Initialization
    var validate = function () {
        $("#form_ToothFillingsArabic").validate({
            rules: {
                itfa_1: {
                    required: true
                },


            },
            messages: {

                itfa_1: {
                    required: "Please Enter Witness ID!"
                },

            },
            highlight: function (element) {
                var elem = $(element);
                $(element).parent().addClass('has-error');
                //error_timeout(elem.attr("id"));
            },
            unhighlight: function (element) {
                var elem = $(element);
                $(element).parent().removeClass('has-error');
            },
            errorElement: 'span',
            errorClass: 'text-danger fw-bold',
            errorPlacement: function (error, element) {
                var elem = $(element);
                if (element.parent('.input-group').length) {
                    error.insertAfter(element.parent());
                } else {
                    error.insertAfter(element);
                }
            }
        });

    }
    //#endregion

    //#region Add  Click
    $('#btn_Insert').on('click', function (e) {
        e.preventDefault();
        if ($("#form_ToothFillingsArabic").valid()) {
            $('#btn_Insert').removeClass("btn btn-sm btn-success");
            $('#btn_Insert').addClass("btn btn-sm btn-success btn-loaders btn-icon");
            $('#btn_Insert').html("Saving the Record....");


            //var icca_4_ = $.map($(':checkbox[name=icca_4]:checked'), function (n, i) {
            //    return n.value;
            //}).join(',');

            var itfa_2 = "";

            if ($('#itfa_21').prop('checked')) {
                itfa_2 = "Yes";
            }
            else if ($('#itfa_22').prop('checked')) {
                itfa_2 = "No";
            }

            var _dateInsert = {
                "itfaId": 0,
                "itfa_appId": @emr.appId,
                "itfa_1": $("#itfa_1").val(),
                "itfa_2": itfa_2,
            "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
            }

            $.ajax({
                type: "Post",
                url: "@Url.Action("InsertToothFillingsArabic", "ToothFillingsArabic", new {area = "ConsentForms" })",
                dataType: 'JSON',
                data: _dateInsert,
                success: function (data) {
                    $('#btn_Insert').removeClass("btn btn-sm btn-success btn-loaders btn-icon");
                    $('#btn_Insert').addClass("btn btn-sm btn-success");
                    $('#btn_Insert').html("Save changes");


                    if (data.isSuccess) {
                        if (data.isInserted) {
                            var alertPlaceholder = document.getElementById("Alert");

                            function alert(e, t) {
                                var l = document.createElement("div");
                                l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" role="alert">' + e +
                                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                            }
                            alert("<i class='fe fe-check-circle text-white'></i>ToothFillings Arabic Consent Form Saved Successfully!", "success");

                            Timeout();

                            $("#btn_Delete").removeClass("d-none");
                            $("#btn_Print").removeClass("d-none");
                        }
                        else {
                            let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                                "<div class='alert alert-warning' role='alert'>" +
                                "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                "<strong>Warning.. ToothFillings Arabic Consent Form already Exists..</strong><br/>" +
                                "</div></div>";
                            $("#Alert").html(html);
                        }
                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                        "<div class='alert alert-danger' role='alert'>" +
                        "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                        "<strong>Validation Error.. Please correct before you submit the form!&nbsp;</strong><br/><ul>";

                        $.each(data.message, function (index, value) {
                            html += "<li><small>" + value + "</small><li>";
                            var elem = $("#" + index);
                            if (elem.hasClass("select2-hidden-accessible")) {
                                $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                            }
                            else {
                                $(elem).addClass(" is-invalid");
                            }

                            setTimeout(function () {
                                if (elem.hasClass("select2-hidden-accessible")) {
                                    $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                }
                                else {
                                    $(elem).removeClass("is-invalid");
                                }
                                }, 5000);
                        });

                        html += "</ul></div></div>";

                        $("#error").html(html);
                    }
                },
                error: function (xhr) {
                    $('#btn_Insert').removeClass("btn btn-sm btn-success btn-loaders btn-icon");
                    $('#btn_Insert').addClass("btn btn-sm btn-warning");
                    $('#btn_Insert').html("Add");
                    Timeout();
                }
            });
        }
        else {
            $('.modal-body').animate({
                scrollTop: ($('.has-error').offset().top - 300)
            }, 2000);
        }

    });
    //#endregion Add Click

        //#region Delete Click
    $('#btn_Delete').on('click', function (e) {
        e.preventDefault();
        $('#btn_Delete').removeClass("btn btn-success");
        $('#btn_Delete').addClass("btn btn-success btn-loaders btn-icon");
        $('#btn_Delete').html("Deleting the Record....");

        $.ajax({
            url: '@Url.Action("DeleteToothFillingsArabic", "ToothFillingsArabic", new { area = "ConsentForms" })?appId=' + @emr.appId,
            type: "POST",
            dataType: 'JSON',
            success: function (data) {
                $('#btn_Delete').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Delete').addClass("btn btn-warning");
                $('#btn_Delete').html("Delete");
                if (data.isAuthorized) {
                    if (data.success) {
                        var alertPlaceholder = document.getElementById("Alert");
                        function alert(e, t) {
                            var l = document.createElement("div");
                            l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                        }
                        alert("<i class='fe fe-check-circle text-white'></i> ToothFillings Arabic Consent Form Deleted Successfully!", "success");
                        clearControls();
                        Timeout();

                        $('#btn_Delete').addClass("d-none");
                        $("#pat_sign_box").addClass("d-none");
                        $("#wit_sign_box").addClass("d-none");
                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                            "<div class='alert alert-warning' role='alert'>" +
                            "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                            "<strong>Error!.. Failed to Delete..</strong><br/>" +
                            "</div></div>";
                        $("#error").html(html);
                    }
                }
                else {
                    var alertPlaceholder = document.getElementById("Alert");
                    function alert(e, t) {
                        var l = document.createElement("div");
                        l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                            '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                    }
                    alert("<i class='fe fe-check-circle text-white'></i> You do not have Enough Privileges to Delete this Designation!", "Access Denied!");
                }
            },
            error: function (xhr) {
                $('#btn_Delete').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Delete').addClass("btn btn-Delete");
                $('#btn_Delete').html("Delete");
                Timeout();
            }
        })
    });
//#endregion

    //#region Reset
    $('#btn_Reset').on('click', function (e) {
        e.preventDefault();
        clearControls();
    });
    //#endregion Reset

    //#region Print
$('#btn_Print').on('click', function (e) {
    e.preventDefault();
    $('#btn_Print').removeClass("btn btn-sm btn-success");
    $('#btn_Print').addClass("btn btn-sm btn-success btn-loaders btn-icon");
    $('#btn_Print').html("Printing the Record....");
    $.ajax({
        type: "Get",
        url: "@Url.Action("PrintPDFConsent", "ToothFillingsArabic", new {area = "ConsentForms" })?appId=" + @emr.appId + "&form=ToothFillingsArabic",
        dataType: 'JSON',
        success: function (data) {
            if (data.isAuthorized) {
                if (data.success) {
                    window.location.href = data.message.pdfPath
                }
            }
        },
        error: function (xhr) {
            console.log(xhr);
        }
    });
});
//#endregion Print

    //#region Clear Controls
    var clearControls = function () {
        $(".form-control").val("");
        $("input[name='itfa_2']:radio").prop('checked', false);
        $(".form-control-sm").val("");
        $("#pat_sign,#wit_sign").attr("src", "");
    }
    //#endregion Clear Controls
    //#region Wacom Tab Signature
    var openWacomTabSignaturePad = function (id) {
             var _data = {
                 "patId": @emr.patId,
                 "person": id,
                 "form": "ToothFillingsArabic",
                 "appId": @emr.appId,
                 "formname":"ToothFillings Arabic",
                 "formlink":"",
                 "eSign":""
             }
            $.ajax({
                type: "GET",
                url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion
    //#region Signature
    var openSignaturePad = function (id) {
        var _data = {
            "patId": @emr.patId,
            "person": id,
            "form": "ToothFillingsArabic",
            "appId": @emr.appId,
            "formname":"ToothFillings Arabic",
            "formlink":"",
            "eSign":""
        }
        $.ajax({
            type: "GET",
            url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
            contentType: "application/json",
            dataType: "html",
            data: _data,
            success: function (response) {
                $("#signature_pad_body").html(response);
                $("#signature_pad").modal("show");
            },
            error: function (xhr) {
                console.log("Error :" + xhr.statusText);
            }
        });
    }
    //#endregion Signature

    $('#signature_pad').on('hidden.bs.modal', function () {
        if (localStorage.getItem("sign") != null) {
            GetSignaturename('patient');
            GetSignaturename('witness');
            localStorage.removeItem("sign");
        }
    });

    //#region Get Signature
    var GetSignaturename = function  (person) {
        $.ajax({
            url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=ToothFillingsArabic',
            type: "GET",
            dataType: "json",
            async: false,
            success: function (response) {
                console.log(response);
                let sign = response[0].psb_sign;
                if (response[0].person == "patient") {
                    $("#pat_sign_box").removeClass("d-none");
                    $("#pat_sign").attr("src", sign);
                }
                if (response[0].person == "witness") {
                    $("#wit_sign_box").removeClass("d-none");
                    $("#wit_sign").attr("src", sign);
                }
            },
            error: function (xhr) {
                console.log(xhr);
                alert(xhr);
            }

        });
    };
    //#endregion Get Signature

    //#region Alert Timeout
    function Timeout() {
        window.setTimeout(function () {
            $(".alert").fadeTo(500, 0).slideUp(500, function () {
                $(this).remove();
            });
        }, 4200);
    }
    //#endregion Alert Timeout
</script>
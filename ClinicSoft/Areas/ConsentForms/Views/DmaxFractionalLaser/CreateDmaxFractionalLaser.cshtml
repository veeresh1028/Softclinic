@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@model BusinessEntities.ConsentForms.DmaxFractionalLaser

@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}
<form id="form_DmaxFractionalLaser" autocomplete="off" name="DmaxFractionalLaser" ondrop="return false;" onpaste="return false;" oncut="return false;">
    @Html.AntiForgeryToken()
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="border">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="row mt-2">
                        <div class="col-sm-12 col-md-6 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black text-align-left"> Patient Name</label></div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-4">
                            <label class="form-label text-red text-left text-capitalize">@emr.pat_name</label>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> Emirates ID</label></div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-4">
                            <label class="form-label text-red text-left">@emr.pat_emirateid</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2 mb-2">
                            <div class="form-group mb-3 text-align-left"><label class="form-label text-black ">File No</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_code</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> DOB</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_dob</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> Nationality</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_nationality</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Gender</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_gender</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Doctor's Name</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.doc_name</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Date</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.app_fdate</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5 mt-5 col-sm-12 col-md-12 col-lg-12 text-justify">
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">This Informed Consent Form has two parts:</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Information Sheet (to share information about the treatment with you)</li>
                <li class="listunorder" style="border: none;">Certificate of Consent (for signatures if you agree to go ahead with the treatment)</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">PART I: Information Sheet</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">The following has been explained to the patient in general terms.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2"><label class="font-weight-semibold">Fractional</label> laser works by delivering precise microbeams of laser light into the layers of skin, creating deep, narrow columns of heat into the tissue or Microthermal Treatment Zones (MTZ’s). These MTZs stimulate the tissues natural healing process that results in fast growth of healthy new collagen rich skin. The procedure can be used on the face, neck, chest, arms and hands. The intended benefits Fractional Laser include but are not limited to the reduction of acne scars, other scars, photo ageing, skin laxity, improvement of skin texture, pigment, wrinkles and fine lines. </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">What to expect:</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">It should be understood that all procedures carry certain risks. The potential risks and complications from this type of procedure include but not limited to:</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <label class="font-weight-semibold"> PAIN :</label> The stinging or burning sensation from the procedure can produce a moderate amount of discomfort. An anesthetic cream, local anesthesia injections and cool air jet will typically be used to minimize discomfort.
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <label class="font-weight-semibold">REDNESS AND SWELLING:  </label> Redness and swelling can occur in treated area. The redness and swelling will typically subside in 2 to 3 days. The effects can be minimized with the application of cool compresses if required.
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <label class="font-weight-semibold">SKIN DARKENING/LIGHTENING:  </label> Darkening of the skin (hyperpigmentation) rarely occurs in the treated areas and will usually fade within 3 to 6 days. This reaction is more common when treated areas are exposed to the sun. Hypopigmentation or light spots can appear as a delayed response to treatment. Pale areas can darken or re-pigment in several months, but it could be permanent. It is extremely important to protect the treated area from sun exposure with a hat and sunscreen for 6 weeks after the treatment and carefully adhere to all post-treatment instructions.
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <label class="font-weight-semibold">INFECTION:</label> Bacterial, viral or fungal infections can occur post procedure. Infections can cause redness and swelling and resolve or progress into cellulitis requiring treatment. Fractional Laser could trigger a recurrence of cold sores (Herpes simplex infection) or acne form eruptions which may require treatment. These problems may resolve in time, but medical intervention may be required in some cases, and long-term effects may persist in rare cases.
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <label class="font-weight-semibold">SCARRING:</label> There is a risk of skin scarring, including abnormal raised and/or depressed scars with any minimally invasive procedure. Careful adherence to all advised postoperative instructions will help reduce the possibility of this occurrence.
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <label class="font-weight-semibold">DISSATISFACTION:</label>With all treatments the precise degree of improvement cannot be guaranteed. The outcome’s subjective nature also means dissatisfaction is a possible outcome regardless of effectiveness of treatment. It should be understood that the effect of all treatments may gradually wear off and additional treatments may be necessary to acquire the desired effect, and further charges will apply if more treatments are required.
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">POST CARE – Fractional Laser</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">While there are limited side effects from Fractional Laser, there are few post-treatment instructions you should be aware of.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border:none;">After your Fractional Laser treatment you may experience warmth and redness in the treated areas for 1-3 days.</li>
                <li class="listunorder" style="border:none;">Repeated application of out Rescue balm in the first 48 hours will greatly increase comport levels and speed your recovery time. Rescue balm is best stored in the refrigerator, as keeping this product cold will add to its soothing and anti-inflammatory properties.</li>
                <li class="listunorder" style="border:none;">Cleansing is performed twice daily with a gentle cleanser, foaming it with water and using only clean hands.</li>
                <li class="listunorder" style="border:none;">Scrubs and facial cloths are the best avoided at this stage as they can harbor bacteria and further abrade the skin. </li>
                <li class="listunorder" style="border:none;">Soreness and tightness of the treated area is common at this stage of treatment. In this period we strongly advise against exposure to chlorinated environments as the chemicals can irritate sensitized skin.</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Confidentiality</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2"><label class="text-red">@emr.set_company</label> will maintain the confidentiality of your details and we assure you not to disclose them to any other party without your acknowledgement.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">PART II: Certificate of Consent</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">I have read the previous information, or it has been read to me. I have had the opportunity to ask questions about it, and any questions that I have asked/have been answered to my satisfaction. I consent voluntarily to undergo this treatment and understand that I have the right to withdraw from the procedure or treatment at any time without in any way affecting my medical care.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">In permitting my doctor to perform my procedure, I understand that unforeseen conditions may be revealed that may necessitate change or extension of the original procedure or the different procedure than those already explained to me. I therefore authorize and request that the above named physician, his/her assistant, or his her designees perform such procedure as necessary or desirable in the exercise of his/her judgement. </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">In the unlikely event that one or more of the above inherent complications may occur, my physicians may take appropriate and reasonable steps to manage and be available to me and my family to address our concerns and questions.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">I consent to any photographing or videotaping of the procedure that may be performed, provided by my identity is not revealed by pictures or description texts accompanying them, so that my physician may follow my therapy progression.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">I consent that I stop using <label class="font-weight-semibold">Accutane Isotretinoin</label> one month before the treatment.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">I confirm that the individual has given consent freely.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Healthcare Professional Declaration:</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            I have adequately explained to the patient about the procedure and risks, adverse effects, and the standard alternatives available for the procedure.
            I have permitted time and opportunity for the patient to ask questions, and all questions have been answered to my knowledge.
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">
            "I agree that healthcare provider(s) involved in my care at this facility will access my health information
            through the Health Information Exchange System (NABIDH) in accordance with the Laws of the United Arab Emirates,
            Emirate of Dubai Legislation and Dubai Health Authority Policies "
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold" dir="rtl">
            "أوافق على أن مقدمي الرعاية الصحية المشاركين في رعايتي في هذه المنشأة سيتمكنون من الوصول إلى معلوماتي الصحية
            من خلال نظام تبادل المعلومات الصحية (NABIDH) وفقاً لقوانين دولة الإمارات العربية المتحدة،
            تشريعات إمارة دبي وسياسات هيئة الصحة بدبي "
        </div>
    </div>
    <div class="row mt-2 table-responsive">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center table-responsive">
            <table class="table table-bordered table-condensed">
                <tr>
                    <td colspan="3" class="font-weight-bold text-danger fs-18" width="100%">
                        Sign here, only if all of your questions have been answered to your satisfaction
                    </td>
                </tr>
                <tr>
                    <td width="33%">
                        <div id="pat_sign_box">
                            <img alt="Signature" src="" id="pat_sign" class="avatar avatar-xl bsquare" />
                        </div>
                    </td>
                    <td width="33%">
                        <div id="wit_sign_box">
                            <img alt="stamp" id="wit_sign" class="avatar avatar-xl bsquare" />
                        </div>
                    </td>
                    <td width="33%">
                        <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                    </td>
                </tr>
                <tr>
                    <td width="33%">
                        <label class="form-label text-red text-left text-capitalize">@emr.pat_name&nbsp;</label>
                        <span class="font-weight-semibold"> Patient Name</span>
                        <br /><br />
                        <label class="form-label text-red text-left" id="psb_date_patient" name="">&nbsp;</label>
                        <span class="font-weight-semibold">Date</span>
                    </td>
                    <td width="33%">
                        @Html.TextBoxFor(m => m.dfc_1, new { @class = "form-control text-center", @id = "dfc_1", @width = "20px" })
                        <span class="font-weight-semibold">Witness Name</span>
                        <br /><br />
                        <label class="form-label text-red text-left" id="psb_date_witness" name="">&nbsp;</label>
                        <span class="font-weight-semibold">Date</span>
                    </td>
                    <td width="33%">
                        <label class="form-label text-red text-left text-capitalize">@emr.doc_name&nbsp;</label>
                        <span class="font-weight-semibold">Doctor’s Name</span>
                        <br /><br />
                        <label class="form-label text-red text-left">@DateTime.Now.ToString("yyyy-MM-dd")</label>
                        <span class="font-weight-semibold">Date</span>
                    </td>
                </tr>
                <tr>
                    <td class="font-weight-semibold text-blue" width="33%">
                        Patient Signature
                        <br />
                        <div class="btn-group mr-2">
                            <div class="dropdown">
                                <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" onclick="openSignaturePad('patient')">Tab</a>
                                    <a class="dropdown-item" onclick="openWacomTabSignaturePad('patient')">Wacom Tab</a>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="font-weight-semibold text-blue" width="33%">
                        Witness Signature
                        <br />
                        <div class="btn-group mr-2">
                            <div class="dropdown">
                                <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> witness
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" onclick="openSignaturePad('witness')">Tab</a>
                                    <a class="dropdown-item" onclick="openWacomTabSignaturePad('witness')">Wacom Tab</a>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="font-weight-semibold text-blue text-center" width="33%">Doctor’s Signature</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="row mt-2">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center">
            <div class="btn-list btn-animation">
                <button type="submit" class="btn btn-success btn-sm" id="btn_Insert">Save</button>
                <button type="button" class="btn btn-outline-dark btn-sm" id="btn_Reset_C">Reset</button>
                <button type="button" class="btn btn-danger btn-sm d-none" id="btn_Delete">Delete</button>
                <button type="button" class="btn btn-sm btn-outline-success d-none" id="btn_Print_C"> Download/Print </button>
            </div>
        </div>
    </div>
</form>
<script type="text/javascript">
    // region page load

    $(function () {
        if ("@emp_designation.ToString()" === "Super Administrator") {
            $("#btn_Insert").show();
        }
        else {
            if ("@emr.set_emr_lock" == "NoLock") {
                $("#btn_Insert").show();
            }
            else {
                if ("@emr.app_ae_date" >= "@emr.today") {
                    $("#btn_Insert").show();
                }
                else {
                    $("#btn_Insert").hide();
                }
            }
        }

        validate();
    });


    //#region Validation Initialization
    var validate = function () {
        $("#form_DmaxFractionalLaser").validate({
            rules: {
                dfc_1: {
                    required: true
                },
            },
            messages: {
                dfc_1: {
                    required: "Please Enter Witness Name"
                },
            },
            highlight: function (element) {
                var elem = $(element);
                $(element).parent().addClass('has-error');
                //error_timeout(elem.attr("id"));
            },
            unhighlight: function (element) {
                var elem = $(element);
                $(element).parent().removeClass('has-error');
            },
            errorElement: 'span',
            errorClass: 'text-danger fw-bold',
            errorPlacement: function (error, element) {
                var elem = $(element);
                if (element.parent('.input-group').length) {
                    error.insertAfter(element.parent());
                } else {
                    error.insertAfter(element);
                }
            }
        });
    }
 //#endregion

    //#region Add  Click
    $('#btn_Insert').on('click', function (e) {
        e.preventDefault();
        if ($("#form_DmaxFractionalLaser").valid()) {
            $('#btn_Insert').removeClass("btn btn-sm btn-success");
            $('#btn_Insert').addClass("btn btn-sm btn-success btn-loaders btn-icon");
            $('#btn_Insert').html("Saving the Record....");


           var _dateInsert = {
              "dfcId": 0,
              "dfc_appId": @emr.appId,
              "dfc_1": $("#dfc_1").val(),

                "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
            }

        console.log(_dateInsert);

            $.ajax({
                type: "Post",
                url: "@Url.Action("InsertDmaxFractionalLaser", "DmaxFractionalLaser", new {area = "ConsentForms" })",
                dataType: 'JSON',
                data: _dateInsert,
                success: function (data) {
                    $('#btn_Insert').removeClass("btn btn-sm btn-success btn-loaders btn-icon");
                    $('#btn_Insert').addClass("btn btn-sm btn-success");
                    $('#btn_Insert').html("Save Changes");

                    if (data.isSuccess) {
                        if (data.isInserted) {
                            GetDmaxFractionalLaserInfo();
                            var alertPlaceholder = document.getElementById("Alert");

                            function alert(e, t) {
                                var l = document.createElement("div");
                                l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" role="alert">' + e +
                                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                            }
                            alert("<i class='fe fe-check-circle text-white'></i>DmaxFractionalLaser Saved Successfully!", "success");


                            Timeout();
                            EditDmaxFractionalLaser()

                            $("#btn_Delete").removeClass("d-none");
                            $("#btn_Print").removeClass("d-none");
                        }
                        else {
                            let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                                "<div class='alert alert-warning' role='alert'>" +
                                "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                "<strong>Warning.. DmaxFractionalLaser already Exists..</strong><br/>" +
                                "</div></div>";
                            $("#Alert").html(html);
                        }
                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                        "<div class='alert alert-danger' role='alert'>" +
                        "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                        "<strong>Validation Error.. Please correct before you submit the form!&nbsp;</strong><br/><ul>";

                        $.each(data.message, function (index, value) {
                            html += "<li><small>" + value + "</small><li>";
                            var elem = $("#" + index);
                            if (elem.hasClass("select2-hidden-accessible")) {
                                $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                            }
                            else {
                                $(elem).addClass(" is-invalid");
                            }

                            setTimeout(function () {
                                if (elem.hasClass("select2-hidden-accessible")) {
                                    $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                }
                                else {
                                    $(elem).removeClass("is-invalid");
                                }
                                }, 5000);
                        });

                        html += "</ul></div></div>";

                        $("#error").html(html);
                    }
                },
                error: function (xhr) {
                    $('#btn_Insert').removeClass("btn btn-sm btn-success btn-loaders btn-icon");
                    $('#btn_Insert').addClass("btn btn-sm btn-warning");
                    $('#btn_Insert').html("Add");
                    Timeout();
                }
            });
        }
        else {
            $('.modal-body').animate({
                scrollTop: ($('.has-error').offset().top - 300)
            }, 2000);
        }

    });
    //#endregion Add Click

   //#region Delete Click
    $('#btn_Delete').on('click', function (e) {
        e.preventDefault();
        $('#btn_Delete').removeClass("btn btn-success");
        $('#btn_Delete').addClass("btn btn-success btn-loaders btn-icon");
        $('#btn_Delete').html("Deleting the Record....");

        $.ajax({
            url: '@Url.Action("DeleteDmaxFractionalLaser", "DmaxFractionalLaser", new { area = "ConsentForms" })?appId=' + @emr.appId,
            type: "POST",
            dataType: 'JSON',
            success: function (data) {
                $('#btn_Delete').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Delete').addClass("btn btn-warning");
                $('#btn_Delete').html("Delete");
                if (data.isAuthorized) {
                    if (data.success) {
                        var alertPlaceholder = document.getElementById("Alert");
                        function alert(e, t) {
                            var l = document.createElement("div");
                            l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                        }
                        alert("<i class='fe fe-check-circle text-white'></i>DmaxFractionalLaser Deleted Successfully!", "success");
                        clearControls();
                        Timeout();

                        $('#btn_Delete').addClass("d-none");
                        $("#pat_sign_box").addClass("d-none");
                        $("#wit_sign_box").addClass("d-none");

                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                            "<div class='alert alert-warning' role='alert'>" +
                            "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                            "<strong>Error!.. Failed to Delete..</strong><br/>" +
                            "</div></div>";
                        $("#error").html(html);
                    }
                }
                else {
                    var alertPlaceholder = document.getElementById("Alert");
                    function alert(e, t) {
                        var l = document.createElement("div");
                        l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                            '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                    }
                    alert("<i class='fe fe-check-circle text-white'></i> You do not have Enough Privileges to Delete this Designation!", "Access Denied!");
                }
            },
            error: function (xhr) {
                $('#btn_Delete').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Delete').addClass("btn btn-Delete");
                $('#btn_Delete').html("Delete");
                Timeout();
            }
        })
    });
//#endregion

    //#region Reset
    $('#btn_Reset_C').on('click', function (e) {
        e.preventDefault();
        clearControls();

    });
    //#endregion Reset

        //#region Print
    $('#btn_Print_C').on('click', function (e) {
        e.preventDefault();
        $('#btn_Print_C').removeClass("btn btn-sm btn-success");
        $('#btn_Print_C').addClass("btn btn-sm btn-success btn-loaders btn-icon");
        $('#btn_Print_C').html("Printing the Record....");
    $.ajax({
        type: "Get",
        url: "@Url.Action("PrintPDFConsent", "DmaxFractionalLaser", new {area = "ConsentForms" })?appId=" + @emr.appId + "&form=DmaxFractionalLaser",
        dataType: 'JSON',
        success: function (data) {
            console.log(data);
            if (data.isAuthorized) {
                if (data.success) {
                    window.location.href = data.message.pdfPath
                }
            }
        },
        error: function (xhr) {
            console.log(xhr);
        }
    });
});
//#endregion Print


    //#region Clear Controls
    var clearControls = function () {
        $(".form-control").val("");
        $(".form-control-sm").val("");
        $("#pat_sign,#wit_sign").attr("src", "");

    }
    //#endregion Clear Controls
       //#region Wacom Tab Signature
       var openWacomTabSignaturePad = function (id) {
           var _data = {
               "patId": @emr.patId,
               "person": id,
               "form": "DmaxFractionalLaser",
               "appId": @emr.appId,
               "formname":"DmaxFractionalLaser",
               "formlink":"",
               "eSign":""
           }
           $.ajax({
               type: "GET",
               url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
               contentType: "application/json",
               dataType: "html",
               data: _data,
               success: function (response) {
                   $("#signature_pad_body").html(response);
                   $("#signature_pad").modal("show");
               },
               error: function (xhr) {
                   console.log("Error :" + xhr.statusText);
               }
           });
       }
   //#endregion

   //#region Signature
    var openSignaturePad = function (id) {
    var _data = {
        "patId": @emr.patId,
        "person": id,
        "form": "DmaxFractionalLaser",
        "appId": @emr.appId,
        "formname":"DmaxFractionalLaser",
        "formlink":"",
        "eSign":""
    }
    $.ajax({
        type: "GET",
        url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
        contentType: "application/json",
        dataType: "html",
        data: _data,
        success: function (response) {
            $("#signature_pad_body").html(response);
            $("#signature_pad").modal("show");
        },
        error: function (xhr) {
            console.log("Error :" + xhr.statusText);
        }
    });
}
//#endregion Signature

$('#signature_pad').on('hidden.bs.modal', function () {
    if (localStorage.getItem("sign") != null) {
        GetSignaturename('patient');
        GetSignaturename('witness');
        localStorage.removeItem("sign");
    }
});


    //#region Get Signature
    var GetSignaturename = function  (person) {
        $.ajax({
            url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=DmaxFractionalLaser',
            type: "GET",
            dataType: "json",
            async: false,
            success: function (response) {
                console.log(response);
                let sign = response[0].psb_sign;
                var date = moment(response[0].psb_date_modified).format("DD-MM-YYYY");

                if (response[0].person == "patient") {
                    $("#pat_sign_box").removeClass("d-none");
                    $("#psb_date_patient").html(date);
                    $("#pat_sign").attr("src", sign);
                }
                if (response[0].person == "witness") {
                    $("#wit_sign_box").removeClass("d-none");
                    $("#wit_sign").attr("src", sign);
                    $("#psb_date_witness").html(date);
                }
            },
            error: function (xhr) {
                console.log(xhr);
                alert(xhr);
            }

        });
    };
    //#endregion Get Signature

//#region Alert Timeout
function Timeout() {
    window.setTimeout(function () {
        $(".alert").fadeTo(500, 0).slideUp(500, function () {
            $(this).remove();
        });
    }, 4200);
}
//#endregion Alert Timeout

</script>
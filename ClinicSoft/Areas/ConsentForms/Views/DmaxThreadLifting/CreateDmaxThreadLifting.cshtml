@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@model BusinessEntities.ConsentForms.DmaxThreadLifting

@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}
<form id="form_DmaxThreadLifting" autocomplete="off" name="DmaxThreadLifting" ondrop="return false;" onpaste="return false;" oncut="return false;">
    @Html.AntiForgeryToken()
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="border">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="row mt-2">
                        <div class="col-sm-12 col-md-6 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black text-align-left"> Patient Name</label></div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-4">
                            <label class="form-label text-red text-left text-capitalize">@emr.pat_name</label>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> Emirates ID</label></div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-4">
                            <label class="form-label text-red text-left">@emr.pat_emirateid</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2 mb-2">
                            <div class="form-group mb-3 text-align-left"><label class="form-label text-black ">File No</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_code</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> DOB</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_dob</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> Nationality</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_nationality</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Gender</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_gender</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Doctor's Name</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.doc_name</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Date</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.app_fdate</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5 mt-5 col-sm-12 col-md-12 col-lg-12 text-justify">
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">This Informed Consent Form has two parts:</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Information Sheet (to share information about the treatment with you)</li>
                <li class="listunorder" style="border: none;">Certificate of Consent (for signatures if you agree to go ahead with the treatment)</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Dubai Health Authority law guarantees that you have both the right and the obligation to make decisions regarding your health care.<label class="text-red">@emr.set_company</label> team can provide you with the necessary information and advice, but you must participate in the decision-making process. This form acknowledges your consent to treatment and surgical or non-surgical procedures recommended by your physician.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">You will be given a copy of the full Informed Consent Form</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">PART I: Information Sheet</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            I, Dr. <label class="text-red">@emr.doc_name</label> with license No: <label class="text-red">@emr.emp_license</label> should be performing the Thread Lift procedure on Miss/Mrs./Mr.<label class="text-red">@emr.pat_name</label> Age <label class="text-red">@emr.pat_age</label>years, on date <label class="text-red">@emr.app_fdate</label>
            The following has been explained to the patient in general terms.
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Proposed procedure –Thread Lifting</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">An alternate to facelift surgery, thread lift procedure is essentially a medical treatment for tightening your skin through the usage of medical-grade thread materials.  It is a lesser invasive version of facelift surgery. Once the thread-like materials are inserted in the designated area of your face or neck, they are pulled, which leads to skin tightening. This gives you a younger-looking face and neck. A facelift is performed on the bottom two-thirds of your face and the neck region. The target areas for thread lift include the following:</div>
        <div class="col-sm-12 col-md-12 col-lg-2 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Jawline</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-2 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Jowls</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-4 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Under-eye area</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-2 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Brow line</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-2 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Cheeks</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">Sometimes, the forehead is also taken into consideration depending on the requirement of the candidate. Let’s see what happens during the procedure.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">Thread lifts don’t involve deep-tissue manipulation or incision, which is in stark contrast to traditional surgical facelifts. As we stated earlier, threads or sutures are inserted on the affected area of your face and neck.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Pre-Operational assessment /before your Surgery</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">You must do several blood and urine Investigations which prescribe by your doctor before surgery.</li>
                <li class="listunorder" style="border: none;">It is important to tell your doctor about your medication allergies and complete medical history.</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Side Effects and Complications Thread Lift Procedure</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <label class="text-red">@emr.set_company</label> team has explained to the patient that there are possible risks and undesirable consequences associated with this procedure including but not limited to
            Complications
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Difficulty opening your mouth (usually temporary)</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Extrusion of a thread</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Infection</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Pain, which could persist.</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Sensitivity to sun or other bright light</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Swelling and bruising</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Unfavorable result</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Discomforts</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">Initial healing may include some swelling, bruising, irritation and discomfort that can be controlled with medication, cold compresses and ointment.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Benefits</div>
        <div class="col-sm-12 col-md-12 col-lg-3 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">An instant lift</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">No downtime</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Long-term results</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">Reduced wrinkles and fine lines</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Alternatives</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">The reasonable alternatives to the procedure as well as risks and benefits of the alternatives have been explained to the patient. Alternatives include but are not limited to. </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">
            <ul class="list-group">
                <li class="listunorder" style="border: none;">
                    Dermal fillers & botox
                    <p>The most gentle and mainstream treatments available, injectable treatments are a great option for many patients. They’re safe, effective, affordable, and offer little to no downtime. Both types of treatments are temporary, but the longevity of the results depend heavily on the type of product used. Botox tends to last 3-4 months on average, while some dermal fillers can last up to a year.</p>
                </li>

                <li class="listunorder" style="border: none;">
                    Chemical peel
                    <p>Chemical peels are very good for improving overall skin quality but are often not as effective for significant signs of aging. That said, deep peels can improve the appearance of wrinkling quite effectively. Recovery time depends entirely on the depth of the peel. Mild peels can be repeated for improved results.</p>
                </li>
                <li class="listunorder" style="border: none;">
                    Laser skin resurfacing
                    <p>Patients can expect to see improvement in wrinkles, lines, overall skin quality, and sun damage. For the best results, many patients elect to have a series of treatments.</p>
                </li>
                <li class="listunorder" style="border: none;">
                    Fat transfer
                    <p>An exciting facial rejuvenation treatment that can produce semi-permanent improvement, fat transfer uses refined fat cells from the patient’s own body to fill in areas of lost volume and deep wrinkles. Fat that survives after the first six months is considered permanent rejuvenation, as this means the cells have established themselves and are likely to keep living long term. Though facial fat transfer can be performed with the patient under light sedation. Recovery generally takes a week or two following the surgery.</p>
                </li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Confidentiality</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2"><label class="text-red">@emr.set_company</label> team will maintain the confidentiality of your details and we assure you not to disclose them to any other party without your acknowledgment.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Financial Implications</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">All procedures/treatments provided that are not covered by insurance may require your full payment or co-payment. </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">PART II: Certificate of Consent </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">I have read the previous information, or it has been read to me. I have had the opportunity to ask questions about it, and any questions that I have asked have been answered to my satisfaction. I consent voluntarily to undergo this treatment and understand that I have the right to withdraw from the procedure or treatment at any time without in any way affecting my medical care. </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">In permitting my doctor to perform my procedure, I understand that the unforeseen conditions may be revealed that may necessitate change or extension of the original procedure or a different procedure than those already explained to me. I therefore authorize and request that the above-named physician, his/her assistants or his/her designees perform such procedure as necessary or desirable in the exercise of his/her judgment.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">In the unlikely event that one or more of the above inherent complications may occur, my physician may take appropriate and reasonable steps to manage and be available to me and my family to address our concerns and questions.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">I consent to any photographing or videotaping of the procedure that may be performed, provided by my identity is not revealed by pictures or descriptive texts accompanying them, so that my physician may follow my therapy progression.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">Witness statement I have accurately read or witnessed the accurate reading of the consent form to the potential patient, and the individual has had the opportunity to ask questions. I confirm that the individual has given consent freely. </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">Healthcare Professional Declaration:</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2">I have adequately explained to the patient about the procedure and risks, adverse effects, and the standard alternatives available for the procedure. I have permitted time and opportunity for the patient to ask questions, and all questions have been answered to my knowledge.</div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold">
            "I agree that healthcare provider(s) involved in my care at this facility will access my health information
            through the Health Information Exchange System (NABIDH) in accordance with the Laws of the United Arab Emirates,
            Emirate of Dubai Legislation and Dubai Health Authority Policies "
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2 mt-2 font-weight-semibold" dir="rtl">
            "أوافق على أن مقدمي الرعاية الصحية المشاركين في رعايتي في هذه المنشأة سيتمكنون من الوصول إلى معلوماتي الصحية
            من خلال نظام تبادل المعلومات الصحية (NABIDH) وفقاً لقوانين دولة الإمارات العربية المتحدة،
            تشريعات إمارة دبي وسياسات هيئة الصحة بدبي "
        </div>
    </div>
    <div class="row mt-2 table-responsive">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center table-responsive">
            <table class="table table-bordered table-condensed">
                <tr>
                    <td colspan="3" class="font-weight-bold text-danger fs-18" width="100%">
                        Sign here, only if all of your questions have been answered to your satisfaction
                    </td>
                </tr>
                <tr>
                    <td width="33%">
                        <div id="pat_sign_box">
                            <img alt="Signature" src="" id="pat_sign" class="avatar avatar-xl bsquare" />
                        </div>
                    </td>
                    <td width="33%">
                        <div id="wit_sign_box">
                            <img alt="stamp" id="wit_sign" class="avatar avatar-xl bsquare" />
                        </div>
                    </td>
                    <td width="33%">
                        <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                    </td>
                </tr>
                <tr>
                    <td width="33%">
                        <label class="form-label text-red text-left text-capitalize">@emr.pat_name&nbsp;</label>
                        <span class="font-weight-semibold"> Patient Name</span>
                        <br /><br />
                        <label class="form-label text-red text-left" id="psb_date_patient" name="">&nbsp;</label>
                        <span class="font-weight-semibold">Date</span>
                    </td>
                    <td width="33%">
                        @Html.TextBoxFor(m => m.dtl_1, new { @class = "form-control text-center", @id = "dtl_1", @width = "20px" })
                        <span class="font-weight-semibold">Witness Name</span>
                        <br /><br />
                        <label class="form-label text-red text-left" id="psb_date_witness" name="">&nbsp;</label>
                        <span class="font-weight-semibold">Date</span>
                    </td>
                    <td width="33%">
                        <label class="form-label text-red text-left text-capitalize">@emr.doc_name&nbsp;</label>
                        <span class="font-weight-semibold">Doctor’s Name</span>
                        <br /><br />
                        <label class="form-label text-red text-left">@DateTime.Now.ToString("yyyy-MM-dd")</label>
                        <span class="font-weight-semibold">Date</span>
                    </td>
                </tr>
                <tr>
                    <td class="font-weight-semibold text-blue" width="33%">
                        Patient Signature
                        <br />
                        <div class="btn-group mr-2">
                            <div class="dropdown">
                                <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" onclick="openSignaturePad('patient')">Tab</a>
                                    <a class="dropdown-item" onclick="openWacomTabSignaturePad('patient')">Wacom Tab</a>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="font-weight-semibold text-blue" width="33%">
                        Witness Signature
                        <br />
                        <div class="btn-group mr-2">
                            <div class="dropdown">
                                <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> witness
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" onclick="openSignaturePad('witness')">Tab</a>
                                    <a class="dropdown-item" onclick="openWacomTabSignaturePad('witness')">Wacom Tab</a>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="font-weight-semibold text-blue text-center" width="33%">Doctor’s Signature</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="row mt-2">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center">
            <div class="btn-list btn-animation">
                <button type="submit" class="btn btn-success btn-sm" id="btn_Insert">Save</button>
                <button type="button" class="btn btn-outline-dark btn-sm" id="btn_Reset_C">Reset</button>
                <button type="button" class="btn btn-danger btn-sm d-none" id="btn_Delete">Delete</button>
                <button type="button" class="btn btn-sm btn-outline-success d-none" id="btn_Print_C"> Download/Print </button>
            </div>
        </div>
    </div>
</form>
<script type="text/javascript">
    // region page load

    $(function () {
        if ("@emp_designation.ToString()" === "Super Administrator") {
            $("#btn_Insert").show();
        }
        else {
            if ("@emr.set_emr_lock" == "NoLock") {
                $("#btn_Insert").show();
            }
            else {
                if ("@emr.app_ae_date" >= "@emr.today") {
                    $("#btn_Insert").show();
                }
                else {
                    $("#btn_Insert").hide();
                }
            }
        }
      
        validate();
    });


    //#region Validation Initialization
    var validate = function () {
        $("#form_DmaxThreadLifting").validate({
            rules: {
                dtl_1: {
                    required: true
                },
            },
            messages: {
                dtl_1: {
                    required: "Please Enter Witness Name"
                },
            },
            highlight: function (element) {
                var elem = $(element);
                $(element).parent().addClass('has-error');
                //error_timeout(elem.attr("id"));
            },
            unhighlight: function (element) {
                var elem = $(element);
                $(element).parent().removeClass('has-error');
            },
            errorElement: 'span',
            errorClass: 'text-danger fw-bold',
            errorPlacement: function (error, element) {
                var elem = $(element);
                if (element.parent('.input-group').length) {
                    error.insertAfter(element.parent());
                } else {
                    error.insertAfter(element);
                }
            }
        });
    }
 //#endregion

    //#region Add  Click
    $('#btn_Insert').on('click', function (e) {
        e.preventDefault();
        if ($("#form_DmaxThreadLifting").valid()) {
            $('#btn_Insert').removeClass("btn btn-sm btn-success");
            $('#btn_Insert').addClass("btn btn-sm btn-success btn-loaders btn-icon");
            $('#btn_Insert').html("Saving the Record....");


           var _dateInsert = {
              "dtlId": 0,
              "dtl_appId": @emr.appId,
              "dtl_1": $("#dtl_1").val(),
          
                "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
            }

        console.log(_dateInsert);

            $.ajax({
                type: "Post",
                url: "@Url.Action("InsertDmaxThreadLifting", "DmaxThreadLifting", new {area = "ConsentForms" })",
                dataType: 'JSON',
                data: _dateInsert,
                success: function (data) {
                    $('#btn_Insert').removeClass("btn btn-sm btn-success btn-loaders btn-icon");
                    $('#btn_Insert').addClass("btn btn-sm btn-success");
                    $('#btn_Insert').html("Save Changes");

                    if (data.isSuccess) {
                        if (data.isInserted) {
                            GetDmaxThreadLiftingInfo();
                            var alertPlaceholder = document.getElementById("Alert");

                            function alert(e, t) {
                                var l = document.createElement("div");
                                l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" role="alert">' + e +
                                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                            }
                            alert("<i class='fe fe-check-circle text-white'></i>DmaxThreadLifting Saved Successfully!", "success");


                            Timeout();
                            EditDmaxThreadLifting()

                            $("#btn_Delete").removeClass("d-none");
                            $("#btn_Print").removeClass("d-none");
                        }
                        else {
                            let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                                "<div class='alert alert-warning' role='alert'>" +
                                "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                "<strong>Warning.. DmaxThreadLifting already Exists..</strong><br/>" +
                                "</div></div>";
                            $("#Alert").html(html);
                        }
                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                        "<div class='alert alert-danger' role='alert'>" +
                        "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                        "<strong>Validation Error.. Please correct before you submit the form!&nbsp;</strong><br/><ul>";

                        $.each(data.message, function (index, value) {
                            html += "<li><small>" + value + "</small><li>";
                            var elem = $("#" + index);
                            if (elem.hasClass("select2-hidden-accessible")) {
                                $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                            }
                            else {
                                $(elem).addClass(" is-invalid");
                            }

                            setTimeout(function () {
                                if (elem.hasClass("select2-hidden-accessible")) {
                                    $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                }
                                else {
                                    $(elem).removeClass("is-invalid");
                                }
                                }, 5000);
                        });

                        html += "</ul></div></div>";

                        $("#error").html(html);
                    }
                },
                error: function (xhr) {
                    $('#btn_Insert').removeClass("btn btn-sm btn-success btn-loaders btn-icon");
                    $('#btn_Insert').addClass("btn btn-sm btn-warning");
                    $('#btn_Insert').html("Add");
                    Timeout();
                }
            });
        }
        else {
            $('.modal-body').animate({
                scrollTop: ($('.has-error').offset().top - 300)
            }, 2000);
        }

    });
    //#endregion Add Click

   //#region Delete Click
    $('#btn_Delete').on('click', function (e) {
        e.preventDefault();
        $('#btn_Delete').removeClass("btn btn-success");
        $('#btn_Delete').addClass("btn btn-success btn-loaders btn-icon");
        $('#btn_Delete').html("Deleting the Record....");

        $.ajax({
            url: '@Url.Action("DeleteDmaxThreadLifting", "DmaxThreadLifting", new { area = "ConsentForms" })?appId=' + @emr.appId,
            type: "POST",
            dataType: 'JSON',
            success: function (data) {
                $('#btn_Delete').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Delete').addClass("btn btn-warning");
                $('#btn_Delete').html("Delete");
                if (data.isAuthorized) {
                    if (data.success) {
                        var alertPlaceholder = document.getElementById("Alert");
                        function alert(e, t) {
                            var l = document.createElement("div");
                            l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                        }
                        alert("<i class='fe fe-check-circle text-white'></i>DmaxThreadLifting Deleted Successfully!", "success");
                        clearControls();
                        Timeout();

                        $('#btn_Delete').addClass("d-none");
                        $("#pat_sign_box").addClass("d-none");
                        $("#wit_sign_box").addClass("d-none");

                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                            "<div class='alert alert-warning' role='alert'>" +
                            "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                            "<strong>Error!.. Failed to Delete..</strong><br/>" +
                            "</div></div>";
                        $("#error").html(html);
                    }
                }
                else {
                    var alertPlaceholder = document.getElementById("Alert");
                    function alert(e, t) {
                        var l = document.createElement("div");
                        l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                            '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                    }
                    alert("<i class='fe fe-check-circle text-white'></i> You do not have Enough Privileges to Delete this Designation!", "Access Denied!");
                }
            },
            error: function (xhr) {
                $('#btn_Delete').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Delete').addClass("btn btn-Delete");
                $('#btn_Delete').html("Delete");
                Timeout();
            }
        })
    });
//#endregion

    //#region Reset
    $('#btn_Reset_C').on('click', function (e) {
        e.preventDefault();
        clearControls();

    });
    //#endregion Reset

        //#region Print
    $('#btn_Print_C').on('click', function (e) {
        e.preventDefault();
        $('#btn_Print_C').removeClass("btn btn-sm btn-success");
        $('#btn_Print_C').addClass("btn btn-sm btn-success btn-loaders btn-icon");
        $('#btn_Print_C').html("Printing the Record....");
    $.ajax({
        type: "Get",
        url: "@Url.Action("PrintPDFConsent", "DmaxThreadLifting", new {area = "ConsentForms" })?appId=" + @emr.appId + "&form=DmaxThreadLifting",
        dataType: 'JSON',
        success: function (data) {
            console.log(data);
            if (data.isAuthorized) {
                if (data.success) {
                    window.location.href = data.message.pdfPath
                }
            }
        },
        error: function (xhr) {
            console.log(xhr);
        }
    });
});
//#endregion Print


    //#region Clear Controls
    var clearControls = function () {
        $(".form-control").val("");
        $(".form-control-sm").val("");
        $("#pat_sign,#wit_sign").attr("src", "");

    }
    //#endregion Clear Controls
       //#region Wacom Tab Signature
       var openWacomTabSignaturePad = function (id) {
           var _data = {
               "patId": @emr.patId,
               "person": id,
               "form": "DmaxThreadLifting",
               "appId": @emr.appId,
               "formname":"DmaxThreadLifting",
               "formlink":"",
               "eSign":""
           }
           $.ajax({
               type: "GET",
               url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
               contentType: "application/json",
               dataType: "html",
               data: _data,
               success: function (response) {
                   $("#signature_pad_body").html(response);
                   $("#signature_pad").modal("show");
               },
               error: function (xhr) {
                   console.log("Error :" + xhr.statusText);
               }
           });
       }
   //#endregion

   //#region Signature
    var openSignaturePad = function (id) {
    var _data = {
        "patId": @emr.patId,
        "person": id,
        "form": "DmaxThreadLifting",
        "appId": @emr.appId,
        "formname":"DmaxThreadLifting",
        "formlink":"",
        "eSign":""
    }
    $.ajax({
        type: "GET",
        url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
        contentType: "application/json",
        dataType: "html",
        data: _data,
        success: function (response) {
            $("#signature_pad_body").html(response);
            $("#signature_pad").modal("show");
        },
        error: function (xhr) {
            console.log("Error :" + xhr.statusText);
        }
    });
}
//#endregion Signature

$('#signature_pad').on('hidden.bs.modal', function () {
    if (localStorage.getItem("sign") != null) {
        GetSignaturename('patient');
        GetSignaturename('witness');
        localStorage.removeItem("sign");
    }
});


    //#region Get Signature
    var GetSignaturename = function  (person) {
        $.ajax({
            url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=DmaxThreadLifting',
            type: "GET",
            dataType: "json",
            async: false,
            success: function (response) {
                console.log(response);
                let sign = response[0].psb_sign;
                var date = moment(response[0].psb_date_modified).format("DD-MM-YYYY");

                if (response[0].person == "patient") {
                    $("#pat_sign_box").removeClass("d-none");
                    $("#psb_date_patient").html(date);
                    $("#pat_sign").attr("src", sign);
                }
                if (response[0].person == "witness") {
                    $("#wit_sign_box").removeClass("d-none");
                    $("#wit_sign").attr("src", sign);
                    $("#psb_date_witness").html(date);
                }
            },
            error: function (xhr) {
                console.log(xhr);
                alert(xhr);
            }

        });
    };
    //#endregion Get Signature

//#region Alert Timeout
function Timeout() {
    window.setTimeout(function () {
        $(".alert").fadeTo(500, 0).slideUp(500, function () {
            $(this).remove();
        });
    }, 4200);
}
//#endregion Alert Timeout

</script>

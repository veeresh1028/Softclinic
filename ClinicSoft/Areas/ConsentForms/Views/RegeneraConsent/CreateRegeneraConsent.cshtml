@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@model BusinessEntities.ConsentForms.RegeneraConsent

@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}

<form id="form_RegeneraConsent" autocomplete="off" name="RegeneraConsent" ondrop="return false;" onpaste="return false;" oncut="return false;">
    @Html.AntiForgeryToken()
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="border">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="row mt-2">
                        <div class="col-sm-12 col-md-6 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black text-align-left"> Patient Name <br />اسم المريض</label></div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-4">
                            <label class="form-label text-red text-left text-capitalize">@emr.pat_name</label>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> Emirates ID <br />هويه الإمارات</label></div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-4">
                            <label class="form-label text-red text-left">@emr.pat_emirateid</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2 mb-2">
                            <div class="form-group mb-3 text-align-left"><label class="form-label text-black ">File No <br />رقم الملف</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_code</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> DOB <br />تاريخ الميلاد</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_dob</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> Nationality <br />جنسية</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_nationality</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Gender <br />جنس</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_gender</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Doctor's Name <br />اسم الطبيب</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.doc_name</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Date <br />تاريخ</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.app_fdate</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5 mt-5 text-justify">
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    I, the undersigned hereby consent to allow myself to undertake the Regenera Treatment procedure which has been discussed during our consultation for the purpose of aesthetic enhancement
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    ، أوافق على السماح لنفسي بإجراء علاج Regenera الذي تمت مناقشته خلال استشارتنا لغرض التحسين الجمالي
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    I understand that the goal of this treatment is to improve my appearance to combat hair loss and stimulate the growth of new hair. It involves an injection of a unique combination of stem cells precursors, growth factors, and progenitor cells is injected into the scalp in order to promote the regenerative processes
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    درك أن الهدف من هذا العلاج هو تحسين مظهري لمحاربة تساقط الشعر وتحفيز نمو شعر جديد. يتضمن حقن مزيج فريد من سلائف الخلايا الجذعية وعوامل النمو والخلايا السلفية التي يتم حقنها في فروة الرأس من أجل تعزيز عمليات التجدد
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    Prior to the treatment, a blood sample is taken from the back of the scalp then placed into the Rigenera machine and mechanically ground into a solution. Stem cells from the hair follicles, fat, and blood are filtered by the machine and are extracted into a needle syringe
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    قبل العلاج ، يتم أخذ عينة دم من الجزء الخلفي من فروة الرأس ثم يتم وضعها في آلة Regenera ويتم طحنها ميكانيكيًا في محلول. يتم تصفية الخلايا الجذعية من بصيلات الشعر والدهون والدم بواسطة الجهاز ويتم استخلاصها في حقنة إبرة
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    I have been informed that the results are generally visible within 6-7 months and can continue to improve gradually for up to 12 months after the procedure, with the possibility that some imperfection remains and that the result may not be what I expected
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    لقد تم إبلاغي بأن النتائج تظهر بشكل عام في غضون 6-7 أشهر ويمكن أن تستمر في التحسن تدريجيًا لمدة تصل إلى 12 شهرًا بعد الإجراء ، مع احتمال بقاء بعض النقص وأن النتيجة قد لا تكون كما كنت أتوقع.
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    I am aware that this service will be provided to me by licensed doctors, nurses, physician’s assistance, and other medical staff
                    Bruises, swelling, local discomfort, redness, or itching are common and normal during and after the treatment and they will completely resolve over 5-7 days

                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    إنني أدرك أن هذه الخدمة سيتم توفيرها لي من قبل أطباء وممرضات ومساعدة طبيب وطاقم طبي آخر مرخصين

                    الكدمات ، التورم ، الانزعاج الموضعي ، الاحمرار أو الحكة شائعة وطبيعية أثناء العلاج وبعده وسوف تختفي تمامًا خلال 5-7 أيام

                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    I hereby acknowledge that I am advised to follow the instruction as;
                    <ul style="list-style:disc" class="ms-5">
                        <li><p>Avoid strenuous exercise for Five days</p></li>
                        <li><p>Away from hot bath and hot water for 3 days</p></li>
                        <li><p>Avoid rubbing or massaging the injection area</p></li>
                        <li><p>Do not expose the injured area without a bandage cover</p></li>
                    </ul>
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    أقر بموجبه أنني نصحني باتباع التعليمات على النحو التالي:
                    <ul style="list-style:disc" class="me-5">
                        <li><p>تجنب التمارين الشاقة لمدة خمسة أيام</p></li>
                        <li><p>الابتعاد عن الحمام الساخن والماء الساخن لمدة 3 أيام</p></li>
                        <li><p>تجنب فرك أو تدليك منطقة الحقن</p></li>
                        <li><p>لا تعرض المنطقة المصابة بدون غطاء الضمادة</p></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    I acknowledge that this treatment has been thoroughly explained to me in a detailed in all clear manners with its potential benefits and risks and other unknown and unexpected side effects from the procedure
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    أقر بأن هذا العلاج قد تم شرحه لي بالتفصيل وبكل طريقة واضحة مع فوائده ومخاطره المحتملة والآثار الجانبية الأخرى غير المعروفة
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    All of my questions have been satisfactorily answered and I agree to adhere to all safety precautions and instructions after the treatment
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    لقد تمت الإجابة على جميع أسئلتي بشكل مرضي وأوافق على الالتزام بجميع احتياطات وتعليمات السلامة بعد العلاج
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    I agree that if I should have any questions or concerns regarding my treatment results. I will notify the clinic immediately so that timely follow-up and intervention can be provided
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    أوافق على أنه إذا كان لدي أي أسئلة أو مخاوف بشأن نتائج علاجي. سأقوم بإخطار العيادة على الفور حتى يمكن توفير المتابعة والتدخل في الوقت المناسب
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    Top Life Physiotherapy and Hijjama Center is not responsible for any complications that may occur due to non-compliance with the post-treatment measures required/recommended for this procedure
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    مركز توب لايف للعلاج الطبيعي والحجامة غير مسؤول عن أي مضاعفات قد تحدث بسبب عدم الالتزام بإجراءات ما بعد العلاج المطلوبة/الموصى بها لهذا الإجراء
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    I hereby give my consent to undergo Regenera Treatment and release Top Life Physiotherapy and Hijjama Center, its medical staff, and administrations from any liability associated with the procedure
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    أمنح بموجب هذا موافقتي على الخضوع لعلاج ريجينيرا وأعفي مركز توب لايف للعلاج الطبيعي والحجامة وطاقمه الطبي وإداراته من أي مسؤولية مرتبطة بهذا الإجراء.
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 font-weight-semibold">
            <div class="row text-justify">
                <div class="col-lg-6 mb-4">
                    "I agree that healthcare provider(s) involved in my care at this facility will access my health information through the Health Information Exchange System(NABIDH) in accordance with the Laws of the United Arab Emirates, Emirate of Dubai Legislation and Dubai Health Authority Policies "
                </div>
                <div dir="rtl" class="col-lg-6  mb-4 text-justify">
                    "أوافق على أن مقدمي الرعاية الصحية المشاركين في رعايتي في هذه المنشأة سيتمكنون من الوصول إلى معلوماتي الصحية من خلال نظام تبادل المعلومات الصحية (NABIDH) وفقًا لقوانين دولة الإمارات العربية المتحدة وتشريعات إمارة دبي وسياسات هيئة الصحة بدبي. "
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center table-responsive">
            <table class="table table-bordered table-condensed">
                <tr>
                    <td colspan="3" class="font-weight-bold text-danger fs-18" width="100%">
                        Sign here, only if all of your questions have been answered to your satisfaction<br />قم بالتوقيع هنا، فقط إذا تمت الإجابة على جميع أسئلتك بما يرضيك
                    </td>
                </tr>
                <tr>
                    <td width="33%">
                        <div id="pat_sign_box">
                            <img alt="Signature" src="" id="pat_sign" class="avatar avatar-xl bsquare" />
                        </div>
                    </td>
                    <td width="33%">
                        <div id="wit_sign_box">
                            <img alt="stamp" id="wit_sign" class="avatar avatar-xl bsquare" />
                        </div>
                    </td>
                    <td width="33%">
                        <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                    </td>
                </tr>
                <tr>
                    <td width="33%">
                        <label class="form-label text-red text-left text-capitalize">@emr.pat_name&nbsp;</label>
                        <span class="font-weight-semibold"> Patient Name<br />اسم المريض</span>
                        <br /><br />
                        <label class="form-label text-red text-left" id="psb_date_patient" name="">&nbsp;</label>
                        <span class="font-weight-semibold">Date<br />تاريخ</span>
                    </td>
                    <td width="33%">
                        @Html.TextBoxFor(m => m.rtc_1, new { @class = "form-control text-center", @id = "rtc_1", @width = "20px" })                            <span class="font-weight-semibold">Witness Name<br />اسم الشاهد</span>
                        <br /><br />
                        <label class="form-label text-red text-left" id="psb_date_witness" name="">&nbsp;</label>
                        <span class="font-weight-semibold">Date<br />تاريخ</span>
                    </td>
                    <td width="33%">
                        <label class="form-label text-red text-left text-capitalize">@emr.doc_name&nbsp;</label>
                        <span class="font-weight-semibold">Doctor’s Name<br />اسم الطبيب</span>
                        <br /><br />
                        <label class="form-label text-red text-left" id="rtc_date_doctor"></label>
                        <span class="font-weight-semibold">Date<br />تاريخ</span>
                    </td>
                </tr>
                <tr>
                    <td class="font-weight-semibold text-blue" width="33%">
                        Patient Signature<br />توقيع المريض
                        <br />
                        <div class="btn-group mr-2">
                            <div class="dropdown">
                                <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" onclick="openSignaturePad('patient')">Tab</a>
                                    <a class="dropdown-item" onclick="openWacomTabSignaturePad('patient')">Wacom Tab</a>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="font-weight-semibold text-blue" width="33%">
                        Witness Signature<br />توقيع الشاهد
                        <br />
                        <div class="btn-group mr-2">
                            <div class="dropdown">
                                <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> witness
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" onclick="openSignaturePad('witness')">Tab</a>
                                    <a class="dropdown-item" onclick="openWacomTabSignaturePad('witness')">Wacom Tab</a>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="font-weight-semibold text-blue text-center" width="33%">Doctor’s Signature<br />توقيع الطبيب</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="row mt-2">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center">
            <div class="btn-list btn-animation">
                <button type="submit" class="btn btn-success btn-sm" id="btn_Insert">Save</button>
                <button type="button" class="btn btn-outline-dark btn-sm" id="btn_Reset_C">Reset</button>
                <button type="button" class="btn btn-danger btn-sm d-none" id="btn_Delete">Delete</button>
                <button type="button" class="btn btn-sm btn-outline-success d-none" id="btn_Print_C"> Download/Print </button>
            </div>
        </div>
    </div>
</form>

<script type="text/javascript">
   //#region Page Load
    var formName1 = $(form_RegeneraConsent).closest('form').attr('name');
 $(function () {
     if ("@emp_designation.ToString()" === "Super Administrator") {
         $("#btn_Insert").show();
     }
     else {
         if ("@emr.set_emr_lock" == "NoLock") {
             $("#btn_Insert").show();
         }
         else {
             if ("@emr.app_ae_date" >= "@emr.today") {
                 $("#btn_Insert").show();
             }
             else {
                 $("#btn_Insert").hide();
             }
         }
     }

     validate();
 });
  //#end region Page Load

    //#region Validation Initialization
    var validate = function () {
        $("#form_RegeneraConsent").validate({
            rules: {
                rtc_1: {
                    required: true
                },
            },
            messages: {
                rtc_1: {
                    required: "Please Enter Witness Name"
                },
            },
            highlight: function (element) {
                var elem = $(element);
                $(element).parent().addClass('has-error');
                //error_timeout(elem.attr("id"));
            },
            unhighlight: function (element) {
                var elem = $(element);
                $(element).parent().removeClass('has-error');
            },
            errorElement: 'span',
            errorClass: 'text-danger fw-bold',
            errorPlacement: function (error, element) {
                var elem = $(element);
                if (element.parent('.input-group').length) {
                    error.insertAfter(element.parent());
                } else {
                    error.insertAfter(element);
                }
            }
        });

    }
    //#endregion

    //#region Add  Click
    $('#btn_Insert').on('click', function (e) {
        e.preventDefault();
        if ($("#form_RegeneraConsent").valid()) {
            $('#btn_Insert').removeClass("btn btn-sm btn-success");
            $('#btn_Insert').addClass("btn btn-sm btn-success btn-loaders btn-icon");
            $('#btn_Insert').html("Saving the Record....");

            var _dateInsert = {
                "rtcId": 0,
                "rtc_appId": @emr.appId,
                "rtc_1": $("#rtc_1").val(),
                "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
            }
            console.log(_dateInsert);
            $.ajax({
                type: "Post",
                url: "@Url.Action("InsertRegeneraConsent", "RegeneraConsent", new {area = "ConsentForms" })",
                dataType: 'JSON',
                data: _dateInsert,
                success: function (data) {
                    $('#btn_Insert').removeClass("btn btn-sm btn-success btn-loaders btn-icon");
                    $('#btn_Insert').addClass("btn btn-sm btn-success");
                    $('#btn_Insert').html("Save Changes");

                    if (data.isSuccess) {
                        if (data.isInserted) {
                            GetRegeneraConsentInfo();
                            var alertPlaceholder = document.getElementById("Alert");

                            function alert(e, t) {
                                var l = document.createElement("div");
                                l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" role="alert">' + e +
                                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                            }
                            alert("<i class='fe fe-check-circle text-white'></i>Regenera Consent Form Saved Successfully!", "success");
                            Timeout();
                            EditRegeneraConsent()

                            $("#btn_Delete").removeClass("d-none");
                            $("#btn_Print").removeClass("d-none");
                        }
                        else {
                            let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                                "<div class='alert alert-warning' role='alert'>" +
                                "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                "<strong>Warning..Regenera Consent Form already Exists..</strong><br/>" +
                                "</div></div>";
                            $("#Alert").html(html);
                        }
                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                        "<div class='alert alert-danger' role='alert'>" +
                        "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                        "<strong>Validation Error.. Please correct before you submit the form!&nbsp;</strong><br/><ul>";

                        $.each(data.message, function (index, value) {
                            html += "<li><small>" + value + "</small><li>";
                            var elem = $("#" + index);
                            if (elem.hasClass("select2-hidden-accessible")) {
                                $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                            }
                            else {
                                $(elem).addClass(" is-invalid");
                            }

                            setTimeout(function () {
                                if (elem.hasClass("select2-hidden-accessible")) {
                                    $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                }
                                else {
                                    $(elem).removeClass("is-invalid");
                                }
                                }, 5000);
                        });

                        html += "</ul></div></div>";

                        $("#error").html(html);
                    }
                },
                error: function (xhr) {
                    $('#btn_Insert').removeClass("btn btn-sm btn-success btn-loaders btn-icon");
                    $('#btn_Insert').addClass("btn btn-sm btn-warning");
                    $('#btn_Insert').html("Add");
                    Timeout();
                }
            });
        }
        else {
            $('.modal-body').animate({
                scrollTop: ($('.has-error').offset().top - 300)
            }, 2000);
        }
    });
    //#endregion Add Click

    //#region Delete Click
    $('#btn_Delete').on('click', function (e) {
        e.preventDefault();
        $('#btn_Delete').removeClass("btn btn-success");
        $('#btn_Delete').addClass("btn btn-success btn-loaders btn-icon");
        $('#btn_Delete').html("Deleting the Record....");

        $.ajax({
            url: '@Url.Action("DeleteRegeneraConsent", "RegeneraConsent", new { area = "ConsentForms" })?appId=' + @emr.appId,
            type: "POST",
            dataType: 'JSON',
            success: function (data) {
                $('#btn_Delete').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Delete').addClass("btn btn-warning");
                $('#btn_Delete').html("Delete");

                if (data.isAuthorized) {
                    if (data.success) {
                        var alertPlaceholder = document.getElementById("Alert");
                        function alert(e, t) {
                            var l = document.createElement("div");
                            l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                        }
                        alert("<i class='fe fe-check-circle text-white'></i> Regenera Consent Form Deleted Successfully!", "success");
                        clearControls();
                        Timeout();

                        $('#btn_Delete').addClass("d-none");
                        $("#pat_sign_box").addClass("d-none");
                        $("#wit_sign_box").addClass("d-none");
                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                            "<div class='alert alert-warning' role='alert'>" +
                            "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                            "<strong>Error!.. Failed to Delete..</strong><br/>" +
                            "</div></div>";
                        $("#error").html(html);
                    }
                }
                else {
                    var alertPlaceholder = document.getElementById("Alert");
                    function alert(e, t) {
                        var l = document.createElement("div");
                        l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                            '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                    }
                    alert("<i class='fe fe-check-circle text-white'></i> You do not have Enough Privileges to Delete this Designation!", "Access Denied!");
                }
            },
            error: function (xhr) {
                $('#btn_Delete').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_Delete').addClass("btn btn-Delete");
                $('#btn_Delete').html("Delete");
                Timeout();
            }
        })
    });
//#endregion

//#region Print
    $('#btn_Print_C').on('click', function (e) {
    e.preventDefault();
        $('#btn_Print_C').removeClass("btn btn-success");
        $('#btn_Print_C').addClass("btn btn-success btn-loaders btn-icon");
        $('#btn_Print_C').html("Printing the Record....");
    $.ajax({
        type: "Get",
        url: "@Url.Action("PrintPDFConsent", "RegeneraConsent", new {area = "ConsentForms" })?appId=" + @emr.appId + "&form=RegeneraConsent",
        dataType: 'JSON',
        success: function (data) {
            console.log(data);
            if (data.isAuthorized) {
                if (data.success) {
                    window.location.href = data.message.pdfPath
                }
            }
        },
        error: function (xhr) {
            console.log(xhr);
        }
    });
});
//#endregion Print

    //#region Reset
    $('#btn_Reset_C').on('click', function (e) {
        e.preventDefault();
        clearControls();
    });
    //#endregion Reset

    //#region Clear Controls
    var clearControls = function () {
        $(".form-control").val("");
        $(".form-control-sm").val("");
        $("#pat_sign,#wit_sign").attr("src", "");

    }
    //#endregion Clear Controls
    //#region Wacom Tab Signature
        var openWacomTabSignaturePad = function (id) {
            var _data = {
                "patId": @emr.patId,
                "person": id,
                "form": "RegeneraConsent",
                "appId": @emr.appId,
                "formname":"Regenera Consent",
                "formlink":"PrintRegeneraConsent",
                "eSign":""
            }
            $.ajax({
                type: "GET",
                url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion
    //#region Signature
    var openSignaturePad = function (id) {
        var _data = {
            "patId": @emr.patId,
            "person": id,
            "form": "RegeneraConsent",
            "appId": @emr.appId,
            "formname":"Regenera Consent",
            "formlink":"PrintRegeneraConsent",
            "eSign":""
        }
        $.ajax({
            type: "GET",
            url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
            contentType: "application/json",
            dataType: "html",
            data: _data,
            success: function (response) {
                $("#signature_pad_body").html(response);
                $("#signature_pad").modal("show");
            },
            error: function (xhr) {
                console.log("Error :" + xhr.statusText);
            }
        });
    }
    //#endregion Signature

    $('#signature_pad').on('hidden.bs.modal', function () {
        if (localStorage.getItem("sign") != null) {
            GetSignaturename('patient');
            GetSignaturename('witness');
            localStorage.removeItem("sign");
        }
    });

      //#region Get Signature
  var GetSignaturename = function  (person) {
      $.ajax({
          url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=RegeneraConsent',
          type: "GET",
          dataType: "json",
          async: false,
          success: function (response) {
              console.log(response);
              let sign = response[0].psb_sign;
              var date = moment(response[0].psb_date_modified).format("DD-MM-YYYY HH:mm");

              if (response[0].person == "patient") {
                  $("#pat_sign_box").removeClass("d-none");
                  $("#psb_date_patient").html(date);
                  $("#pat_sign").attr("src", sign);
              }
              if (response[0].person == "witness") {
                  $("#wit_sign_box").removeClass("d-none");
                  $("#wit_sign").attr("src", sign);
                  $("#psb_date_witness").html(date);
              }
          },
          error: function (xhr) {
              console.log(xhr);
              alert(xhr);
          }

      });
  };
  //#endregion Get Signature

    //#region Alert Timeout
    function Timeout() {
        window.setTimeout(function () {
            $(".alert").fadeTo(500, 0).slideUp(500, function () {
                $(this).remove();
            });
        }, 4200);
    }
    //#endregion Alert Timeout

</script>


@using System.Linq;
@using System.Security.Claims;
@using BusinessEntities;
@model BusinessEntities.ConsentForms.DmaxBotox
@{
    var claims = ClaimsPrincipal.Current.Identities.First().Claims.ToList();
    var emp_designation = claims.Where(c => c.Type == ClaimTypes.Role).Select(c => c.Value).SingleOrDefault();
    EMRInfo emr = (EMRInfo)TempData["emr_data"];
    TempData.Keep("emr_data");
}
<form id="form_DmaxBotoxEdit" autocomplete="off" name="DmaxBotox" ondrop="return false;" onpaste="return false;" oncut="return false;">
    @Html.AntiForgeryToken()
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-12">
            <div class="border">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="row mt-2">
                        <div class="col-sm-12 col-md-6 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black text-align-left"> Patient Name</label></div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-4">
                            <label class="form-label text-red text-left text-capitalize">@emr.pat_name</label>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> Emirates ID</label></div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-4">
                            <label class="form-label text-red text-left">@emr.pat_emirateid</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2 mb-2">
                            <div class="form-group mb-3 text-align-left"><label class="form-label text-black ">File No</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_code</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> DOB</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_dob</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2 mb-2">
                            <div class="form-group mb-3"><label class="form-label text-black"> Nationality</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_nationality</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Gender</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.pat_gender</label>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Doctor's Name</label></div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-2">
                            <label class="form-label text-red text-left">@emr.doc_name</label>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2">
                            <div class="form-group mb-3"><label class="form-label text-black">Date</label></div>
                        </div>
                        <div class="col-sm-12 col-md-3 col-lg-2">
                            <label class="form-label text-red text-left">@emr.app_fdate</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5 mt-5 col-sm-12 col-md-12 col-lg-12 text-justify">

        <div class="font-weight-semibold">
            This Informed Consent Form has two parts:
        </div>
        <div class="col-sm-12 col-md-12 col-lg-5">
            <ul class="list-group">
                <li class="listunorder" style="border:none">Information Sheet (to share information about the treatment with you)</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-6">
            <ul class="list-group">
                <li class="listunorder" style="border:none">Certificate of Consent (for signatures if you agree to go ahead with the treatment)</li>
            </ul>
        </div>
        <div class="font-weight-semibold">Dubai Health Authority law guarantees that you have both the right and the obligation to make decisions regarding your health care. <lable class="text-red">@emr.set_company</lable> team can provide you with the necessary information and advice, but you must participate in the decision-making process. This form acknowledges your consent to treatment and surgical or non-surgical procedures recommended by your physician.</div>
        <div class="mt-2">You will be given a copy of the full Informed Consent Form</div>
        <div class="font-weight-semibold mt-2">PART I: Information Sheet</div>
        <div class="mt-2">
            I, Dr.<label class="text-red">@emr.doc_name</label> with license No: <label class="text-red">@emr.emp_license</label> should be performing the Botox procedure on Miss/Mrs./Mr.<label class="text-red">@emr.pat_name</label>
            Age <label class="text-red">@emr.pat_age</label> years, on date <label class="text-red">@emr.app_fdate</label>
        </div>
        <div class="mt-2">The following has been explained to the patient in general terms.</div>
        <div class="mt-2 font-weight-semibold">Proposed procedure –Botox Injection</div>
        <div class="mt-2">Botulinum toxin is a purified protein that can relax certain muscles that cause wrinkles appearing with facial expressions and thereby giving the overlying skin a smoother appearance. Botulinum is diluted to a very controlled solution and injected into the muscle with a very thin needle. Response is usually seen in 2-10 days after the injection and last for about 3-5 months, you should understand that as all people are different there is no guarantee to how long your results will last. The results can vary in subsequent treatments and rarely this treatment may not work at all. Botulinum is best for treating dynamic lines caused by facial muscle activity. Lines present at rest may or may not improve. You may need more than one session to get the desired result.</div>
        <div class="mt-2 font-weight-semibold"> Botulinum toxin type used: </div>
        <div class="col-sm-4 col-md-4 col-lg-4">
            <ul class="list-group">
                <li class="listunorder" style="border:none">Botox (USA) </li>
            </ul>
        </div>
        <div class="col-sm-4 col-md-4 col-lg-4">
            <ul class="list-group">
                <li class="listunorder" style="border:none">Dysport (UK)</li>
            </ul>
        </div>
        <div class="col-sm-4 col-md-4 col-lg-4">
            <ul class="list-group">
                <li class="listunorder" style="border:none">Xeomin (USA/GERMANY)</li>
            </ul>
        </div>
        <div class="mt-2 font-weight-semibold">Pre procedure assessment </div>
        <div class="col-sm-12 col-md-12 col-lg-6">
            <ul class="list-group">
                <li class="listunorder" style="border:none">It is important to tell your doctor about your medication allergies and complete medical history.</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-5">
            <ul class="list-group">
                <li class="listunorder" style="border:none">Whether you are pregnant or breast feeding</li>
            </ul>
        </div>
        <div class="mt-2 font-weight-semibold">Side Effects and Complications of Botox Injections</div>
        <div class="mt-2"><label class="text-red">@emr.set_company</label> team has explained to the patient that there are possible risks and undesirable consequences associated with this procedure including but not limited to</div>
        <div class="mt-2 font-weight-semibold">Complications</div>
        <div class="mt-2">Pain, Temporary redness, swelling and bruising at the site of injection that usually resolves in 1-7 days, Infection at the injection site that may need further treatment, Asymmetry (unevenness) ,Transient headache for first 48 hours, Temporary drop of eyebrow(s)/eyelid(s) that can last for few weeks (rare), Weakened tear duct, Allergic reaction ,Numbness of the forehead that can last up to 2-3 weeks (occasional), Flu like symptoms, double vision may occur and will require the use of eye patch for 3-4 weeks till it resolves (Very rare).</div>
        <div class="mt-2">Discomforts- slight burning sensation while taking the injection.</div>
        <div class="mt-2 font-weight-semibold">Benefits</div>
        <div class="col-sm-12 col-md-12 col-lg-2">
            <ul class="list-group">
                <li class="listunorder" style="border:none">No downtime</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3">
            <ul class="list-group">
                <li class="listunorder" style="border:none">Reduced wrinkles and fine lines</li>
            </ul>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-4">
            <ul class="list-group">
                <li class="listunorder" style="border:none">Improve your self-esteem</li>
            </ul>
        </div>
        <div class="mt-2 font-weight-semibold">Alternatives</div>
        <div class="mt-2">The reasonable alternatives to the procedure as well as risks and benefits of the alternatives have been explained to the patient. </div>
        <div class="mt-2 font-weight-semibold">Confidentiality</div>
        <div class="mt-2"><label class="text-red">@emr.set_company</label> team will maintain the confidentiality of your details and we assure not to disclose them to any other party without your acknowledgment.</div>
        <div class="mt-2 font-weight-semibold">Financial Implications </div>
        <div class="mt-2">All procedures/treatments provided that are not covered by insurance may require your full payment or co-payment. The payment is not refundable.</div>
        <div class="mt-2 font-weight-semibold">PART II: Certificate of Consent </div>
        <div class="mt-2">I have read the previous information, or it has been read to me. I have had the opportunity to ask questions about it, and any questions that I have asked have been answered to my satisfaction. I consent voluntarily to undergo this treatment and understand that I have the right to withdraw from the procedure or treatment at any time without in any way affecting my medical care. </div>
        <div class="mt-2">In permitting my doctor to perform my procedure, I understand that the unforeseen conditions may be revealed that may necessitate change or extension of the original procedure or a different procedure than those already explained to me. I therefore authorize and request that the above-named physician, his/her assistants or his/her designees perform such procedure as necessary or desirable in the exercise of his/her judgment.</div>
        <div class="mt-2">In the unlikely event that one or more of the above inherent complications may occur, my physician may take appropriate and reasonable steps to manage and be available to me and my family to address our concerns and questions.</div>
        <div class="mt-2">I consent to any photographing or videotaping of the procedure that may be performed, provided by my identity is not revealed by pictures or descriptive texts accompanying them, so that my physician may follow my therapy progression.</div>
        <div class="mt-2">Witness statement I have accurately read or witnessed the accurate reading of the consent form to the potential patient, and the individual has had the opportunity to ask questions. I confirm that the individual has given consent freely. </div>
        <div class="mt-2 font-weight-semibold">Healthcare Professional Declaration:</div>
        <div class="mt-2">I have adequately explained to the patient about the procedure and risks, adverse effects, and the standard alternatives available for the procedure. I have permitted time and opportunity for the patient to ask questions, and all questions have been answered to my knowledge.</div>
        <div class="mt-2 font-weight-semibold">
            "I agree that healthcare provider(s) involved in my care at this facility will access my health information
            through the Health Information Exchange System (NABIDH) in accordance with the Laws of the United Arab Emirates,
            Emirate of Dubai Legislation and Dubai Health Authority Policies "
        </div>
        <div class="mt-2 font-weight-semibold" dir="rtl">
            "أوافق على أن مقدمي الرعاية الصحية المشاركين في رعايتي في هذه المنشأة سيتمكنون من الوصول إلى معلوماتي الصحية
            من خلال نظام تبادل المعلومات الصحية (NABIDH) وفقاً لقوانين دولة الإمارات العربية المتحدة،
            تشريعات إمارة دبي وسياسات هيئة الصحة بدبي "
        </div>
    </div>

    <div class="row mt-2">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center table-responsive">
            <table class="table table-bordered table-condensed">
                <tr>
                    <td colspan="3" class="font-weight-bold text-danger fs-18" width="100%">
                        Sign here, only if all of your questions have been answered to your satisfaction
                    </td>
                </tr>
                <tr>
                    <td width="33%">
                        <div id="upat_sign_box">
                            <img alt="Signature" src="" id="upat_sign" class="avatar avatar-xl bsquare" />
                        </div>
                    </td>
                    <td width="33%">
                        <div id="uwit_sign_box">
                            <img alt="stamp" id="uwit_sign" class="avatar avatar-xl bsquare" />
                        </div>
                    </td>
                    <td width="33%">
                        <img alt="stamp" src="@emr.doc_sign" id="doc_sign" class="avatar avatar-xl bsquare" />
                    </td>
                </tr>
                <tr>
                    <td width="33%">
                        <label class="form-label text-red text-left text-capitalize mt-1">@emr.pat_name&nbsp;</label>
                        <span class="font-weight-semibold"> Patient Name</span>
                        <br /><br />
                        <label class="form-label text-red text-left mt-2" id="upsb_date_patient" name="">&nbsp;</label>
                        <span class="font-weight-semibold">Date</span>
                    </td>
                    <td width="33%">
                        @Html.TextBoxFor(m => m.cdb_1, new { @class = "form-control text-center", @id = "ucdb_1", @width = "20px" })
                        <span class="font-weight-semibold">Witness Name</span>
                        <br /><br />
                        <label class="form-label text-red text-left" id="upsb_date_witness" name="">&nbsp;</label>
                        <span class="font-weight-semibold">Date</span>
                    </td>
                    <td width="33%">
                        <label class="form-label text-red text-left text-capitalize mt-1">@emr.doc_name&nbsp;</label>
                        <span class="font-weight-semibold">Doctor’s Name</span>
                        <br /><br />
                        <label class="form-label text-red text-left mt-2" id="ucdb_date_doctor">@Model.cdb_date_modified&nbsp;</label>
                        <span class="font-weight-semibold">Date</span>
                    </td>
                </tr>
                <tr>
                    <td class="font-weight-semibold text-blue" width="33%">
                        Patient Signature
                        <br />
                        <div class="btn-group mr-2">
                            <div class="dropdown">
                                <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" onclick="openSignaturePad('patient')">Tab</a>
                                    <a class="dropdown-item" onclick="openWacomTabSignaturePad('patient')">Wacom Tab</a>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="font-weight-semibold text-blue" width="33%">
                        Witness Signature
                        <br />
                        <div class="btn-group mr-2">
                            <div class="dropdown">
                                <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> witness
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" onclick="openSignaturePad('witness')">Tab</a>
                                    <a class="dropdown-item" onclick="openWacomTabSignaturePad('witness')">Wacom Tab</a>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="font-weight-semibold text-blue text-center" width="33%">Doctor’s Signature</td>
                </tr>
            </table>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-sm-12 col-md-12 col-lg-12 text-center">
            <div class="btn-list btn-animation">
                <button type="submit" class="btn btn-warning btn-sm" id="btn_Update">Save Changes</button>
                <button type="button" class="btn btn-outline-dark btn-sm" id="btn_Reset">Reset</button>
                <button type="button" class="btn btn-danger btn-sm" id="btn_DeleteForm">Delete</button>
                <button type="button" class="btn btn-sm btn-outline-success" id="btn_Print"> Download/Print </button>
            </div>
        </div>
    </div>
</form>

<script type="text/javascript">
    $(function () {
        if ("@emp_designation.ToString()" === "Super Administrator") {
            $("#btn_Update").show();
        }
        else {
            if ("@emr.set_emr_lock" == "NoLock") {
                $("#btn_Update").show();
            }
            else {
                if ("@emr.app_ae_date" >= "@emr.today") {
                    $("#btn_Update").show();
                }
                else {
                    $("#btn_Update").hide();
                }
            }
        }
        validate();
        GetSignaturename('patient');
        GetSignaturename('witness');
    });

    //#region Validation Initialization
    var validate = function () {
        $("#form_DmaxBotoxEdit").validate({
            rules: {
                cdb_1: {
                    required: true
                },

            },
            messages: {
                cdb_1: {
                    required: "Please Enter Witness Name"
                },

            },
            highlight: function (element) {
                var elem = $(element);
                $(element).parent().addClass('has-error');
                //error_timeout(elem.attr("id"));
            },
            unhighlight: function (element) {
                var elem = $(element);
                $(element).parent().removeClass('has-error');
            },
            errorElement: 'span',
            errorClass: 'text-danger fw-bold',
            errorPlacement: function (error, element) {
                var elem = $(element);
                if (element.parent('.input-group').length) {
                    error.insertAfter(element.parent());
                } else {
                    error.insertAfter(element);
                }
            }
        });
    }
    //#endregion

    //#region Update  Click
    $('#btn_Update').on('click', function (e) {
        e.preventDefault();
        if ($("#form_DmaxBotoxEdit").valid()) {
            console.log($("#cdbId").val());
            $('#btn_Update').removeClass("btn btn-sm btn-success");
            $('#btn_Update').addClass("btn btn-sm btn-success btn-loaders btn-icon");
            $('#btn_Update').html("Updating the Record....");


            var _dateInsert = {
                "cdbId": 0,
                "cdb_appId": @emr.appId,
                "cdb_1": $("#ucdb_1").val(),
                "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
            }

            console.log(_dateInsert);

            $.ajax({
                type: "Post",
                url: "@Url.Action("EditDmaxBotox", "DmaxBotox", new {area = "ConsentForms" })",
                dataType: 'JSON',
                data: _dateInsert,
                success: function (data) {
                    $('#btn_Update').removeClass("btn btn-sm btn-warning btn-loaders btn-icon");
                    $('#btn_Update').addClass("btn btn-sm btn-warning");
                    $('#btn_Update').html("Save Changes");

                    if (data.isSuccess) {
                        if (data.isEdited) {
                            GetDmaxBotoxInfo();
                            var alertPlaceholder = document.getElementById("Alert");
                            function alert(e, t) {
                                var l = document.createElement("div");
                                l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" role="alert">' + e +
                                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                            }
                            alert("<i class='fe fe-check-circle text-white'></i>Botox Consent Form Updated Successfully!", "success");
                            Timeout();
                            $("#DmaxBotox_edit").show();
                            $("#DmaxBotox_add").hide();
                        }
                        else {
                            let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                                "<div class='alert alert-warning' role='alert'>" +
                                "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                "<strong>Warning..Botox Consent Form already Exists..</strong><br/>" +
                                "</div></div>";
                            $("#Alert").html(html);
                        }
                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-6 d-flex justify-content-center'>" +
                        "<div class='alert alert-danger' role='alert'>" +
                        "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                        "<strong>Validation Error.. Please correct before you submit the form!&nbsp;</strong><br/><ul>";

                        $.each(data.message, function (index, value) {
                            html += "<li><small>" + value + "</small><li>";
                            var elem = $("#" + index);
                            if (elem.hasClass("select2-hidden-accessible")) {
                                $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                            }
                            else {
                                $(elem).addClass(" is-invalid");
                            }

                            setTimeout(function () {
                                if (elem.hasClass("select2-hidden-accessible")) {
                                    $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                }
                                else {
                                    $(elem).removeClass("is-invalid");
                                }
                                }, 5000);
                        });

                        html += "</ul></div></div>";

                        $("#error").html(html);
                    }
                },
                error: function (xhr) {
                    $('#btn_Update').removeClass("btn btn-sm btn-warning btn-loaders btn-icon");
                    $('#btn_Update').addClass("btn btn-sm btn-warning");
                    $('#btn_Update').html("Save Changes");
                    Timeout();
                }
            });
        }
        else {
            $('.modal-body').animate({
                scrollTop: ($('.has-error').offset().top - 300)
            }, 2000);
        }
    });
    //#endregion Update Click

        //#region Print
$('#btn_Print').on('click', function (e) {
    e.preventDefault();
    $('#btn_Print').removeClass("btn btn-success");
    $('#btn_Print').addClass("btn btn-success btn-loaders btn-icon");
    $('#btn_Print').html("Printing the Record....");
    $.ajax({
        type: "Get",
        url: "@Url.Action("PrintPDFConsent", "DmaxBotox", new {area = "ConsentForms" })?appId=" + @emr.appId + "&form=DmaxBotox",
        dataType: 'JSON',
        success: function (data) {
            if (data.isAuthorized) {

                if (data.success)
                    console.log(data);
                    console.log(data.message.pdfPath); {
                    window.location.href = data.message.pdfPath
                }
            }
        },
        error: function (xhr) {
            console.log(xhr);
        }
    });
});
//#endregion Print

    //#region Delete Click
    $('#btn_DeleteForm').on('click', function (e) {
        e.preventDefault();
        $('#btn_DeleteForm').removeClass("btn btn-success");
        $('#btn_DeleteForm').addClass("btn btn-success btn-loaders btn-icon");
        $('#btn_DeleteForm').html("Deleting the Record....");

        $.ajax({
            url: '@Url.Action("DeleteDmaxBotox", "DmaxBotox", new { area = "ConsentForms" })?appId=' + @emr.appId,
            type: "POST",
            dataType: 'JSON',
            success: function (data) {
                $('#btn_DeleteForm').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_DeleteForm').addClass("btn btn-warning");
                $('#btn_DeleteForm').html("Delete");
                if (data.isAuthorized) {
                    if (data.success) {
                        var alertPlaceholder = document.getElementById("Alert");
                        function alert(e, t) {
                            var l = document.createElement("div");
                            l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                                '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                        }
                        alert("<i class='fe fe-check-circle text-white'></i> Botox Consent Form Deleted Successfully!", "success");
                        clearControls();

                        $("#DmaxBotox_edit").hide();
                        $("#DmaxBotox_add").show();
                        AddDmaxBotox();
                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                            "<div class='alert alert-warning' role='alert'>" +
                            "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                            "<strong>Error!.. Failed to Delete..</strong><br/>" +
                            "</div></div>";
                        $("#error").html(html);
                    }
                }
                else {
                    var alertPlaceholder = document.getElementById("Alert");
                    function alert(e, t) {
                        var l = document.createElement("div");
                        l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" >' + e +
                            '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                    }
                    alert("<i class='fe fe-check-circle text-white'></i> You do not have Enough Privileges to Delete this Designation!", "Access Denied!");
                }
            },
            error: function (xhr) {
                $('#btn_DeleteForm').removeClass("btn btn-success btn-loaders btn-icon");
                $('#btn_DeleteForm').addClass("btn btn-Delete");
                $('#btn_DeleteForm').html("Delete");
                Timeout();
            }
        })
    });
//#endregion
    //#region Reset
    $('#btn_Reset').on('click', function (e) {
        e.preventDefault();
        clearControls();
    });
    //#endregion Reset

    //#region Clear Controls
    var clearControls = function () {
        $(".form-control").val("");
        $(".form-control-sm").val("");
        $("#upat_sign,#uwit_sign").attr("src", "");
    }
    //#endregion Clear Controls
        //#region Wacom Tab Signature
    var openWacomTabSignaturePad = function (id) {
            var _data = {
                 "patId": @emr.patId,
                 "person": id,
                 "form": "DmaxBotox",
                 "appId": @emr.appId,
                 "formname":"Dmax Botox",
                 "formlink":"",
                 "eSign":""
             }
            $.ajax({
                type: "GET",
                url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
                contentType: "application/json",
                dataType: "html",
                data: _data,
                success: function (response) {
                    $("#signature_pad_body").html(response);
                    $("#signature_pad").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
    //#endregion
    //#region Signature
    var openSignaturePad = function (id) {
        var _data = {
            "patId": @emr.patId,
            "person": id,
            "form": "DmaxBotox",
            "appId": @emr.appId,
            "formname":"Dmax Botox",
            "formlink":"",
            "eSign":""
        }
        $.ajax({
            type: "GET",
            url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
            contentType: "application/json",
            dataType: "html",
            data: _data,
            success: function (response) {
                $("#signature_pad_body").html(response);
                $("#signature_pad").modal("show");
            },
            error: function (xhr) {
                console.log("Error :" + xhr.statusText);
            }
        });
    }
    //#endregion Signature

    $('#signature_pad').on('hidden.bs.modal', function () {
        if (localStorage.getItem("sign") != null) {
            GetSignaturename('patient');
            GetSignaturename('witness');
            localStorage.removeItem("sign");
        }
    });

        // #region Get Signature
        var GetSignaturename = function  (person) {
            $.ajax({
                url: '@Url.Action("GetSignature", "SignaturePad", new { area = "Common" })?appId=' + @emr.appId + '&person=' + person + '&form=DmaxBotox',
                type: "GET",
                dataType: "json",
                async: false,
                success: function (response) {
                    console.log(response);
                    let sign = response[0].psb_sign;
                    var date = moment(response[0].psb_date_modified).format("DD-MM-YYYY");

                    if (response[0].person == "patient") {
                        $("#upat_sign_box").removeClass("d-none");
                        $("#upsb_date_patient").text(date);
                        $("#upat_sign").attr("src", sign);
                    }
                    if (response[0].person == "witness") {
                        $("#uwit_sign_box").removeClass("d-none");
                        $("#upsb_date_witness").text(date);
                        $("#uwit_sign").attr("src", sign);
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                    alert(xhr);
                }

            });
        };
        //#endregion Get Signature

    //#region Alert Timeout
    function Timeout() {
        window.setTimeout(function () {
            $(".alert").fadeTo(500, 0).slideUp(500, function () {
                $(this).remove();
            });
        }, 4200);
    }
    //#endregion Alert Timeout

</script>

@model BusinessEntities.FrontDesk.RegistrationForm
@{
    ViewBag.Title = "Registration Form";
    //Layout = "~/Views/Shared/_Layout.cshtml";
}

<style type="text/css">
    .avatar-xl {
        width: 20rem !important;
    }
</style>

<!-- INTERNAL telephoneinput css-->
<link rel="stylesheet" href="~/assets/plugins/telephoneinput/telephoneinput.css">

<div class="row">
    <div class="col-12 col-sm-12 col-md-12 d-flex justify-content-center">
        <div class="card">
            <div class="card-body">
                <form id="form_Add" autocomplete="off" name="RegistrationForm">
                    @Html.AntiForgeryToken()
                    @Html.HiddenFor(m => m.appId)
                    @Html.HiddenFor(m => m.patId)

                    <div class="row" id="print_formreg">
                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <div class="row">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <div class="form-group mb-3">
                                        <h4 class="form-label text-black text-center">Patient’s Registration Form</h4>
                                        <h4 class="form-label text-black text-center" dir="rtl">  إستمارة تسجيل المريض</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-12 col-lg-12 text-center">
                                    <div class="form-group mb-3" style="display: none" id="headimgR">
                                        <h3 class="card-title ">
                                            <img alt="header" src=" " id="headerimg" />
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black"> Patient Name:&nbsp;</label></div>
                                </div>

                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3">
                                        <label class="form-label text-red text-center text-capitalize" id="pat_name">@Model.pat_name&nbsp;</label>
                                    </div>

                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">الاسم&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">File No:&nbsp;</label></div>
                                </div>

                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3">
                                        <label class="form-label text-red text-center" id="pat_code">@Model.pat_code&nbsp;</label>
                                    </div>

                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">    رقم الملف&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">

                                    <div class="form-group mb-3"><label class="form-label text-black"> Date of Birth	&nbsp;</label></div>

                                </div>

                                <div class="col-sm-12 col-md-4 col-lg-4" id="dob">
                                    <div class="form-group mb-3 text-center">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <div class="input-group-text">
                                                    <i class="fe fe-calendar"></i>
                                                </div>
                                            </div>
                                            @Html.TextBoxFor(m => m.pat_dob, new { @class = "form-control", @placeholder = "DD-MMMM-YYYY", @id = "upat_dob" })
                                        </div>

                                    </div>

                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4" style="display:none;" id="dob1">
                                    <div class="input-group mb-3 text-center">
                                        <label class="form-label text-black text-center" id="upat_dob1" name="">&nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">    تاريخ الميلاد &nbsp;</label></div>

                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">Gender&nbsp;</label></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3">
                                        <label class="form-label text-red text-center" id="pat_gender">@Model.pat_gender&nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">  جنس&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">Nationality&nbsp;</label></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3 text-center" id="nat">
                                        @Html.DropDownListFor(m => m.pat_nat, (IEnumerable<SelectListItem>)ViewData["NationalityList"], "Please Select", new { @class = "form-select select2 mb-2", @id = "upat_nat" })

                                    </div>
                                    <div class="form-group mb-3" id="nat1" style="display:none;">
                                        <label class="form-label text-black text-center" id="upat_nat1" name="">&nbsp;</label>
                                    </div>

                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">  الجنسية&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">Your Address&nbsp;</label></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3 text-center">
                                        @Html.TextAreaFor(m => m.pat_address, new { @class = "form-control mb-2", @placeholder = "Ex: Building No 1234, Internet City, Dubai, UAE", @id = "upat_address", rows = "4" })
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">  عـنوانك&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">E-mail&nbsp;</label></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3 text-center">
                                        @Html.TextBoxFor(m => m.pat_email, new { @class = "form-control mb-2", @placeholder = "Ex: Vision@gmail.com", @id = "upat_email", @type = "email" })
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">    البريد الإلكتروني&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <div class="form-group mb-3">
                                        <h5 class="form-label text-black">
                                            Phones Numbers الهـــواتف
                                        </h5>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">Mobile No	&nbsp;</label></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4" id="MobileNo">
                                    <div class="input-group mb-3 text-center">
                                        <div class="d-flex">
                                            @Html.TextBoxFor(m => m.pat_mob, new { @type = "tel", @class = "form-control mb-2", @placeholder = "Ex: 512345678", @id = "upat_mob", @style = "width:100%;" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4" style="display:none;" id="MobileNo1">
                                    <div class="input-group mb-3">
                                        <label class="form-label text-black text-center" id="upat_mob1" name="">&nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">    المتحرك&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">Res.Tel&nbsp;</label></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4" id="ResTel">
                                    <div class="input-group mb-3 text-center">
                                        <div class="d-flex">
                                            @Html.TextBoxFor(m => m.pat_tel, new { @type = "tel", @class = "form-control", @placeholder = "Ex: 512345678", @id = "upat_tel", @style = "width:100%;" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4" style="display:none;" id="ResTel1">
                                    <div class="input-group mb-3">
                                        <label class="form-label text-black text-center" id="upat_tel1" name="">&nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">   المـنزل&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black"> Billing Way:&nbsp;</label></div>
                                </div>

                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3">
                                        <label class="form-label text-red text-center" id="ic_name">@Model.ic_name&nbsp;</label>
                                    </div>

                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">

                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <div class="form-group mb-3">
                                        <h5 class="form-label text-black">
                                        </h5>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">How did you know about our clinic&nbsp;</label></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="input-group mb-3 text-center">
                                        @Html.TextBoxFor(m => m.pat_hear, new { @type = "tel", @class = "form-control", @placeholder = "Ex: 512345678", @id = "upat_hear", @style = "width:100%;" })
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">    كيف عرفت عن مركزنا بواسطة  &nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">Name of Doctor’s Referral	&nbsp;</label></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="input-group mb-3 text-center" id="referal">

                                        @Html.DropDownListFor(m => m.pat_referal, (IEnumerable<SelectListItem>)ViewData["ReferalList"], "Please Select", new { @class = "form-select select2 mb-2 ", @id = "upat_referal" })
                                    </div>
                                    <div class="input-group mb-3" style="display:none;" id="referal1">
                                        <label class="form-label text-black text-center" id="upat_referal1" name="">&nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">    الإحالة &nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row" style="text-align:justify">
                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <div class="form-group mb-3">
                                        <h4 class="form-label text-black">General Consent for Treatment</h4>
                                        <p>1. I am asking for medical care and treatment at @Model.set_company and agree to accept services which may diagnose a medical condition, procedures to treat my condition and routine medical care. I understand that these services will be proved to me by physicians, healthcare providers. I have not been given any guarantees as to the result of the services I will receive.</p>
                                        <p>2. I understand that my agreement to accept these services will remain in effect unless I say that I no longer want these services or until my treatment is completed.</p>
                                        <p>3. I understand that my agreement to accept these services is called a general consent and that it includes any routine procedure(s) or treatment(s) such as blood drawing, physical examination, administration of medication(s), use of local anesthesia and other procedures.</p>
                                    </div>
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <div class="form-group mb-3">
                                        <h4 class="form-label text-black" dir="rtl">نموذج عام للموافقة على العلاج</h4>
                                        <p dir="rtl">
                                            لتلقي العلاج في العيادة وتقبل الكل الخدمات والإجراءات التشخيصية التي تتطلبها حالتي الصحية لوضع خطة التشخيص والعلاج بالإضافة إلى تلك الخاصة بالرعاية الصحية الروتينية ، وأنا على علم أن هذه الخدمات سيتم تقديمها لي من قبل الطاقم الطبي (الأطباء والممرضات) وأنه لم يتم تقديم أي ضمانات بخصوص نتائج الرعاية المقدمة لي
                                        </p>
                                        <p dir="rtl">2. أعرف بأن موافقتي لقبول تلك الخدمات ستبقى سارية المفعول لحين انتهاء علاجي أو طلب إيقاف علاجي</p>
                                        <p dir="rtl">3. أعرف بأن موافقتى تقع ضمن إطار الموافقة العامة على جميع الخدمات والتى تتضمن الإجراءات والعلاج الروتينى مثل (سحب عينة دم -الفحص السريري -إعطاء الادوية -التخدير الموضعى أو أى من الاجراءات الأخرى)</p>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="text-align:justify">
                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <div class="form-group mb-3">
                                        <h4 class="form-label text-black">Financial Responsibilities:</h4>
                                        <p>
                                            The cost of treatment involves several charges for the service provided. I understand that the insurance bills provided are not guaranteed to be paid by the insurance company, I hereby accept to take the responsibility of paying my medical bills if not approved partially or totally.
                                        </p>
                                        <p>
                                            I understand and agree that if I decide to cancel the surgery or any procedure in less than 24 working hours of the scheduled appointment, then 25% will be deducted from the total bill. I also agree cancelation of the surgery.
                                        </p>
                                    </div>
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <div class="form-group mb-3">
                                        <h4 class="form-label text-black" dir="rtl">المسؤوليات المالية:</h4>
                                        <p dir="rtl">
                                            إن تكاليف العلاج تتضمن رسوم عديدة للخدمات المقدمة ,وأتفهم أن الفواتير تقدم إلى شركة التأمين دون أى ضمانات للدفع من قبلهم. ولذلك فإننى أتحمل مسؤولية دفع الفواتير الطبية فى حالة عدم تغطية شركة التأمين لها جزئيا"أو كليا
                                        </p>
                                        <p dir="rtl">
                                            أتفهم فى حال رغبتى فى إلغاء أوتأجيل موعد العملية أو الإجراء فى أقل من 24 ساعة من الموعد المحدد سيتم خصم 25% من إجمالى المبلغ .كما أننى أتفهم أيضا" انة سيتوجب على الالتزام بكافة تكاليف الخدمات التى قدمت لى قبل قرارى بإلغاء أو تأجيل العملية أو الإجراء.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">Name&nbsp;</label></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3">
                                        <label class="form-label text-red text-center text-capitalize" id="pat_name1">@Model.pat_name&nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">الاسم&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">Date&nbsp;</label></div>
                                </div>

                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3">
                                        <label class="form-label text-red text-center" id="regupsb_date_patientr" name="">&nbsp;</label>
                                    </div>

                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">التاريخ&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">File No&nbsp;</label></div>
                                </div>

                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3">
                                        <label class="form-label text-red text-center" id="pat_code1">@Model.pat_code&nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">    رقم الملف&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3"><label class="form-label text-black">Patient Signature&nbsp;</label></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4 text-center">
                                    <div class="form-group mb-3" id="regpatimg"><img alt="Signature" src="~/images/signature_bg.jpg" id="regpat_sign" class="avatar avatar-xl bsquare text-center" /></div>
                                </div>
                                <div class="col-sm-12 col-md-4 col-lg-4">
                                    <div class="form-group mb-3" dir="rtl"><label class="form-label text-black text-right">&nbsp;</label></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 col-md-12 col-lg-12 text-center">
                                    <div class="card-footer" style="display:none" id="footimgR">
                                        <h3 class="card-title">
                                            <img alt="footer" src=" " id="footerimg" />
                                        </h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="card-footer">
                <div class="row mt-2">
                    <div id="error"></div>
                    <div class="col-sm-12 col-lg-12 text-right">
                        <div class="btn-list btn-animation">

                            <button type="submit" class="btn btn-sm btn-outline-warning " id="Regbtn_Update">Save Changes</button>
                            <div class="btn-group mr-2">
                                <div class="dropdown">
                                    <button type="button" class="btn-sm btn-secondary me-2 mb-2 dropdown-toggle" data-bs-toggle="dropdown">
                                        <i class="fa fa-paint-brush">&nbsp;&nbsp;</i> Patient
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" onclick="openSignaturePadReg('patient')">Tab</a>
                                        <a class="dropdown-item" onclick="openWacomTabSignaturePadReg('patient')">Wacom Tab</a>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-sm btn-outline-light" id="Regbtn_Print" value="Print">
                                <i class="fa fa-print">&nbsp;&nbsp;</i>Print
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--INTERNAL telephoneinput js-->
<script src="~/assets/plugins/telephoneinput/telephoneinput.js"></script>

<script type="text/javascript">
    var appId = $('#appId').val()
    var patId = $('#patId').val()
    var formName = $(form_Add).closest('form').attr('name');

    //#region Page Load
    $(function () {
        $("#upat_tel").intlTelInput();
        $("#upat_mob").intlTelInput();

        $('#upat_dob').bootstrapdatepicker({
            format: "dd-MM-yyyy",
            viewMode: "date",
            todayHighlight: true,
            autoclose: true,
            multidate: false,
            multidateSeparator: "-"
        });

        $("#upat_dob").bootstrapdatepicker("setDate", moment(new Date("@Model.pat_dob")).format("DD-MMMM-YYYY"));

        $("#upat_nat").select2({
            placeholder: 'Select Nationality',
            width: '100%',
            dropdownParent: $('#form_Add')
        });

        $("#upat_referal").select2({
            placeholder: 'Select Referal',
            width: '100%',
            dropdownParent: $('#form_Add')
        });

        GetSignaturename(appId, 'patient', 'RegistrationForm');

        validation();

        printdata();
    });
    //#endregion

    //#region Update Click
    $('#Regbtn_Update').on('click', function (e) {
        e.preventDefault();

        if ($("#form_Add").valid()) {
            $('#Regbtn_Update').removeClass("btn btn-success");
            $('#Regbtn_Update').addClass("btn btn-success btn-loaders btn-icon");
            $('#Regbtn_Update').html("Updating the Record....");

            var _dateInsert = {
                "appId": $("#appId").val(),
                "patId": $("#patId").val(),
                "pat_dob": moment($("#upat_dob").val()).format("YYYY-MM-DD"),
                "pat_nat": parseInt($("#upat_nat").val()),
                "pat_address": $("#upat_address").val(),
                "pat_email": $("#upat_email").val(),
                "pat_mob": $("#upat_mob").val(),
                "pat_tel": $("#upat_tel").val(),
                "pat_hear": $("#upat_hear").val(),
                "pat_referal": $("#upat_referal").val(),
                "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
            }

            $.ajax({
                type: "Post",
                url: "@Url.Action("UpdateRegistrationForm", "RegistrationForm", new {area = "FrontDesk" })",
                dataType: 'JSON',
                data: _dateInsert,
                success: function (data) {
                    $('#Regbtn_Update').removeClass("btn btn-success btn-loaders btn-icon");
                    $('#Regbtn_Update').addClass("btn btn-warning");
                    $('#Regbtn_Update').html("Save Changes");
                    if (data.isSuccess) {
                        if (data.isInserted) {
                            GetSignaturename(appId, 'patient', 'RegistrationForm');
                            var alertPlaceholder = document.getElementById("Alert");
                            function alert(e, t) {
                                var l = document.createElement("div");
                                l.innerHTML = '<div class="alert alert-' + t + ' alert-dismissible" role="alert">' + e +
                                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="Close">x</button></div>', alertPlaceholder.append(l)
                            }
                            alert("<i class='fe fe-check-circle text-white'></i> Registration Form Updated Successfully!", "success");
                            $('#tab11').click();
                            Timeout();
                        }
                        else {
                            let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                                "<div class='alert alert-warning' role='alert'>" +
                                "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                                "<strong>Warning.. Registration Form Alredy Exists..</strong><br/>" +
                                "</div></div>";
                            $("#Alert").html(html);
                        }
                    }
                    else {
                        let html = "<div class='col-12 col-sm-12 col-md-12 d-flex justify-content-center'>" +
                            "<div class='alert alert-danger' role='alert'>" +
                            "<button type='button' class='btn-close mr-negative-16' data-bs-dismiss='alert' aria-hidden='true' aria-label='Close'>×</button>" +
                            "<strong>Validation Error.. Please correct before you submit the form!&nbsp;</strong><br/><ul>";

                        $.each(data.message, function (index, value) {
                            html += "<li><small>" + value + "</small><li>";
                            var elem = $("#" + index);
                            if (elem.hasClass("select2-hidden-accessible")) {
                                $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                            }
                            else {
                                $(elem).addClass(" is-invalid");
                            }

                            setTimeout(function () {
                                if (elem.hasClass("select2-hidden-accessible")) {
                                    $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                }
                                else {
                                    $(elem).removeClass("is-invalid");
                                }
                            }, 5000);
                        });

                        html += "</ul></div></div>";
                        $("#Alert").html(html);
                    }
                },
                error: function (xhr) {
                    $('#Regbtn_Update').removeClass("btn btn-success btn-loaders btn-icon");
                    $('#Regbtn_Update').addClass("btn btn-warning");
                    $('#Regbtn_Update').html("Save Changes");

                    console.log(xhr);
                }
            })
        }
        else {
            $('.modal-body').animate({
                scrollTop: ($('.has-error').offset().top - 300)
            }, 2000);
        }
    });
    //#endregion

    //#region Validation Initialization
    var validation = function () {
        $("#form_Add").validate({
            focusInvalid: true,
            rules:
            {
                pat_dob: {
                    required: true
                },
                pat_nat: {
                    required: true
                },
                pat_mob: {
                    required: true,
                    minlength: 10
                },
                pat_referal: {
                    required: true
                }
            },
            messages: {
                pat_dob: {
                    required: "Select DOB"
                },
                pat_nat: {
                    required: "Select the Nationality"
                },
                pat_mob: {
                    required: "Enter the Mobile",
                    minlength: "Mobile should be Minimum 10 Characters"
                },
                pat_referal: {
                    required: "Select Referral"
                }
            },
            highlight: function (element) {
                var elem = $(element);
                if (elem.hasClass("select2-hidden-accessible")) {
                    $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                } else {
                    elem.parent().addClass('has-error');
                }
                $(element).parent().addClass('has-error');
            },
            unhighlight: function (element) {
                var elem = $(element);
                if (elem.hasClass("select2-hidden-accessible")) {
                    $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                } else {
                    elem.removeClass('has-error');
                }
                $(element).parent().removeClass('has-error');
            },
            errorElement: 'span',
            errorClass: 'text-danger fw-bold',
            errorPlacement: function (error, element) {
                var elem = $(element);
                if (elem.hasClass("select2-hidden-accessible")) {
                    element = $("#select2-" + elem.attr("id") + "-container").parent();
                    error.insertAfter(element);
                } else {
                    error.insertAfter(element);
                }
                if (element.parent('.input-group').length) {
                    error.insertAfter(element.parent());
                } else {
                    error.insertAfter(element);
                }
            }
        });

        $('#upat_dob').keypress(function (e) {
            var charCode = (e.which) ? e.which : event.keyCode
            if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                return false;

            }
            else {
                if (e.target.value.length >= 18)
                    return false;
            }
        });

        $('#upat_mob').keypress(function (e) {
            var charCode = (e.which) ? e.which : event.keyCode
            if (String.fromCharCode(charCode).match(/[^0-9+]/g)) {
                return false;
            }
            else {
                if (e.target.value.length >= 15)
                    return false;
            }
        });

        $('#upat_tel').keypress(function (e) {
            var charCode = (e.which) ? e.which : event.keyCode
            if (String.fromCharCode(charCode).match(/[^0-9+]/g)) {
                return false;
            }
            else {
                if (e.target.value.length >= 15)
                    return false;
            }
        });

        $('#upat_email').keypress(function (e) {
            var charCode = (e.which) ? e.which : event.keyCode
            if (String.fromCharCode(charCode).match(/[^a-z0-9@@.]/g))
                return false;
        });

        $('#upat_dob').on('change', function () {
            $(this).trigger('blur');
        });

        $('#upat_nat').on('change', function () {
            $(this).trigger('blur');
        });

        $('#upat_mob').on('change', function () {
            $(this).trigger('blur');
        });

        $('#upat_referal').on('change', function () {
            $(this).trigger('blur');
        });
    }
   //#endregion

    //#region Clear Controls
    var clearControls = function () {
        $("#upat_dob").bootstrapdatepicker("setDate", "");
        $("#upat_nat").val(198).trigger('change');
        $("#upat_address").val("");
        $("#upat_email").val("");
        $("#upat_tel").val("+971");
        $("#upat_mob").val("+971");
        $("#upat_referal").val(1).trigger('change');
    }
    //#endregion

    //#region Wacom Tab Signature
    var openWacomTabSignaturePadReg = function (id) {
        var _data = {
            "patId": patId,
            "person": id,
            "form": "RegistrationForm",
            "appId": appId,
            "formname": "Registration Form",
            "formlink": "RegistrationFormPrint",
            "eSign": ""
        }
        $.ajax({
            type: "GET",
            url: "@Url.Action("WacomTabSignaturePad", "WacomTabSignaturePad", new { area = "Common" })",
            contentType: "application/json",
            dataType: "html",
            data: _data,
            success: function (response) {
                $("#signature_pad_body").html(response);
                $("#signature_pad").modal("show");
            },
            error: function (xhr) {
                console.log("Error :" + xhr.statusText);
            }
        });
    }
    //#endregion

    //#region Signature
    var openSignaturePadReg = function (id) {
        var _data = {
            "patId": patId,
            "person": id,
            "form": "RegistrationForm",
            "appId": appId,
            "formname": "Registration Form",
            "formlink": "RegistrationFormPrint",
            "eSign": ""
        }
        $.ajax({
            type: "GET",
            url: "@Url.Action("SignaturePad", "SignaturePad", new { area = "Common" })",
            contentType: "application/json",
            dataType: "html",
            data: _data,
            success: function (response) {
                $("#signature_pad_body").html(response);
                $("#signature_pad").modal("show");
            },
            error: function (xhr) {
                console.log("Error :" + xhr.statusText);
            }
        });
    }
    //#endregion

    $('#signature_pad').on('hidden.bs.modal', function () {
        if (localStorage.getItem("sign") != null) {
            GetSignaturename(appId, 'patient', 'RegistrationForm');

            localStorage.removeItem("sign");
        }
    });

    //#region Get Signature
    var GetSignaturename = function (appId, person, formName) {
        $.ajax({
            url: '@Url.Action("GetSignature", "RegistrationForm", new { area = "FrontDesk" })?appId=' + appId + '&person=' + person + '&form=' + formName,
            type: "GET",
            dataType: "json",
            async: false,
            success: function (response) {
                let sign = response[0].psb_sign;

                var date = moment(response[0].psb_date_Created).format("DD-MM-YYYY HH:mm");

                if (response[0].person == "patient") {
                    $("#regpatimg").show();
                    $("#regpat_sign").attr("src", sign);
                    $("#regupsb_date_patient").text(date);
                }
            },
            error: function (xhr) {
                console.log(xhr);
            }
        });
    };
    //#endregion

    //#region Header/footer images
    var GetHeaderFooter = function (app_branch) {
        $.ajax({
            url: '@Url.Action("GetHeaderFooter", "ClinicSettings", new { area = "Masters" })?setId=' + app_branch,
            type: "GET",
            dataType: "json",
            async: false,
            success: function (response) {
                let header = response[0].set_header_image;

                let footer = response[0].set_footer_image;

                $("#headerimg").attr("src", header);
                $("#footerimg").attr("src", footer);
            },
            error: function (xhr) {
                console.log(xhr);
            }
        });
    };
    //#endregion

    //#region Print $ Display
    var printdata = function () {
        GetHeaderFooter("@Model.app_branch");
        $("#upat_tel1").text("@Model.pat_tel");
        $("#upat_mob1").text("@Model.pat_mob");
        $("#upat_referal1").text("@Model.ref_name");
        $("#upat_nat1").text("@Model.nationality");
        var x = "@Model.pat_dob"
        const myArray = x.split(" ", 1);
        $("#upat_dob1").text(myArray);
    }

    $('#Regbtn_Print').on('click', function (e) {
        $('.form-control').not('#helpDialog').css('border', 'none');
        $('#ResTel,#MobileNo,#dob,#referal,#nat').hide();
        $('#headimgR,#footimgR,#ResTel1,#MobileNo1,#dob1,#referal1,#nat1').show();
        var printStyle = '<style type="text/css">body { font-size: 19px; }</style>';
        var printContents = printStyle+document.getElementById("print_formreg").innerHTML;
        var originalContents = document.body.innerHTML;
        document.body.innerHTML = printContents;
        window.print();
        document.body.innerHTML = originalContents;
        location.reload();
    });

    //$('#Regbtn_Print').on('click', function () {
    //    // Hide unnecessary elements
    //    $('.form-control').not('#helpDialog').css('border', 'none');
    //    $('#ResTel,#MobileNo,#dob,#referal,#nat').hide();
    //    $('#headimgR,#footimgR,#ResTel1,#MobileNo1,#dob1,#referal1,#nat1').show();

    //    // Open a new window for printing
    //    var printWindow = window.open('', '_blank');

    //    // Specify font size for printing
    //    var printStyle = '<style type="text/css">body { font-size: 12px; }</style>';

    //    // Get the HTML content to be printed
    //    var printContents = printStyle + document.getElementById("print_formreg").innerHTML;

    //    // Write the content to the new window
    //    printWindow.document.write(printContents);

    //    // Print and close the new window
    //    printWindow.document.close();
    //    printWindow.print();
    //    printWindow.close();

    //    // Restore the original content
    //    location.reload();
    //});
     //#endregion

    //#region Alert Timeout
    function Timeout() {
        window.setTimeout(function () {
            $(".alert").fadeTo(500, 0).slideUp(500, function () {
                $(this).remove();
            });
        }, 4200);
    }
         //#endregion Alert Timeout
</script>
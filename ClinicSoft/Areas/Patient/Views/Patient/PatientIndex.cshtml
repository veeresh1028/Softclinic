@{
    ViewBag.Title = "Patients Information";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="page-header">
    <div class="page-leftheader">
        <h4 class="page-title mb-0 text-primary"><span data-lang-key="patient-details">Patients Details</span></h4>
    </div>
    <div class="page-rightheader">
        <div class="btn-list btn-animation">
            <button class="btn btn-outline-primary mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#searchFilter" aria-expanded="false" aria-controls="collapseExample">
                <i class="fa fa-filter"></i> <span data-lang-key="advance-filter"> Advanced Filters</span>
            </button>
            <button class="btn btn-outline-info" type="button" data-bs-toggle="modal" data-bs-target="#merge_patient_modal" id="btnMergePatient">
                <i class="fe fe-git-merge"></i> <span data-lang-key="merge">&nbsp;Merge</span>
            </button>
            <button class="btn btn-success" type="button" data-bs-toggle="modal" data-bs-target="#Allocation_patient_modal" id="btnAllocatePatient">
                <i class="fe fe-award"></i> <span data-lang-key="allocations">&nbsp;Allocation</span>
            </button>
            <button class="btn btn-secondary" type="button" data-bs-toggle="modal" data-bs-target="#create_patient_modal" id="btnCreatePatient">
                <i class="mdi mdi-plus"></i> <span data-lang-key="add-patient">&nbsp;Add New Patient</span>
            </button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm-12 col-md-12 col-lg-12">
        <div class="card mb-0">
            <div class="collapse" id="searchFilter">
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-6 col-md-3 col-lg-3">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="branches">Branch<small>(es)</small></span>
                                </label>
                                <select id="select_branch" class="form-control mb-4" multiple="multiple">
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3 col-lg-3">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="residential-types">Residential Type<small>(s)</small></span>
                                </label>
                                <select id="select_residential_type" class="form-control mb-4" multiple="multiple">
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="nationality">Nationality<small>(ies)</small></span>
                                </label>
                                <select id="select_nationality" class="form-control mb-4" multiple="multiple">
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <sapan data-lang-key="mrn-from">MRN From</sapan>
                                </label>
                                <input class="form-control" placeholder="Enter MRN" id="select_mrn_from" />
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <sapan data-lang-key="mrn-to">MRN To</sapan>
                                </label>
                                <input class="form-control" placeholder="Enter MRN" id="select_mrn_to" />
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="class">Class<small>(es)</small></span>
                                </label>
                                <select id="select_class" class="form-control mb-4" multiple="multiple">
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="registered-from">Registered From</span>
                                </label>
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <i class="fe fe-calendar"></i>
                                    </div>
                                </div>
                                <input id="select_date_from_reg" class="form-control" placeholder="DD-MM-YYYY" type="text">
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="registered-to">Registered To</span>
                                </label>
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <i class="fe fe-calendar"></i>
                                    </div>
                                </div>
                                <input id="select_date_to_reg" class="form-control" placeholder="DD-MM-YYYY" type="text">
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="dob-from">DOB From</span>
                                </label>
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <i class="fe fe-calendar"></i>
                                    </div>
                                </div>
                                <input id="select_date_from_dob" class="form-control" placeholder="DD-MM-YYYY" type="text">
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="dob-to">DOB To</span>
                                </label>
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">
                                        <i class="fe fe-calendar"></i>
                                    </div>
                                </div>
                                <input id="select_date_to_dob" class="form-control" placeholder="DD-MM-YYYY" type="text">
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="status">Status<small>(es)</small></span>
                                </label>
                                <select id="select_status" class="form-control mb-4" multiple="multiple"></select>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="gender">Gender<small>(s)</small></span>
                                </label>
                                <select id="select_gender" class="form-control mb-4" multiple="multiple">
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="marital-status">Marital Status<small>(es)</small></span>
                                </label>
                                <select id="select_marital_status" class="form-control mb-4" multiple="multiple">
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="referrals">Referal<small>(s)</small></span>
                                </label>
                                <select id="select_referal" class="form-control mb-4" multiple="multiple">
                                </select>
                            </div>
                        </div>

                        <div class="col-sm-6 col-md-4 col-lg-4">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">
                                    <span data-lang-key="patient-info">Patient Info (Name/Mobile/EID)</span>
                                </label>
                                <input id="select_patient" class="form-control" type="text">
                            </div>
                        </div>

                        <div class="col-sm-6 col-md-2 col-lg-2">
                            <div class="form-group mb-2">
                                <label class="form-label font-weight-semibold">&nbsp;</label>
                                <button class="btn btn-primary mb-2" type="button" id="btnSearch">
                                    <i class="fa fa-search-plus"></i>
                                    <span data-lang-key="search">Search</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12 col-sm-12 col-md-12 d-flex justify-content-center">
        <div id="PatientAlert"></div>
    </div>
    <div class="col-sm-12 col-md-12 col-lg-12">
        <div class="card">
            <div class="card-status bg-blue"></div>
            <div class="card-header">
                <div class="col-sm-12 col-md-2 col-lg-2">
                    <div class="form-group">
                        <select id="sms_email_template" class="form-select select2 mb-4">
                        </select>
                    </div>
                </div>
                <div class="col-sm-12 col-md-2 col-lg-2">
                    <div class="form-group">
                        <textarea id="sms_email_template_msg" class="form-control mb-4" placeholder="Enter custom message" rows="1"></textarea>
                    </div>
                </div>
                <div class="col-sm-12 col-md-4 col-lg-4">
                    <div class="form-group">
                        <button class="btn btn-green" type="button" id="btnWhatsapp" style="display:none;">
                            <i class="fa fa-whatsapp"></i>
                            <span data-lang-key="send-whatsup">Send Whatsapp</span>
                        </button>
                        <button class="btn btn-indigo" type="button" id="btnSMS" style="display:none;">
                            <i class="fa fa-comment"></i>
                            <span data-lang-key="seng-sms">Send SMS</span>
                        </button>
                        <button class="btn btn-primary" type="button" id="btnSMS_AR" style="display:none;">
                            <i class="fa fa-comment-o"></i> رسالة قصيرة
                        </button>
                        <button class="btn btn-info" type="button" id="btnEmail" style="display:none;">
                            <i class="fa fa-envelope"></i>
                            <span data-lang-key="send-email">Send Email</span>
                        </button>
                    </div>
                </div>
                <div class="col-sm-12 col-md-3 col-lg-3">
                    <div class="form-group">
                        <select id="bulk_status" class="form-select select2 mb-4">
                            <option value=""><span data-lang-key="select-any-status">Select Any Status</span></option>
                            <option value="New"><span data-lang-key="new">New</span></option>
                            <option value="Repeat"><span data-lang-key="repeat">Repeat</span></option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-12 col-md-1 col-lg-1">
                    <div class="form-group">
                        <button class="btn btn-primary" type="button" id="btnUpdateStatus">
                            <span data-lang-key="update">Update</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="progress-loader" style="display:none;">
                    <div class="progress progress-sm mb-3">
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-teal progress-bar-indeterminate"></div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="dtTable" class="table table-striped table-bordered text-nowrap resize-table" style="width: 100%; cursor: pointer;">
                        <thead>
                            <tr style="color: #fff !important; background-color: #3C457D; border-color: #3C457D; ">
                                <th class="border-bottom-0 font-weight-semibold text-white text-center"></th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center"></th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    <span data-lang-key="photo">Photo</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    <span data-lang-key="id">ID</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    <span data-lang-key="mrn">MRN</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white">
                                    <span data-lang-key="name">Name</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white">
                                    <span data-lang-key="dob-gender">DOB/Gender</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white">
                                    <span data-lang-key="nationality">Nationality</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white">
                                    <span data-lang-key="mobile/email">Mobile/Email</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white">EMID</th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    <span data-lang-key="status">Status</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center"><i class="fe fe-more-vertical" style="font-size: 20px;"></i></th>
                                <th class="border-bottom-0 font-weight-semibold text-white">EMID</th><!-- 12 -->
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    <span data-lang-key="mobile">Mobile</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    <span data-lang-key="emai">Email</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    <span data-lang-key="dob">DOB</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    v
                                    <span data-lang-key="gender">Gender</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    <span data-lang-key="age">Age</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    <span data-lang-key="class">Class</span>
                                </th>
                                <th class="border-bottom-0 font-weight-semibold text-white text-center">
                                    <span data-lang-key="referrals">Referal</span>
                                </th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal Create Patient -->
<div class="modal fade overflow-auto" id="create_patient_modal" data-bs-backdrop="static" data-bs-keyboard="false" data-modal-from="patient" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" id="size">
        <div class="modal-content" id="create_patient_modal_body">
        </div>
    </div>
</div>
<!-- End Modal merge Patient -->
<!-- Modal Medical Sheet -->
<div class="modal fade overflow-auto" id="med_sheet" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true" data-modal-from="appointment-list">
    <div class="modal-dialog modal-dialog-centered modal-lg" id="sizeAL">
        <div class="modal-content" id="med_sheet_body">
        </div>
    </div>
</div>
<!-- End Modal Medical Sheet -->
<!-- Modal Create Patient -->
<div class="modal fade overflow-auto" id="merge_patient_modal" data-bs-backdrop="static" data-bs-keyboard="false" data-modal-from="patient" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" id="size">
        <div class="modal-content" id="merge_patient_modal_body">
        </div>
    </div>
</div>
<!-- End Modal merge Patient -->
<!-- Modal Allocation Patient -->
<div class="modal fade overflow-auto" id="Allocation_patient_modal" data-bs-backdrop="static" data-bs-keyboard="false" data-modal-from="patient" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" id="size">
        <div class="modal-content" id="Allocation_patient_modal_body">
        </div>
    </div>
</div>
<!-- End Modal Allocation Patient -->
<!-- Modal Edit Patient -->
<div class="modal fade overflow-auto" id="edit_patient_modal" data-bs-backdrop="static" data-bs-keyboard="false" data-modal-from="patient" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg " id="size">
        <div class="modal-content" id="edit_patient_modal_body">
        </div>
    </div>
</div>
<!-- End Modal Edit Patient -->
<!-- Modal Patient Audit Logs -->
<div class="modal fade overflow-auto" id="patient_logs" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true" data-modal-from="patient">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" id="patient_logs_body">
        </div>
    </div>
</div>
<!-- End Modal Patient Audit Logs -->
<!-- Modal Patient Remarks -->
<div class="modal fade overflow-auto" id="patient_remarks" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true" data-modal-from="patient">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" id="patient_remarks_body">
        </div>
    </div>
</div>
<!-- End Modal Patient Remarks -->
<!-- Modal Patient Details -->
<div class="modal fade overflow-auto" id="patient_details" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true" data-modal-from="patient">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" id="patient_details_body">
        </div>
    </div>
</div>
<!-- End Modal Patient Details -->
<!-- Modal Appointment Audit Logs -->
<div class="modal fade overflow-auto" id="app_logs" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true" data-modal-from="patient-detail-view">
    <div class="modal-dialog modal-dialog-centered modal-lg" id="sizeAL">
        <div class="modal-content" id="app_logs_body">
        </div>
    </div>
</div>
<!-- End Modal Appointment Audit Logs -->
<!-- Modal Documents -->
<div class="modal fade overflow-auto" id="patient_documents" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true" data-modal-from="patient">
    <div class="modal-dialog modal-dialog-centered modal-lg" id="sizeAL">
        <div class="modal-content" id="patient_documents_body">
        </div>
    </div>
</div>
<!-- End Modal Documents -->
<!-- Modal View EMID -->
<div class="modal fade" id="view_emid_modal" data-bs-backdrop="static" data-bs-keyboard="false" data-modal-from="patient" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" id="sizeEID">
        <div class="modal-content" id="view_emid_modal_body">
        </div>
    </div>
</div>
<!-- End Modal View EMID-->
<!-- Modal Patient Packages -->
<div class="modal fade overflow-auto" id="patient_packages" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true" data-modal-from="patient">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" id="patient_packages_body">
        </div>
    </div>
</div>
<!-- End Modal Patient Packages -->
@section myScripts{
    <style>
        .modal-lg {
            max-width: 1500px;
        }
    </style>
    <script type="text/javascript">
        //#region Page Load
        $(function () {
            // Focus on select2 Dropdown
            $(document).on('select2:open', () => {
                document.querySelector('.select2-search__field').focus();
            });

            $('#select_mrn_from').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9]/g))
                    return false;
            });

            $('#select_mrn_to').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9]/g))
                    return false;
            });

            $('#select_date_from_reg').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;
                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });

            $('#select_date_to_reg').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;
                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });

            $('#select_date_from_dob').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;
                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });

            $('#select_date_to_dob').keypress(function (e) {
                var charCode = (e.which) ? e.which : e.keyCode
                if (String.fromCharCode(charCode).match(/[^0-9./-]/g)) {
                    return false;
                }
                else {
                    if (e.target.value.length >= 18)
                        return false;
                }
            });

            $("body").addClass("app sidebar-mini sidenav-toggled");

            load_items();

            GetPatients(0);
        });
        //#endregion

        //#region Load Filters
        var load_items= function () {
            load_branches();
            load_residential();
            load_nationality();
            load_status();
            load_gender();
            load_marital_status();
            load_patient_class();
            load_referals();

            $('#select_date_from_reg').bootstrapdatepicker({
                format: "dd-MM-yyyy",
                viewMode: "date",
                todayHighlight: true,
                autoclose: true,
                multidate: false,
                multidateSeparator: "-"
            });

            $('#select_date_to_reg').bootstrapdatepicker({
                format: "dd-MM-yyyy",
                viewMode: "date",
                todayHighlight: true,
                autoclose: true,
                multidate: false,
                multidateSeparator: "-"
            });

            $("#select_date_to_reg").bootstrapdatepicker("setDate", "");
            $("#select_date_from_reg").bootstrapdatepicker("setDate", "");

            $('#select_date_from_dob').bootstrapdatepicker({
                format: "dd-MM-yyyy",
                viewMode: "date",
                todayHighlight: true,
                autoclose: true,
                multidate: false,
                multidateSeparator: "-"
            });

            $('#select_date_to_dob').bootstrapdatepicker({
                format: "dd-MM-yyyy",
                viewMode: "date",
                todayHighlight: true,
                autoclose: true,
                multidate: false,
                multidateSeparator: "-"
            });

            $("#select_date_from_dob").bootstrapdatepicker("setDate", "");
            $("#select_date_to_dob").bootstrapdatepicker("setDate", "");

            $("#sms_email_template").select2({
                placeholder: 'Select a Template',
                width: '100%',
                maximumInputLength: 10,
                escapeMarkup: function (markup) {
                    return markup;
                }
            });

            load_templates();

            $("#bulk_status").select2({
                minimumResultsForSearch: -1,
                placeholder: 'Select Status',
                width: '100%'
            });
        };
        //#endregion

        //#region load branches
        var load_branches = function () {
            $('#select_branch').SumoSelect({
                placeholder: 'Select Branch(es)',
                csvDispCount: 3,
                okCancelInMulti: true,
                isClickAwayOk: true,
                search: true,
                searchText: 'Enter here.',
                selectAll: true
            });

            $('#select_branch').html('');
            $('#select_branch')[0].sumo.reload();

            BranchList =@Html.Raw(Json.Encode(@ViewData["BranchList"]));

            $.each(BranchList, function (j) {
                $('#select_branch')[0].sumo.add(BranchList[j]["Value"], BranchList[j]["Text"]);
                //$('#select_branch')[0].sumo.selectItem(BranchList[j]["Value"]);
            });


            $('#select_branch')[0].sumo.reload();
        };
        //#endregion

        //#region load residential types
        var load_residential = function () {
            $('#select_residential_type').SumoSelect({
                placeholder: 'Select Residential Type(s)',
                csvDispCount: 3,
                okCancelInMulti: true,
                isClickAwayOk: true,
                search: true,
                searchText: 'Enter here.',
                selectAll: true
            });

            $('#select_residential_type').html('');
            $('#select_residential_type')[0].sumo.reload();

            $('#select_residential_type')[0].sumo.add("UAE Citizen", "UAE Citizen");
            //$('#select_residential_type')[0].sumo.selectItem("UAE Citizen");

            $('#select_residential_type')[0].sumo.add("Resident", "Resident");
            //$('#select_residential_type')[0].sumo.selectItem("Resident");

            $('#select_residential_type')[0].sumo.add("International Patient", "International Patient");
            //$('#select_residential_type')[0].sumo.selectItem("International Patient");

            $('#select_residential_type')[0].sumo.reload();
        };
        //#endregion

        //#region load nationality
        var load_nationality = function () {
            $('#select_nationality').SumoSelect({
                placeholder: 'Select Nationality(es)',
                csvDispCount: 3,
                okCancelInMulti: true,
                isClickAwayOk: true,
                search: true,
                searchText: 'Enter here.',
                selectAll: true
            });

            $('#select_nationality').html('');
            $('#select_nationality')[0].sumo.reload();

            NationalityList =@Html.Raw(Json.Encode(@ViewData["NationalityList"]));

            $.each(NationalityList, function (j) {
                $('#select_nationality')[0].sumo.add(NationalityList[j]["Value"], NationalityList[j]["Text"]);
                //$('#select_nationality')[0].sumo.selectItem(NationalityList[j]["Value"]);
            });


            $('#select_nationality')[0].sumo.reload();
        };
        //#endregion

        //#region load referals
        var load_referals = function () {
            $('#select_referal').SumoSelect({
                placeholder: 'Select Referral(s)',
                csvDispCount: 3,
                okCancelInMulti: true,
                isClickAwayOk: true,
                search: true,
                searchText: 'Enter here.',
                selectAll: true
            });

            $('#select_referal').html('');
            $('#select_referal')[0].sumo.reload();

            ReferalList =@Html.Raw(Json.Encode(@ViewData["ReferalList"]));

            $.each(ReferalList, function (j) {
                $('#select_referal')[0].sumo.add(ReferalList[j]["Value"], ReferalList[j]["Text"]);
                //$('#select_referal')[0].sumo.selectItem(ReferalList[j]["Value"]);
            });


            $('#select_referal')[0].sumo.reload();
        };
        //#endregion

        //#region load status
        var load_status = function () {
            $('#select_status').SumoSelect({
                placeholder: 'Select Status(es)',
                csvDispCount: 3,
                okCancelInMulti: true,
                isClickAwayOk: true,
                search: true,
                searchText: 'Enter here.',
                selectAll: true
            });

            $('#select_status').html('');
            $('#select_status')[0].sumo.reload();

            $('#select_status')[0].sumo.add("New", "New");
            //$('#select_status')[0].sumo.selectItem("New");

            $('#select_status')[0].sumo.add("Repeat", "Repeat");
            //$('#select_status')[0].sumo.selectItem("Repeat");

            $('#select_status')[0].sumo.add("Deleted", "Deleted");
            //$('#select_status')[0].sumo.selectItem("Deleted");

            $('#select_status')[0].sumo.reload();
        };
        //#endregion

        //#region load Genders
        var load_gender = function () {
            $('#select_gender').SumoSelect({
                placeholder: 'Select Gender(s)',
                csvDispCount: 3,
                okCancelInMulti: true,
                isClickAwayOk: true,
                search: true,
                searchText: 'Enter here.',
                selectAll: true
            });

            $('#select_gender').html('');
            $('#select_gender')[0].sumo.reload();

            $('#select_gender')[0].sumo.add("Male", "Male");
           // $('#select_gender')[0].sumo.selectItem("Male");

            $('#select_gender')[0].sumo.add("Female", "Female");
            //$('#select_gender')[0].sumo.selectItem("Female");

            $('#select_gender')[0].sumo.reload();
        };
        //#endregion

        //#region load marital status
        var load_marital_status = function () {
            $('#select_marital_status').SumoSelect({
                placeholder: 'Select Marital Status(es)',
                csvDispCount: 3,
                okCancelInMulti: true,
                isClickAwayOk: true,
                search: true,
                searchText: 'Enter here.',
                selectAll: true
            });

            $('#select_marital_status').html('');
            $('#select_marital_status')[0].sumo.reload();

            $('#select_marital_status')[0].sumo.add("S", "Single");
           // $('#select_marital_status')[0].sumo.selectItem("S");

            $('#select_marital_status')[0].sumo.add("M", "Married");
           //$('#select_marital_status')[0].sumo.selectItem("M");

            $('#select_marital_status')[0].sumo.add("D", "Divorced");
           // $('#select_marital_status')[0].sumo.selectItem("D");

            $('#select_marital_status')[0].sumo.reload();
        };
        //#endregion

        //#region load patient class
        var load_patient_class = function () {
            $('#select_class').SumoSelect({
                placeholder: 'Select Patient Class(es)',
                csvDispCount: 3,
                okCancelInMulti: true,
                isClickAwayOk: true,
                search: true,
                searchText: 'Enter here.',
                selectAll: true
            });

            $('#select_class').html('');
            $('#select_class')[0].sumo.reload();

            $('#select_class')[0].sumo.add("Normal", "Normal");
            //$('#select_class')[0].sumo.selectItem("Normal");

            $('#select_class')[0].sumo.add("VIP", "VIP");
            //$('#select_class')[0].sumo.selectItem("VIP");

            $('#select_class')[0].sumo.add("Employee Related", "Employee Related");
            //$('#select_class')[0].sumo.selectItem("Employee Related");

            $('#select_class')[0].sumo.add("Management Related", "Management Related");
            //$('#select_class')[0].sumo.selectItem("Management Related");

            $('#select_class')[0].sumo.reload();
        };
        //#endregion

        //#region load templates
        var load_templates = function () {
            $.ajax({
                url: '@Url.Action("GetTemplates", "Patient", new { area = "Patient" })?tempFor=1',
                type: "GET",
                dataType: "json",
                async: false,
                success: function (response) {
                    var newOption = new Option("Select Any Template", 0, false, false);
                    $('#sms_email_template').append(newOption).trigger('change');

                    if (response.length > 0) {
                        $.each(response, function (j) {
                            let text = response[j].TempName;

                            if (response[j].TempWhatsapp == 1) {
                                text += "<i class='fa fa-whatsapp text-green ms-1 font-weight-semibold'></i>";
                            }
                            if (response[j].TempSMS == 1) {
                                text += "<i class='fa fa fa-comment text-indigo ms-1 font-weight-semibold'></i>";
                            }
                            if (response[j].TempEmail == 1) {
                                text += "<i class='fa fa-envelope-o text-info ms-1 font-weight-semibold'></i>";
                            }

                            var newOption = new Option(text, response[j].TemplateId, false, false);
                            $('#sms_email_template').append(newOption).trigger('change');
                        });
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });
        };
        //#endregion

        //#region select templates
        $('#sms_email_template').on('select2:select', function() {
            $.ajax({
                url: '@Url.Action("GetTemplates", "Patient", new { area = "Patient" })?tempFor=1&templateId=' + $('#sms_email_template').val(),
                type: "GET",
                dataType: "json",
                async: false,
                success: function (response) {
                    if (response.length > 0) {
                        if (response[0].TempWhatsapp == 1) {
                            $("#btnWhatsapp").show();
                        }
                        else {
                            $("#btnWhatsapp").hide();
                        }

                        if (response[0].TempSMS == 1) {
                            $("#btnSMS").show();
                            $("#btnSMS_AR").show();
                        }
                        else {
                            $("#btnSMS").hide();
                            $("#btnSMS_AR").hide();
                        }

                        if (response[0].TempEmail == 1) {
                            $("#btnEmail").show();
                        }
                        else {
                            $("#btnEmail").hide();
                        }

                        $('#sms_email_template_msg').val(response[0].TempContent);
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });
        });
        //#endregion

        //#region Load Patients
        var GetPatients = function (mode) {

            var _data = {
                "branch_ids": $('#select_branch').val().toString(),
                "residential_types": $('#select_residential_type').val().toString(),
                "account_types": "",
                "mrn_from": $('#select_mrn_from').val(),
                "mrn_to": $('#select_mrn_to').val(),
                "nationalities": $('#select_nationality').val().toString(),
                "reg_from": $('#select_date_from_reg').val(),
                "reg_to": $('#select_date_to_reg').val(),
                "dob_from": $('#select_date_from_dob').val(),
                "dob_to": $('#select_date_to_dob').val(),
                "pat_status": $('#select_status').val().toString(),
                "pat_gender": $('#select_gender').val().toString(),
                "pat_ms": $('#select_marital_status').val().toString(),
                "pat_class": $('#select_class').val().toString(),
                "pat_referals": $('#select_referal').val().toString(),
                "pat_info": $('#select_patient').val().toString(),
                "mode": mode
            }

            $.ajax({
                type: "GET",
                url: "@Url.Action("GetPatients", "Patient", new { area = "Patient" })",
                dataType: 'json',
                data: _data,
                beforeSend: function () {
                    $('#progress-loader').show();
                },
                success: function (data) {
                    $('#progress-loader').hide();

                    var table;
                    if ($.fn.dataTable.isDataTable('#dtTable')) {
                        table = $('#dtTable').DataTable();
                        table.clear();
                        table.rows.add(data.message).draw();
                    }
                    else {
                        BindDataTable(data.message);
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                    $('#progress-loader').hide();
                }
            })
        }
        //#endregion

        //#region Search Patients
        $("#btnSearch").click(function (e) {
            e.preventDefault();
            if (($("#select_branch").val() != null && $("#select_branch").val() != 0 && $("#select_branch").val() != "" && $("#select_branch").val() != undefined) ||
                ($("#select_residential_type").val() != null && $("#select_residential_type").val() != 0 && $("#select_residential_type").val() != "" && $("#select_residential_type").val() != undefined) ||
                ($("#select_nationality").val() != null && $("#select_nationality").val() != 0 && $("#select_nationality").val() != "" && $("#select_nationality").val() != undefined) ||
                ($("#select_mrn_from").val() != null && $("#select_mrn_from").val() != 0 && $("#select_mrn_from").val() != "" && $("#select_mrn_from").val() != undefined) ||
                ($("#select_mrn_to").val() != null && $("#select_mrn_to").val() != 0 && $("#select_mrn_to").val() != "" && $("#select_mrn_to").val() != undefined) ||
                ($("#select_class").val() != null && $("#select_class").val() != 0 && $("#select_class").val() != "" && $("#select_class").val() != undefined) ||
                ($("#select_date_from_reg").val() != null && $("#select_date_from_reg").val() != 0 && $("#select_date_from_reg").val() != "" && $("#select_date_from_reg").val() != undefined) ||
                ($("#select_date_to_reg").val() != null && $("#select_date_to_reg").val() != 0 && $("#select_date_to_reg").val() != "" && $("#select_date_to_reg").val() != undefined) ||
                ($("#select_date_from_dob").val() != null && $("#select_date_from_dob").val() != 0 && $("#select_date_from_dob").val() != "" && $("#select_date_from_dob").val() != undefined) ||
                ($("#select_date_to_dob").val() != null && $("#select_date_to_dob").val() != 0 && $("#select_date_to_dob").val() != "" && $("#select_date_to_dob").val() != undefined) ||
                ($("#select_status").val() != null && $("#select_status").val() != 0 && $("#select_status").val() != "" && $("#select_status").val() != undefined) ||
                ($("#select_gender").val() != null && $("#select_gender").val() != 0 && $("#select_gender").val() != "" && $("#select_gender").val() != undefined) ||
                ($("#select_marital_status").val() != null && $("#select_marital_status").val() != 0 && $("#select_marital_status").val() != "" && $("#select_marital_status").val() != undefined) ||
                ($("#select_referal").val() != null && $("#select_referal").val() != 0 && $("#select_referal").val() != "" && $("#select_referal").val() != undefined) ||
                ($("#select_patient").val() != null && $("#select_patient").val() != 0 && $("#select_patient").val() != "" && $("#select_patient").val() != undefined)) {

                let isValid = true;

                let reg_frm = moment($("#select_date_from_reg").val(), "DD-MMMM-YYYY");
                let reg_to = moment($("#select_date_to_reg").val(), "DD-MMMM-YYYY");

                // Check if Date From is a valid Date
                if ($("#select_date_from_reg").val() != null && $("#select_date_from_reg").val() != 0 && $("#select_date_from_reg").val() != "" && $("#select_date_from_reg").val() != undefined) {
                    if (!reg_frm.isValid()) {
                        isValid = false;
                        e.stopPropagation();
                        return $.growl.error({
                            title: "Error",
                            message: "Invalid Date Selection for Registered From"
                        });
                    }
                }

                // Check if Date To is a valid Date
                if ($("#select_date_to_reg").val() != null && $("#select_date_to_reg").val() != 0 && $("#select_date_to_reg").val() != "" && $("#select_date_to_reg").val() != undefined) {
                    if (!reg_to.isValid()) {
                        isValid = false;
                        e.stopPropagation();
                        return $.growl.error({
                            title: "Error",
                            message: "Invalid Date Selection for Registered To"
                        });
                    }
                }
                // Check if Date Range is valid
                if (($("#select_date_from_reg").val() != null && $("#select_date_from_reg").val() != 0 && $("#select_date_from_reg").val() != "" && $("#select_date_from_reg").val() != undefined) &&
                    ($("#select_date_to_reg").val() != null && $("#select_date_to_reg").val() != 0 && $("#select_date_to_reg").val() != "" && $("#select_date_to_reg").val() != undefined)) {
                    if (reg_frm.isValid() && reg_to.isValid()) {
                        if (reg_to.diff(reg_frm, 'days') <= 0) {
                            isValid = false;

                            var index = [];
                            index.push("select_date_from_reg");
                            index.push("select_date_to_reg");

                            $.each(index, function (i, v) {
                                if (index[i] != null && index[i] != "") {
                                    var elem = $("#" + index[i]);
                                    console.log($("#" + index[i]));
                                    if (elem.hasClass("select2-hidden-accessible")) {
                                        $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                                    }
                                    else {
                                        $(elem).addClass(" is-invalid");
                                    }

                                    setTimeout(function () {
                                        if (elem.hasClass("select2-hidden-accessible")) {
                                            $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                        }
                                        else {
                                            $(elem).removeClass("is-invalid");
                                        }
                                    }, 5000);
                                }
                            });

                            e.stopPropagation();
                            return $.growl.error({
                                title: "Error",
                                message: "Registered From Date should be less than To Date!"
                            });
                        }
                    }
                }

                let dob_frm = moment($("#select_date_from_dob").val());
                let dob_to = moment($("#select_date_to_dob").val());

                // Check if Date From is a valid Date
                if ($("#select_date_from_dob").val() != null && $("#select_date_from_dob").val() != 0 && $("#select_date_from_dob").val() != "" && $("#select_date_from_dob").val() != undefined) {
                    if (!dob_frm.isValid()) {
                        isValid = false;
                        e.stopPropagation();
                        return $.growl.error({
                            title: "Error",
                            message: "Invalid Date Selection for DOB From"
                        });
                    }
                }
                // Check if Date To is a valid Date
                if ($("#select_date_to_dob").val() != null && $("#select_date_to_dob").val() != 0 && $("#select_date_to_dob").val() != "" && $("#select_date_to_dob").val() != undefined) {
                    if (!dob_to.isValid()) {
                        isValid = false;
                        e.stopPropagation();
                        return $.growl.error({
                            title: "Error",
                            message: "Invalid Date Selection for DOB To"
                        });
                    }
                }
                // Check if Date Range is valid
                if (($("#select_date_from_dob").val() != null && $("#select_date_from_dob").val() != 0 && $("#select_date_from_dob").val() != "" && $("#select_date_from_dob").val() != undefined) &&
                    ($("#select_date_to_dob").val() != null && $("#select_date_to_dob").val() != 0 && $("#select_date_to_dob").val() != "" && $("#select_date_to_dob").val() != undefined)) {
                    if (dob_frm.isValid() && dob_to.isValid()) {
                        if (dob_to.diff(dob_frm, 'days') <= 0) {
                            isValid = false;

                            var index = [];
                            index.push("select_date_from_dob");
                            index.push("select_date_to_dob");

                            $.each(index, function (i, v) {
                                if (index[i] != null && index[i] != "") {
                                    var elem = $("#" + index[i]);
                                    console.log($("#" + index[i]));
                                    if (elem.hasClass("select2-hidden-accessible")) {
                                        $("#select2-" + elem.attr("id") + "-container").parent().addClass('error');
                                    }
                                    else {
                                        $(elem).addClass(" is-invalid");
                                    }

                                    setTimeout(function () {
                                        if (elem.hasClass("select2-hidden-accessible")) {
                                            $("#select2-" + elem.attr("id") + "-container").parent().removeClass('error');
                                        }
                                        else {
                                            $(elem).removeClass("is-invalid");
                                        }
                                    }, 5000);
                                }
                            });

                            e.stopPropagation();
                            return $.growl.error({
                                title: "Error!",
                                message: "DOB From Date Filter should be less than To Date Filter!"
                            });
                        }
                    }
                }

                if (isValid) {
                    GetPatients(1);
                }
            }
            else {
                Swal.fire({
                    title: "Attention!",
                    text: "Search by Either of the following filters : Patient / Branch / Residential Type / Nationality / MRN / Class / Registered Date / DOB / Status / Gender / Marital Status / Referal",
                    icon: "warning",
                    showCancelButton: 0,
                    confirmButtonColor: "#0bb197", cancelButtonColor: "#ff3d60"
                });
            }
        });
        //#endregion

        //#region Bind DataTable
        var BindDataTable = function (response) {
            var table = $("#dtTable").DataTable({
                processing: true,
                //"deferRender": true,
                "pageLength": 100,
                "retrieve": true,
                lengthChange: true,
                "aaData": response,
                "aoColumns": [
                    { "mData": "patId" },
                    {
                        className: 'dt-control  pt-4',
                        orderable: false,
                        data: null,
                        defaultContent: '<span class="fs-15 text-success font-weight-bold spn-control"><i class="fa fa-plus-circle"></i></span>'
                    },
                    { "mData": "pat_photo" },
                    { "mData": "patId" },
                    { "mData": "pat_code" },
                    { "mData": "pat_name_arb" },
                    { "mData": "pat_dob" },
                    { "mData": "nationality" },
                    { "mData": "pat_mob" },
                    { "mData": "pat_emirateid" },
                    { "mData": "pat_status" },
                    { "mData": "patId" },
                    //#region Hidden Export Columns
                    { "mData": "pat_emirateid" },
                    { "mData": "pat_mob" },
                    { "mData": "pat_email" },
                    { "mData": "pat_dob" },
                    { "mData": "pat_gender" },
                    { "mData": "pat_age" },
                    { "mData": "pat_class" },
                    { "mData": "ref_name" }
                    //#endregion
                ],
                "aoColumnDefs": [
                    {
                        "aTargets": [0],
                        "orderable": false,
                        "searchable": false,
                        "className": "select-checkbox text-center",
                        'checkboxes': {
                            'selectRow': true
                        }
                    },
                    {
                        "aTargets": [2],
                        "orderable": false,
                        "searchable": false,
                        "className": "text-center",
                        "render": function (data) {
                            return '<div class="d-flex p-1 justify-content-center">' +
                                '<img class="avatar avatar-lg brround text-center" src="' + data + '">	</img>' +
                                '</div>';
                        }
                    },
                    {
                        "aTargets": [3],
                        "orderable": false,
                        "searchable": false,
                        "visible": false,
                        "className": "text-center",
                        "render": function (data) {
                            return '<div class="tag tag-indigo">' + data +  '</div>';
                        }
                    },
                    {
                        "aTargets": [4],
                        "className": "text-center",
                        "render": function (data) {
                            return '<div class="tag tag-danger">'+ data + '</div>';
                        }
                    },
                    {
                        "aTargets": [5],
                        "className": "text-start font-weight-semibold",
                        "render": function (data, type, full, meta) {
                            var pat_class = full.pat_class;

                            var _html = '<a href="javascript:void(0)" class="text-black" onclick="detailPatient('+full.patId+')">'+ data +'</a>';

                            if (pat_class == 'VIP') {
                                _html += '&nbsp;<span title="VIP Patient"><i class="fa fa-star text-orange"></i></span>';
                            }
                            else if (pat_class == 'Employee Related') {
                                _html += '&nbsp;<span title="This Patient is related with Employee"><i class="fa fa-street-view text-info"></i></span>';
                            }
                            else if (pat_class == 'Management Related') {
                                _html += '&nbsp;<span title="This Patient is related with Management"><i class="fa fa-handshake-o text-primary"></i></span>';
                            }
                            else {
                                _html += '&nbsp;<i class="fa-regular fa-crown"></i>';
                            }

                            return _html;
                        }
                    },
                    {
                        "aTargets": [6],
                        "className": "text-start",
                        "render": function (data, type, full, meta) {
                            var pat_age = full.pat_age;
                            var pat_gender = full.pat_gender;

                            var html = moment(data, "M/D/YYYY h:mm:ss A").format("DD-MMMM-YYYY") +
                                '<br/><div class="tag tag-info mt-1">' +
                                pat_age + ' Y/s' +
                                '<span class="tag-addon"><i class="fa fa-clock-o"></i></span>' +
                                '</div>';

                            if (pat_gender == "Female") {
                                html += '<div class="tag tag-primary ms-1"> Female ' +
                                    '<span class="tag-addon"><i class="fa fa-female"></i></span>' +
                                    '</div>';
                            }
                            else {
                                html += '<div class="tag tag-primary ms-1"> Male ' +
                                    '<span class="tag-addon"><i class="fa fa-male"></i></span>' +
                                    '</div>';
                            }

                            return html;
                        }
                    },
                    {
                        "aTargets": [7],
                        "className": "text-start"
                    },
                    {
                        "aTargets": [8],
                        "orderable": false,
                        "className": "text-start",
                        "render": function (data, type, full, meta) {
                            var pat_mob = data;
                            var pat_email = full.pat_email;

                            var html = '';

                            if (data != "" && data != null && data != undefined) {
                                html += '<div class="tag tag-success"><a style="color:white;" href="https://api.whatsapp.com/send?phone='+ data +'" >' +
                                    data +
                                    '<span class="tag-addon"><i class="fa fa-whatsapp"></i></span></a>' +
                                    '</div>';

                                if (pat_email != "" && pat_email != null && pat_email != undefined) {
                                    html += '<br/><div class="tag tag-info mt-1"><a style="color:white;" href = "mailto:' + pat_email +'">' +
                                        pat_email +
                                        '<span class="tag-addon"><i class="fa fa-envelope-o"></i></span></a>' +
                                        '</div>';
                                }
                            }
                            else {
                                if (pat_email != "" && pat_email != null && pat_email != undefined) {
                                    html += '<div class="tag tag-info"><a style="color:white;" href = "mailto:' + pat_email +'">' +
                                        pat_email +
                                        '<span class="tag-addon"><i class="fa fa-envelope-o"></i></span></a>' +
                                        '</div>';
                                }
                            }

                            return html;
                        }
                    },
                    {
                        "aTargets": [9],
                        "className": "text-start",
                        "render": function (data, type, full, meta) {
                            var id_fcard = full.id_card_front;
                            var id_bcard = full.id_card_back;

                            if (id_fcard != null && id_fcard != "" && id_fcard != undefined) {
                                id_fcard = ' <a onclick="view_emid(' + full.patId + ')"><i class="fa fa-info-circle text-info"></i></a>';
                                id_bcard = '';
                            }
                            else if (id_bcard != null && id_bcard != "" && id_bcard != undefined) {
                                id_fcard = '';
                                id_bcard = ' <a onclick="view_emid(' + full.patId + ')"><i class="fa fa-info-circle text-info"></i></a>';
                            }

                            var html = "";

                            if (data != null && data != "" && data != undefined) {
                                let id_card_edate = moment(full.id_card_edate);
                                if (id_card_edate.isValid()) {
                                    let today = moment();

                                    if (id_card_edate.diff(today, 'days') <= 0) {
                                        html = '<div class="text-center text-danger">' + data + id_fcard + id_bcard+'<br/>' +
                                            '<span class="badge bg-danger-light border-danger fs-11">Expired (Exp: ' + moment(id_card_edate).format("DD-MMMM-YYYY") + ') </span>' +
                                            '</div>';
                                    }
                                    else {
                                        html = '<div class="text-center">' + data + id_fcard + '<br/>' +
                                            '<span class="badge bg-success-light border-success fs-11">Active (Exp: ' + moment(id_card_edate).format("DD-MMMM-YYYY") + ') </span>' +
                                            '</div>';
                                    }
                                }
                            }
                            else {
                                html = '<div class="text-center"><span class="text-muted">999-9999-9999999-9</span></div>';
                            }

                            return html;
                        }
                    },
                    {
                        "aTargets": [10],
                        "className": 'text-center',
                        "render": function (data, type, full, meta) {
                            var visible = full.actionvisible;
                            var pat_status = full.pat_status;
                            if (pat_status === "New") {
                                    return '<button type="button" class="badge rounded-pill bg-success mt-2 border-success" style="width: 60px;"> New </button>'
                            }
                            else if (pat_status === "Repeat") {
                                    return '<button type="button" class="badge rounded-pill bg-warning mt-2 border-warning" style="width: 60px;">Repeat</button>'
                            }
                            else if (pat_status === "Deleted") {
                                    return '<button type="button" class="badge rounded-pill bg-danger mt-2 border-danger" style="width: 60px;">Deleted</button>'
                            }
                            else {
                                return ''
                            }
                        }
                    },
                    {
                        "aTargets": [11],
                        "className": "text-center",
                        "orderable": false,
                        "searchable": false,
                        "render": function (data, type, full, meta) {
                            var status = full.pat_status;
                            var visible = full.actionvisible;
                            var patId = full.patId;

                            var html_links = '<div class="dropdown"><a type="button" class="" data-bs-toggle="dropdown"><i class="fe fe-more-vertical" style="font-size: 20px;"></i></a>' +
                                '<div class="dropdown-menu" style="min-width:auto">' +
                                '<a class="dropdown-item text-black fw-bold" href="javascript:void(0)" onclick="detailPatient(' + patId + ',\'' + full.pat_name + '\')"><i class="fa fa-info-circle text-black" style="font-size: 15px;margin-right: 0.5rem;"></i>&nbsp;Details</a>';

                            if (status != "Deleted") {
                                html_links +=
                                    '<a class="dropdown-item text-black fw-bold" href="javascript:void(0)" onclick="editPatient(' + patId +')"><i class="fe fe-edit-2 text-success" style="font-size: 15px;margin-right: 0.5rem;"></i>&nbsp;Edit</a>';

                                if (visible != "False") {
                                    html_links += '<a class="dropdown-item text-black fw-bold" href="javascript:void(0)" onclick="deletePatient(' + patId +')"><i class="fe fe-trash text-danger" style="font-size: 15px;margin-right: 0.5rem;"></i>&nbsp;Delete</a>';
                                }
                            }

                            html_links += '<a class="dropdown-item text-black fw-bold" href="javascript:void(0)" onclick="patientAuditLog(' + patId + ',\'' + full.pat_name + '\')"><i class="fa fa-eye text-black" style="font-size: 15px;margin-right: 0.5rem;color:#046058 !important;"></i>&nbsp;Log</a>' +
                                '<a class="dropdown-item text-black fw-bold" href="javascript:void(0)" onclick="patientRemarks(' + patId + ')"><i class="fa fa-comments-o text-black" style="font-size: 15px;margin-right: 0.5rem;"></i>&nbsp;Remarks</a>' +
                                '<a class="dropdown-item text-black fw-bold" href="javascript:void(0)" onclick="patientPackages(' + patId + ')"><i class="fa fa-cubes text-black" style="font-size: 15px;margin-right: 0.5rem;"></i>&nbsp;Packages</a>' +
                                '<a class="dropdown-item text-black fw-bold" href="javascript:void(0)" onclick="documentsPatient(' + patId + ',\'' + full.pat_name + '\')"><i class="fa fa-folder-open-o text-black" style="font-size: 15px;margin-right: 0.5rem;"></i>&nbsp;Documents</a>' +
                                '</div>' +
                                '</div>';

                            return html_links;
                        }
                    },
                    {
                        "aTargets": [12],
                        "visible": false,
                    },
                    {
                        "aTargets": [13],
                        "visible": false,
                    },
                    {
                        "aTargets": [14],
                        "visible": false,
                    },
                    {
                        "aTargets": [15],
                        "visible": false,
                    },
                    {
                        "aTargets": [16],
                        "visible": false,
                    },
                    {
                        "aTargets": [17],
                        "visible": false,
                    },
                    {
                        "aTargets": [18],
                        "visible": false,
                    },
                    {
                        "aTargets": [19],
                        "visible": false
                    }
                ],
                select: {
                    style: 'multi',
                    selector: 'td:first-child'
                },
                order: [[3, 'desc']],
                language: {
                    searchPlaceholder: 'Search...',
                    sSearch: '<span class="text-primary font-weight-semi-bold">Search By Name / MRN / Mobile / EMID</span>',
                    lengthMenu: '_MENU_',
                },
                scrollX: true,
                scrollY: 500,
                scrollCollapse: true,
                fixedColumns: true,
                fixedHeader: {
                    header: true,
                    footer: true
                },
                buttons: [
                    {
                        extend: 'excel',
                        title: 'Patients Information',
                        footer: 'true',
                        exportOptions: {
                            columns: [3, 4, 5, 7, 12, 13, 14, 15, 16, 17, 18, 19]
                        },
                        action: function (e, dt, node, config) {
                            $.fn.dataTable.ext.buttons.excelHtml5.action.call(this, e, dt, node, config);
                            exportLogs("Employee Exported Patients to Excel!");
                        }
                    },
                    {
                        extend: 'pdf',
                        title: 'Patients Information',
                        footer: 'true',
                        exportOptions: {
                            columns: [3, 4, 5, 7, 12, 13, 14, 15, 16, 17, 18, 19]
                        },
                        action: function (e, dt, node, config) {
                            $.fn.dataTable.ext.buttons.pdfHtml5.action.call(this, e, dt, node, config);
                            exportLogs("Employee Exported Patients to PDF!");
                        }
                    },
                    {
                        extend: 'csv',
                        title: 'Patients Information',
                        footer: 'true',
                        exportOptions: {
                            columns: [3, 4, 5, 7, 12, 13, 14, 15, 16, 17, 18, 19]
                        },
                        action: function (e, dt, node, config) {
                            $.fn.dataTable.ext.buttons.csvHtml5.action.call(this, e, dt, node, config);
                            exportLogs("Employee Exported Patients to CSV!");
                        }
                    },
                    {
                        extend: 'print',
                        title: 'Patients Information',
                        footer: 'true',
                        exportOptions: {
                            columns: [3, 4, 5, 7, 12, 13, 14, 15, 16, 17, 18, 19]
                        },
                        action: function (e, dt, node, config) {
                            $.fn.dataTable.ext.buttons.print.action.call(this, e, dt, node, config);
                            exportLogs("Employee Printed Patients!");
                        }
                    }
                ]
            });
            table.buttons().container().appendTo('#dtTable_wrapper .col-md-6:eq(0)');

            // Add event listener for opening and closing details
            table.on('click', 'td.dt-control', function () {
                var tr = $(this).closest('tr');
                var row = table.row(tr);
                var _span = tr.find('.spn-control');
                if (row.child.isShown()) {
                    $(_span).removeClass('text-danger');
                    $(_span).addClass('text-success');
                    $(_span).html('<i class="fa fa-plus-circle"></i>');
                    row.child.hide();
                    tr.removeClass('shown');

                    localStorage.removeItem("patId");
                    localStorage.removeItem("pat_info");
                } else {

                    $(_span).removeClass('text-success');
                    $(_span).addClass('text-danger');
                    $(_span).html('<i class="fa fa-minus-circle"></i>');

                    var _data = table.row(this).data();
                    localStorage.setItem("patId", _data.patId);
                    localStorage.setItem("pat_info", _data.pat_name + "(" + _data.pat_code + ")");

                    $.ajax({
                        type: "GET",
                        url: '@Url.Action("GetPatientInsurancesById", "PatientInsurance", new { area = "Patient" })?patId=' + _data.patId,
                        contentType: "application/json",
                        dataType: "html",
                        success: function (response) {
                            //var _tableData = ($(response).find('#dtTable2').html());
                            row.child(response).show();
                            //row.child(format(_tableData)).show();
                            tr.addClass('shown');
                        },
                        failure: function (response) {
                            alert(response.responseText);
                        },
                        error: function (response) {
                            alert(response.responseText);
                        }
                    });

                }
            });
       }
        //#endregion

        //#region Send SMS / E-Mail / WhatsApp
        $("#btnWhatsapp").click(function (event) {
            if ($("#sms_email_template_msg").val() != null && $("#sms_email_template_msg").val() != 0 && $("#sms_email_template_msg").val() != "" && $("#sms_email_template_msg").val() != undefined) {
                var table = $("#dtTable").DataTable();
                var rows = $(table.$('input[type="checkbox"]').map(function () {
                    return $(this).prop("checked") ? $(this).closest('tr') : null;
                }));

                $.each(rows, function (index, rowId) {
                    var _data = table.row(rowId).data();

                    var _obj = {
                        "branchId": _data.pat_referal,
                        "mobile": _data.pat_mob,
                        "user": _data.patId,
                        "content": $("#sms_email_template_msg").val()
                    }

                    $.ajax({
                        url: '@Url.Action("WhatsappConfig", "Patient", new { area = "Patient" })',
                        type: "POST",
                        dataType: "json",
                        data: _obj,
                        async: false,
                        success: function (response) {
                            if (response.isSuccess == true) {
                                if (response.data["status"] == "success") {
                                    event.preventDefault();
                                    event.stopPropagation();
                                    return $.growl.notice({
                                        title: "Success",
                                        message: response.message
                                    });
                                }
                                else {
                                    event.preventDefault();
                                    event.stopPropagation();
                                    return $.growl.warning({
                                        title: "Pending",
                                        message: response.message
                                    });
                                }
                            }
                            else {
                                event.preventDefault();
                                event.stopPropagation();
                                return $.growl.error({
                                    title: "Error",
                                    message: response.message
                                });
                            }
                        },
                        error: function (xhr) {
                            console.log(xhr);
                        }
                    })
                });

                $('#sms_email_template').val(0).trigger('change');
                $("#sms_email_template_msg").val("");
            }
            else {
                Swal.fire({
                    title: "Attention!",
                    text: "Please select Template or enter message to send patient",
                    icon: "warning",
                    showCancelButton: 0,
                    confirmButtonColor: "#0bb197", cancelButtonColor: "#ff3d60"
                });
            }
        });

        $("#btnSMS").click(function (event) {
            if ($("#sms_email_template_msg").val() != null && $("#sms_email_template_msg").val() != 0 && $("#sms_email_template_msg").val() != "" && $("#sms_email_template_msg").val() != undefined) {
                var table = $("#dtTable").DataTable();
                var rows = $(table.$('input[type="checkbox"]').map(function () {
                    return $(this).prop("checked") ? $(this).closest('tr') : null;
                }));

                $.each(rows, function (index, rowId) {
                    var _data = table.row(rowId).data();

                    var _obj = {
                        "branchId": _data.pat_referal,
                        "mobile": _data.pat_mob,
                        "user": _data.patId,
                        "content": $("#sms_email_template_msg").val()
                    }

                    $.ajax({
                        url: '@Url.Action("SMSConfig", "Patient", new { area = "Patient" })',
                        type: "POST",
                        dataType: "json",
                        data: _obj,
                        async: false,
                        success: function (response) {


                            if (response.isSuccess == true) {
                                event.preventDefault();
                                event.stopPropagation();
                                return $.growl.notice({
                                    title: "Success",
                                    message: response.message
                                });
                            }
                            else {
                                event.preventDefault();
                                event.stopPropagation();
                                return $.growl.error({
                                    title: "Error",
                                    message: response.message
                                });
                            }

                        },
                        error: function (xhr) {
                            console.log(xhr);
                        }
                    });
                });

                $('#sms_email_template').val(0);
                $("#sms_email_template_msg").val("");
            }
            else {
                Swal.fire({
                    title: "Attention!",
                    text: "Please select Template or enter message to send patient",
                    icon: "warning",
                    showCancelButton: 0,
                    confirmButtonColor: "#0bb197", cancelButtonColor: "#ff3d60"
                });
            }


        });

        $("#btnSMS_AR").click(function (event) {
            if ($("#sms_email_template_msg").val() != null && $("#sms_email_template_msg").val() != 0 && $("#sms_email_template_msg").val() != "" && $("#sms_email_template_msg").val() != undefined) {
                var table = $("#dtTable").DataTable();
                var rows = $(table.$('input[type="checkbox"]').map(function () {
                    return $(this).prop("checked") ? $(this).closest('tr') : null;
                }));

                $.each(rows, function (index, rowId) {
                    var _data = table.row(rowId).data();

                    var _obj = {
                        "branchId": _data.pat_referal,
                        "mobile": _data.pat_mob,
                        "user": _data.patId,
                        "content": $("#sms_email_template_msg").val()
                    }

                    $.ajax({
                        url: '@Url.Action("SMSConfig_AR", "Patient", new { area = "Patient" })',
                        type: "POST",
                        dataType: "json",
                        data: _obj,
                        async: false,
                        success: function (response) {


                            if (response.isSuccess == true) {
                                event.preventDefault();
                                event.stopPropagation();
                                return $.growl.notice({
                                    title: "Success",
                                    message: response.message
                                });
                            }
                            else {
                                event.preventDefault();
                                event.stopPropagation();
                                return $.growl.error({
                                    title: "Error",
                                    message: response.message
                                });
                            }

                        },
                        error: function (xhr) {
                            console.log(xhr);
                        }
                    });
                });

                $('#sms_email_template').val(0);
                $("#sms_email_template_msg").val("");
            }
            else {
                Swal.fire({
                    title: "Attention!",
                    text: "Please select Template or enter message to send patient",
                    icon: "warning",
                    showCancelButton: 0,
                    confirmButtonColor: "#0bb197", cancelButtonColor: "#ff3d60"
                });
            }



        });

        $("#btnEmail").click(function (event) {
            if ($("#sms_email_template_msg").val() != null && $("#sms_email_template_msg").val() != 0 && $("#sms_email_template_msg").val() != "" && $("#sms_email_template_msg").val() != undefined) {
                var table = $("#dtTable").DataTable();
                var rows = $(table.$('input[type="checkbox"]').map(function () {
                    return $(this).prop("checked") ? $(this).closest('tr') : null;
                }));

                $.each(rows, function (index, rowId) {
                    var _data = table.row(rowId).data();

                    if (!(_data.pat_email == undefined || _data.pat_email == null || _data.pat_email == "")) {
                            var _obj = {
                                "branchId": _data.pat_referal,
                                "email": _data.pat_email,
                                "user": _data.patId,
                                "content": $("#sms_email_template_msg").val(),
                                "templateId": parseInt($("#sms_email_template").val())
                            }

                            $.ajax({
                                url: '@Url.Action("EmailConfig", "Patient", new { area = "Patient" })',
                                type: "POST",
                                dataType: "json",
                                data: _obj,
                                async: false,
                                success: function (response) {
                                    if (response.isSuccess == true) {
                                        event.preventDefault();
                                        event.stopPropagation();
                                        return $.growl.notice({
                                            title: "Success",
                                            message: response.message
                                        });
                                    }
                                    else {
                                        event.preventDefault();
                                        event.stopPropagation();
                                        return $.growl.error({
                                            title: "Error",
                                            message: response.message
                                        });
                                    }

                                },
                                error: function (xhr) {
                                    console.log(xhr);
                                }
                            });
                        }
                        else {
                            console.log("Invalid email address :" + _data.pat_email);
                        }
                });

                $('#sms_email_template').val(0);
                $("#sms_email_template_msg").val("");
            }
            else {
                Swal.fire({
                    title: "Attention!",
                    text: "Please select Template or enter message to send patient",
                    icon: "warning",
                    showCancelButton: 0,
                    confirmButtonColor: "#0bb197", cancelButtonColor: "#ff3d60"
                });
            }



        });

        $("#btnUpdateStatus").click(function (event) {
            var table = $("#dtTable").DataTable();
            var rows = $(table.$('input[type="checkbox"]').map(function () {
                return $(this).prop("checked") ? $(this).closest('tr') : null;
            }));

            if (rows.length > 0) {
                if ($("#bulk_status").val() != "" && $("#bulk_status").val() != null && $("#bulk_status").val() != undefined) {
                    Swal.fire({
                        title: "This action will Change Patient Status!",
                        text: "Are you sure you want to change the selected patient status to " + $("#bulk_status").val() + " ?",
                        icon: "question",
                        showCancelButton: !0,
                        confirmButtonText: 'Yes! I confirm',
                        cancelButtonText: 'No! Cancel Please',
                        confirmButtonClass: "btn btn-success mt-2",
                        cancelButtonClass: "btn btn-danger ms-2 mt-2",
                        buttonsStyling: !1
                    }).then(function (t) {
                        if (t.value) {
                            var _patIds = [];

                            $.each(rows, function (index, rowId) {
                                var _data = table.row(rowId).data();
                                _patIds.push(_data.patId);
                            });

                            var _obj = {
                                "patIds": _patIds,
                                "status": $("#bulk_status").val()
                            }

                            $.ajax({
                                url: '@Url.Action("UpdateBulkStatus", "Patient", new { area = "Patient" })',
                                type: "POST",
                                dataType: "json",
                                data: _obj,
                                async: false,
                                success: function (response) {
                                    if (response.isSuccess) {
                                        GetPatients();
                                        $('#bulk_status').val("").trigger('change');
                                        event.preventDefault();
                                        event.stopPropagation();
                                        return $.growl.notice({
                                            title: "Success",
                                            message: response.message
                                        });
                                    }
                                    else {
                                        $('#bulk_status').val("").trigger('change');
                                        event.preventDefault();
                                        event.stopPropagation();
                                        return $.growl.error({
                                            title: "Error",
                                            message: response.message
                                        });
                                    }
                                },
                                error: function (xhr) {
                                    console.log(xhr);
                                }
                            });

                        }
                    });
                }
                else {
                    event.preventDefault();
                    event.stopPropagation();
                    return $.growl.error({
                        title: "Error",
                        message: "Please Select the Status"
                    });
                }
            }
            else {
                event.preventDefault();
                Swal.fire({
                    title: "Attention!",
                    text: "Please Select atleast one patient in the list to update the status",
                    icon: "warning",
                    showCancelButton: 0,
                    confirmButtonColor: "#0bb197", cancelButtonColor: "#ff3d60"
                });
            }

        });
        //#endregion

        //#region Add New Patient
        $("#btnCreatePatient").click(function (e) {
            e.preventDefault();

            $.ajax({
                type: "GET",
                url: "@Url.Action("CreatePatient", "Patient", new { area = "Patient" })",
                contentType: "application/json",
                dataType: "html",
                success: function (data) {
                    $("#create_patient_modal_body").html(data);
                    $("#create_patient_modal").modal("show");
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });
        });
        //#endregion

        //#region Merge Patient
            $("#btnMergePatient").click(function (e) {
                e.preventDefault();
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("MergePatient", "Patient", new { area = "Patient" })",
                    contentType: "application/json",
                    dataType: "html",
                    success: function (data) {
                        $("#merge_patient_modal_body").html(data);
                        $("#merge_patient_modal").modal("show");
                    },
                    error: function (xhr) {
                        console.log(xhr);
                    }
                });
            });
        //#endregion

        //#region Edit Patient
        var editPatient = function(patId) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("EditPatient", "Patient", new { area = "Patient" })?patId=" + patId,
                contentType: "application/json",
                dataType: "html",
                success: function (data) {
                    $("#edit_patient_modal_body").html(data);
                    $("#edit_patient_modal").modal("show");
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });
        };
        //#endregion

        //#region Delete Patient
        var deletePatient = function(patId) {
            Swal.fire({
                title: "Are you sure you want to Delete this Patient ?",
                text: "This action will delete the patient!",
                icon: "question",
                showCancelButton: !0,
                confirmButtonText: 'Yes! I Confirm',
                cancelButtonText: 'No! Cancel Please',
                confirmButtonClass: "btn btn-success mt-2", cancelButtonClass: "btn btn-danger ms-2 mt-2", buttonsStyling: !1
            }).then(function (t) {
                if (t.value) {
                    $.ajax({
                        type: "GET",
                        url: "@Url.Action("DeletePatient", "Patient", new { area = "Patient" })?patId=" + patId,
                        contentType: "application/json",
                        dataType: "html",
                        success: function (data) {
                            console.log(data);
                            var responseData = JSON.parse(data);
                            if (responseData.isAuthorized) {
                                if (responseData.success) {
                                    Swal.fire({
                                        title: "Success!",
                                        text: "Patient Deleted Successfully!!",
                                        icon: "success",
                                        showCancelButton: 0,
                                        confirmButtonColor: "#0bb197", cancelButtonColor: "#ff3d60"
                                    })
                                    GetPatients(0);
                                }
                                else {
                                    Swal.fire({
                                        title: "Error!",
                                        text: "Failed To Delete Patient!",
                                        icon: "error",
                                        showCancelButton: 0,
                                        confirmButtonColor: "#0bb197", cancelButtonColor: "#ff3d60",
                                    });
                                }
                            }
                            else {
                                Swal.fire({
                                    title: "Access Denied!",
                                    text: "You do not have enough privileges to perform this action!",
                                    icon: "error",
                                    showCancelButton: 0,
                                    confirmButtonColor: "#0bb197", cancelButtonColor: "#ff3d60",
                                });
                            }
                        },
                        error: function (xhr) {
                            console.log(xhr);
                        }
                    });
                }
            });
        };
        //#endregion

        //#region Alert Timeout
        function Timeout() {
            window.setTimeout(function () {
                $(".alert").fadeTo(500, 0).slideUp(500, function () {
                    $(this).remove();
                });
            }, 5000);
        }
        //#endregion

        //#region Patient Audit Log
        var patientAuditLog = function (patId, pat_name) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("PatientAuditLog", "Patient", new { area = "Patient" })?patId=" + patId + "&pat_name=" + pat_name,
                contentType: "application/json",
                dataType: "html",
                success: function (response) {
                    $("#patient_logs_body").html(response);
                    $("#patient_logs").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
        //#endregion

        //#region Patient Remarks
        var patientRemarks = function (patId) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("PatientRemarks", "Patient", new { area = "Patient" })?patId=" + patId + "&flag=Patient",
                contentType: "application/json",
                dataType: "html",
                success: function (response) {
                    $("#patient_remarks_body").html(response);
                    $("#patient_remarks").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
        //#endregion

        //#region Patient Details
        var isDetailLinkClicked = false;
        var detailPatient = function (patId, pat_name) {
            if (!isDetailLinkClicked) {
                isDetailLinkClicked = true;

                $.ajax({
                    type: "GET",
                    url: "@Url.Action("PatientDetail", "Patient", new { area = "Patient" })?patId=" + patId + "&pat_name=" + pat_name,
                    contentType: "application/json",
                    dataType: "html",
                    success: function (response) {
                        $("#patient_details_body").html(response);
                        $("#patient_details").modal("show");

                        $("#patient_details").on("hidden.bs.modal", function () {
                            isDetailLinkClicked = false;
                        });
                    },
                    error: function (xhr) {
                        console.log("Error :" + xhr.statusText);
                        isDetailLinkClicked = false;
                    }
                });
            }
        }
        //#endregion

        //#region Patient Documents
        var documentsPatient = function (patId, pat_name) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("PatientDocuments", "Patient", new { area = "Patient" })?patId=" + patId + "&pat_name=" + pat_name,
                contentType: "application/json",
                dataType: "html",
                success: function (response) {
                    $("#patient_documents_body").html(response);
                    $("#patient_documents").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
        //#endregion

        //#region View Doc Modal
        var view_emid = function (patId) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("ViewDocument", "Patient", new { area = "Patient" })?id=" + patId,
                contentType: "application/json",
                dataType: "html",
                success: function (data) {
                    $("#view_emid_modal_body").html(data);
                    $("#view_emid_modal").modal("show");
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });
        };
        //#endregion

        //#region Formatting function for row details
        function format(d) {
            // `d` is the original data object for the row
            return (
                '<table id="dtTable2" class="table table-striped table-bordered text-wrap">' +
                d.replace("#664dc9", "#58575a") +
                '</table>'
            );
        }
        //#endregion

        //#region Export General Logs
        var exportLogs = function (desc) {
            $.ajax({
                type: "POST",
                url: "@Url.Action("ExportLogs", "AuditLogs", new { area = "Common" })?desc="+ desc,
                contentType: "application/json",
                dataType: "json"
            });
        }
        //#endregion

        //#region Patient Remarks
        var patientPackages = function (patId) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("patientPackages", "Patient", new { area = "Patient" })?patId=" + patId,
                contentType: "application/json",
                dataType: "html",
                success: function (response) {
                    $("#patient_packages_body").html(response);
                    $("#patient_packages").modal("show");
                },
                error: function (xhr) {
                    console.log("Error :" + xhr.statusText);
                }
            });
        }
        //#endregion

        //#region Allocation
            $("#btnAllocatePatient").click(function (e) {
                e.preventDefault();
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("AllocatePatient", "Patient", new { area = "Patient" })",
                    contentType: "application/json",
                    dataType: "html",
                    success: function (data) {
                        $("#Allocation_patient_modal_body").html(data);
                        $("#Allocation_patient_modal").modal("show");
                    },
                    error: function (xhr) {
                        console.log(xhr);
                    }
                });
            });
        //#endregion
    </script>
}